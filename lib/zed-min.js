function zLayout(e,t){var n=this;n.set=function(e){if(!e)return n;n=zo.extend(n,e instanceof zLayout?e.getVitals():e);if(e.anchor){n.x=n.anchor.x;n.y=n.anchor.y}else{n.x=n.x||0;n.y=n.y||0;n.anchor={x:n.x,y:n.y}}n.margin=n.margin||0;if(e.width==null||e.width=="auto"){n.innerWidth=n.innerWidth||0;n.width=n.innerWidth+2*n.margin}else n.innerWidth=n.width-2*n.margin;if(e.height==null||e.height=="auto"){n.innerHeight=n.innerHeight||0;n.height=n.innerHeight+2*n.margin}else n.innerHeight=n.height-2*n.margin;if(n.align){if(n.align=="centre")n.xAlign="xCentre",n.yAlign="yCentre";else if(n.align=="leftTop")n.xAlign="left",n.yAlign="top";else if(n.align=="centreTop")n.xAlign="xCentre",n.yAlign="top";else if(n.align=="rightTop")n.xAlign="right",n.yAlign="top";else if(n.align=="rightCentre")n.xAlign="right",n.yAlign="yCentre";else if(n.align=="rightBottom")n.xAlign="right",n.yAlign="bottom";else if(n.align=="centreBottom")n.xAlign="xCentre",n.yAlign="bottom";else if(n.align=="leftBottom")n.xAlign="left",n.yAlign="bottom";else if(n.align=="leftCentre")n.xAlign="left",n.yAlign="yCentre"}if(n.radial==null){n.xAlign=n.xAlign||"left";n.yAlign=n.yAlign||"top";n.trueAnchor=n.anchor}else{var t=zp.normaliseDeg(n.radial);n.xAlign=n.xAlign||"xCentre";n.yAlign=n.yAlign||"yCentre";n.radialStartPoint=n.radialStart!=null?zp.addVector(t,n.radialStart,n.anchor):n.anchor;n.radialEndPoint=n.radialEnd!=null?zp.addVector(t,n.radialEnd,n.anchor):n.radialStartPoint;n.trueAnchor=t<45?{x:n.radialEndPoint.x+.5*n.width,y:n.radialEndPoint.y+.5*n.height*zt.calcDec(t,0,45)}:t<135?{x:n.radialEndPoint.x+.5*n.width*zt.calcDec(t,90,45),y:n.radialEndPoint.y+.5*n.height}:t<225?{x:n.radialEndPoint.x-.5*n.width,y:n.radialEndPoint.y+.5*n.height*zt.calcDec(t,180,135)}:t<315?{x:n.radialEndPoint.x+.5*n.width*zt.calcDec(t,270,315),y:n.radialEndPoint.y-.5*n.height}:{x:n.radialEndPoint.x+.5*n.width,y:n.radialEndPoint.y-.5*n.height*zt.calcDec(t,360,315)}}n.centre=n.getPoint(.5,.5);n.xCentre=n.centre.x;n.yCentre=n.centre.y;n.corners=n.getCorners();var r=za.sort(za.extract(n.corners,"x")),i=za.sort(za.extract(n.corners,"y"));n.left=r[0],n.right=r[3],n.top=i[0],n.bottom=i[3];return n};n.union=function(e){var t={};e=zp.completeBox(e);if(n.xAlign=="xCentre"){t.x=n.x;t.width=Math.max(n.width,Math.max(n.centre.x-e.left,e.right-n.centre.x)*2)}else if(n.xAlign=="right"){t.x=Math.max(n.right,e.right);t.width=t.x-Math.min(n.left,e.left)}else{t.x=Math.min(n.left,e.left);t.width=Math.max(n.right,e.right)-t.x}if(n.yAlign=="yCentre"){t.y=n.y;t.height=Math.max(n.height,Math.max(n.centre.y-e.top,e.bottom-n.centre.y)*2)}else if(n.yAlign=="bottom"){t.y=Math.max(n.bottom,e.bottom);t.height=t.y-Math.min(n.top,e.top)}else{t.y=Math.min(n.top,e.top);t.height=Math.max(n.bottom,e.bottom)-t.y}return n.set(t)};n.zoom=function(e,t){e=zp.completeBox(e);t=zp.completeBox(t||n);var r,i,s={x:n.width/e.width,y:n.height/e.height};if(s.x<s.y){s=s.x;e.height=n.height/s;i=t.yAlign||e.yAlign||n.yAlign;e.top=i=="top"?e.top:i=="bottom"?e.bottom-e.height:e.yCentre-e.height/2;e.bottom=e.top+e.height}else if(s.y<s.x){s=s.y;e.width=n.width/s;i=t.xAlign||e.xAlign||n.xAlign;e.left=i=="left"?e.left:i=="right"?e.right-e.width:e.xCentre-e.width/2;e.right=e.left+e.width}else s=s.x;r={x:(n[n.xAlign]-e[n.xAlign])/e.width,y:(n[n.yAlign]-e[n.yAlign])/e.height};return n.set({x:t.x+t.width*r.x,y:t.y+t.height*r.y,width:t.width*s,height:t.height*s})};n.setByBBox=function(e,t){var r=t.layout||{};if(r.width=="auto")e.autoWidth=true;else if(r.width!=null||r.innerWidth!=null)e.autoWidth=false;if(r.height=="auto")e.autoHeight=true;else if(r.height!=null||r.innerHeight!=null)e.autoHeight=false;if(t.margin!=null)r.margin=t.margin;e.getBBox(t);if(e.autoWidth)r.innerWidth=e.bBox.width;if(e.autoHeight)r.innerHeight=e.bBox.height;n.set(r)};n.clone=function(e){return new zLayout(n.getVitals(e))};n.getVitals=function(e){var t,r={},i=["x","y","anchor","margin","width","height","xAlign","yAlign","left","right","top","bottom","rotation","radial","radialStart","radialEnd","verticalSkew"];for(t=0;t<i.length;t++)if(n[i[t]]!=null)r[i[t]]=zo.clone(n[i[t]]);return e?zo.extend(r,e):r};n.getCorners=function(e){return[n.getPoint(0,0,e),n.getPoint(1,0,e),n.getPoint(1,1,e),n.getPoint(0,1,e)]};n.getRect=function(e){return e&&n.margin?{x:n.left+n.margin,y:n.top+n.margin,width:Math.abs(n.innerWidth),height:Math.abs(n.innerHeight)}:{x:n.left,y:n.top,width:Math.abs(n.width),height:Math.abs(n.height)}};n.getBox=function(e){return e&&n.margin?{left:n.left+n.margin,right:n.right-n.margin,top:n.top+n.margin,bottom:n.bottom-n.margin}:{left:n.left,right:n.right,top:n.top,bottom:n.bottom}};n.getSVG=function(e){if(!e||!n.width||!n.height)return zp.shape(n.corners);var t=zp.start,r=zp.lineTo,i=n.xAlign=="right"&&n.yAlign!="bottom"||n.xAlign!="right"&&n.yAlign=="bottom"?zp.reverseArcTo:zp.arcTo,s=e/n.width,o=e/n.height;return t(n.getPoint(s,0))+r(n.getPoint(1-s,0))+i(e,n.getPoint(1,o))+r(n.getPoint(1,1-o))+i(e,n.getPoint(1-s,1))+r(n.getPoint(s,1))+i(e,n.getPoint(0,1-o))+r(n.getPoint(0,o))+i(e,n.getPoint(s,0))};n.alignmentToDeg=function(){return zp.alignmentToDeg(n.xAlign,n.yAlign)};n.getInverseAlignment=function(){if(n.radial!=null)return{radial:zp.inverseDeg(n.radial)};return{xAlign:zp.inverseAlignment(n.xAlign),yAlign:zp.inverseAlignment(n.yAlign)}};n.getAntiAnchor=function(){return n.getPoint(n.xAlign=="xCentre"?.5:1,n.yAlign=="yCentre"?.5:1)};n.getPoint=function(e,t,r){var i={x:n.getX(e,r),y:n.getY(t,r)};if(n.rotation)i=n.getRadialPoint(i,n.rotation);if(n.verticalSkew)i.y+=(i.x-n.x)*Math.sin(n.verticalSkew);return i};n.getX=function(e,t){if(n.xAlign=="xCentre")e-=.5;else if(n.xAlign=="right")e*=-1;if(!t)return n.trueAnchor.x+n.width*e;else return n.trueAnchor.x+n.innerWidth*e+(n.xAlign=="left"?n.margin:n.xAlign=="right"?-n.margin:0)};n.getY=function(e,t){if(n.yAlign=="yCentre")e-=.5;else if(n.yAlign=="bottom")e*=-1;if(!t)return n.trueAnchor.y+n.height*e;else return n.trueAnchor.y+n.innerHeight*e+(n.yAlign=="top"?n.margin:n.yAlign=="bottom"?-n.margin:0)};n.getOffset=function(e,t,r){return zp.subtractPoints(n.getPoint(e,t,r),n.trueAnchor)};n.getDec=function(e,t){if(n.rotation)e=n.getRadialPoint(e,-n.rotation);if(t)return{x:zt.calcDec(e.x,n.left,n.right),y:zt.calcDec(e.y,n.top,n.bottom)};else return{x:zt.calcDec(e.x,n.left,n.right),y:zt.calcDec(e.y,n.top,n.bottom)}};n.getXDec=function(e,t){return n.getDec({x:e.x!=null?e.x:e,y:0},t).x};n.getYDec=function(e,t){return n.getDec({x:0,y:e.y!=null?e.y:e},t).y};n.getRadialPoint=function(e,t){if(!t)return e;var r=zp.calcVector(n.trueAnchor,e);return zp.addVector(r.deg+t,r.dist,n.trueAnchor)};n.getPoints=function(e,t){var r,i=[];for(r=0;r<e.length;r++)i.push(n.getPoint(e[r][0],e[r][1],t));return i};n.contains=function(e,t){return zp.isInBox(e,n,t)};n.type="zLayout";n.parent=t;n.set(e)}function zSimpleDrone(e,t,n){zo.shyExtend(e,{"class":"zSimpleDrone",type:n,hidden:false,forEach:function(t,n,r,i,s,o,u){if(typeof t=="string")e.raphObj[t](n,r,i,s,o,u);else if(typeof t=="function")t(e.raphObj,n,r,i,s,o,u)},add:function(t,n){t.attr(n);t.parent=e;e.raphObj=t;return t},remove:function(t,n,r,i){if(t){e.clearEvents();e.hide(t,n,function(){e.remove(null,null,r)},i)}else{e.markOfDeath=true;if(e.parent&&e.parent.drones)za.remove(e.parent.drones,e);e.forEach("remove");delete e;if(r)r()}},show:function(t,n,r,i){e.invisibleShow();e.animate({opacity:e.O.opacity||1},t,n,r,i)},hide:function(t,n,r,i){e.hiding=true;e.animate({opacity:0},t,n,function(){if(!e.hiding)return;e.forEach("hide");e.hidden=true;if(r)r()},i)},invisibleShow:function(){if(e.hidden)e.forEach("show");else if(!e.hiding)return;e.hidden=e.hiding=false},appear:function(t,n,r,i){if(!t)return;e.hide();e.show(t,n,r,i)},toFront:function(){e.forEach("toFront")},toBack:function(){e.forEach("toBack")},parseOrders:function(t){if(typeof t=="string")t=e.O[t];return t?za.asObject(t):{}},animate:function(t,n,r,i,s){t=e.parseOrders(t);if(zo.isEmpty(t)||e.markOfDeath)return;if(!n||e.hidden||PAPER.noAnimation){e.forEach("attr",t);if(i)i()}else{e.forEach(s&&s.animation?function(e){e.animation=Raphael.animation(t,n,r,i);e.animateWith(s,s.animation,e.animation);i=null}:function(e){e.animation=Raphael.animation(t,n,r,i);e.animate(e.animation);i=null})}return t},stop:function(){e.forEach("stop")},setOrders:function(t,n,r,i,s){e.O=e.parseOrders(t);e.reset(n,r,i,s)},addOrders:function(t,n,r,i,s){e.setOrders(zo.extend(e.O,e.parseOrders(t)),n,r,i,s)},setMode:function(t,n,r,i,s){if(typeof t!="string"||!e.O[t])return;if(e.origO)e.O=zo.clone(e.origO);else e.origO=zo.clone(e.O);e.addOrders(t,n,r,i,s)},unsetMode:function(t,n,r,i){if(!e.origO)return;e.setOrders(e.origO,t,n,r,i);e.origO=null},highlight:function(t,n,r,i){e.animate("highlight",t,n,r,i)},reset:function(t,n,r,i){e.animate(e.O,t,n,r,i)},select:function(t,n,r,i){e.setMode("select",t,n,r,i)},deselect:function(t,n,r,i){e.unsetMode(t,n,r,i)},clearEvents:function(){e.forEach(function(e){if(!e.events)return;for(var t=0;t<e.events.length;t++)e.events[t].unbind();delete e.events})},click:function(t){e.forEach("click",t)},dblclick:function(t){e.forEach("dblclick",t)},mousedown:function(t){e.forEach("mousedown",t)},mouseup:function(t){e.forEach("mouseup",t)},mousemove:function(t){e.forEach("mousemove",t)},touchstart:function(t){e.forEach("touchstart",t)},touchmove:function(t){e.forEach("touchmove",t)},touchend:function(t){e.forEach("touchend",t)},touchcancel:function(t){e.forEach("touchcancel",t)},hover:function(t,n){e.forEach("hover",t,n)},drag:function(t,n,r){e.forEach("drag",t,n,r)},onAnimation:function(t){e.forEach("onAnimation",t)},hoverHighlight:function(t,n){e.hover(function(){e.highlight(t,n)},function(){e.reset(t,n)})},tooltip:function(t,n,r){e.mousemove(function(i){if(n.hidden)n.showAt({text:t||e.O.tooltipText},100);n.moveToEvent(i,r)});e.hover(function(i){n.showAt({text:t||e.O.tooltipText},100);n.moveToEvent(i,r)},function(){n.hide(100)})},initialise:function(t){if(t.base)t=zo.clone(zo.removeProperty(t,"base"),t);e.O=e.parseOrders(t);if(e.O.layout){if(e.O.margin!=null)e.O.layout.margin=e.O.margin;e.L=e.O.layout.type=="zLayout"?e.O.layout:new zLayout(e.O.layout,e)}}});e.initialise(t)}function zGuide(){this.redraw=function(e,t,n,r){this.redrawTo(0);this.redrawTo(1,e,t,n,r)};this.redrawTo=function(e,t,n,r,i){if(r)this.bQueue.push(r);if(this.scripting)return;this.stop();var s=this;this.animating=true;this.animate({path:zp.start({x:e*1e3,y:0})},t,n,function(){var e,t=s.bQueue;s.bQueue=[];s.animating=false;for(e=0;e<t.length;e++)t[e]()},i)};this.stop=function(){this.animating=false;this.forEach("stop")};this.getVal=function(){var e=this.K.attrs.path,t=e instanceof Array?e[0][1]:e[1]==" "?e.substr(2,e.length-4):e.substr(1,e.length-3);return t/1e3};this.runScript=function(e,t){if(!e||!e.length)return;if(!PAPER.noAnimation){var n=this,r=e.shift(),i=r[0][0]||1,s=r[0][1],o=r[1];this.redrawTo(0);this.redrawTo(1,i,s,function(){n.runScript(e,t)},t);this.scripting=true;if(o)o(i,s,this.K);this.scripting=false}else for(var u=0;u<e.length;u++)e[u][1]()};this.delay=function(e,t){this.redraw(e,"-",t)};zSimpleDrone(this,{},"zGuide");this.K=this.add(PAPER.path(zp.start()));this.animating=false;this.bQueue=[]}function zLine(e,t,n,r,i){this.redraw=function(e,t,n,r,i){if(e.points)e.path=zp.line(e.points);this.animate(e,t,n,r,i)};zSimpleDrone(this,e,"zLine");this.add(PAPER.path(zp.line(this.O.points)),this.O);this.appear(t,n,r,i)}function zShape(e,t,n,r,i){this.redraw=function(e,t,n,r,i){if(e.points)e.path=zp.shape(e.points);this.animate(e,t,n,r,i)};zSimpleDrone(this,e,"zShape");this.add(PAPER.path(zp.shape(this.O.points)),this.O);this.appear(t,n,r,i)}function zArc(e,t,n,r,i){this.redraw=function(e,t,n,r,i){if(e.arc)e.path=zp.arc(e.arc);this.animate(e,t,n,r,i)};zSimpleDrone(this,e,"zArc");this.add(PAPER.path(zp.arc(this.O.arc)),this.O);this.appear(t,n,r,i)}function zCircle(e,t,n,r,i){this.redraw=function(e,t,n,r,i){if(e.circle){var s=e.circle;if(s.centre)e.cx=s.centre.x,e.cy=s.centre.y;if(s.radius)e.r=s.radius}this.animate(e,t,n,r,i)};zSimpleDrone(this,e,"zCircle");var s=this.O.circle;this.add(PAPER.circle(s.centre.x,s.centre.y,s.radius),this.O);this.appear(t,n,r,i)}function zRectangle(e,t,n,r,i){zSimpleDrone(this,e,"zRectangle");if(!this.L&&this.O.rect){var s=this.O.rect;this.add(PAPER.rect(s.x,s.y,Math.abs(s.width),Math.abs(s.height)),this.O);this.redraw=function(e,t,n,r,i){if(!e)return;if(e.rect)zo.extend(e,e.rect);this.animate(e,t,n,r,i)}}else if(this.O.rounded==null){var o=this.L;this.add(PAPER.rect(o.left,o.top,Math.abs(o.width),Math.abs(o.height)),this.O);this.redraw=function(e,t,n,r,i){if(!e)return;this.L.set(e.layout);if(e.layout)zo.extend(e,this.L.getRect());this.animate(e,t,n,r,i)}}else{var u=this.L.getSVG(this.O.rounded);this.add(PAPER.path(u),this.O);this.redraw=function(e,t,n,r,i){if(!e)return;this.L.set(e.layout);if(e.rounded!=null)e.path=this.L.getSVG(e.rounded);else if(e.layout)e.path=this.L.getSVG(this.O.rounded);this.animate(e,t,n,r,i)}}this.appear(t,n,r,i)}function zText(e,t,n,r,i){var s=this;s.parseText=function(e){var t=s.O.format;if(!t||typeof t!="object")return e;if(!isNaN(e))e=zt.format(e,t);if(t.rows)e=zt.wrap(e,1.1*e.length/t.rows);else if(t.wrap)e=zt.wrap(e,t.wrap);if(t.shorten)e=zt.shorten(e,t.shorten);if(t.case)e=t.case=="upper"?e.toUpperCase():t.case=="lower"?e.toLowerCase():t.case=="camel"?zt.camelCase(e):t.case=="title"?zt.titleCase(e):e;return e};s.getBBox=function(e){var t,n={},r={},i=false,o=["text","font-size","font-weight"];for(t=0;t<o.length;t++)if(e[o[t]]!=null){n[o[t]]=e[o[t]];r[o[t]]=s.O[o[t]];i=true}if(i){s.raphObj.attr(n);s.bBox=s.raphObj.getBBox(true);s.raphObj.attr(r)}return s.bBox};s.redraw=function(e,t,n,r,i){if(!e)return;var o,u,a,f,l,h,p,d=s.parseOrders(e);if(d.text!=null)d.text=s.parseText(d.text);s.L.setByBBox(s,d);o=d.textXAlign||s.O.textXAlign||s.L.xAlign;u=d.textYAlign||s.O.textYAlign||s.L.yAlign;a=zp.alignmentToDec(s.L.xAlign);f=zp.alignmentToDec(s.L.yAlign);l=zp.alignmentToDec(o);h=zp.alignmentToDec(u);p={x:s.L.trueAnchor.x+(l-a)*s.L.width-(l-.5)*2*s.L.margin,y:s.L.trueAnchor.y+(h-f)*s.L.height-(h-.5)*(2*s.L.margin+s.bBox.height),transform:s.L.rotation?"r"+s.L.rotation+","+s.L.trueAnchor.x+","+s.L.trueAnchor.y:null,"text-anchor":o=="left"?"start":o=="right"?"end":"middle"};d=zo.shyExtend(p,d);s.animate(d,t,n,r,i)};zSimpleDrone(s,e,"zText");s.bBox={};s.autoWidth=s.L.width=="auto"||!s.L.innerWidth;s.autoHeight=s.L.height=="auto"||!s.L.innerHeight;s.add(PAPER.text(s.L.x,s.L.y,"Placeholder"),s.O);if(!s.O.selectable)$(s.raphObj.node).attr("style",$(s.raphObj.node).attr("style")+"-webkit-touch-callout:none; -webkit-user-select:none; -khtml-user-select:none; -moz-user-select:none; -ms-user-select:none; user-select:none;");s.redraw(s.O);s.appear(t,n,r,i)}function zImage(e,t,n,r,i){this.redraw=function(e,t,n,r,i){var s=this.L;s.set(e.layout);zo.extend(e,{x:Math.round(s.left+s.margin),y:Math.round(s.top+s.margin),width:Math.round(s.innerWidth),height:Math.round(s.innerHeight)});this.animate(e,t,n,r,i)};zSimpleDrone(this,e,"zImage");var s=this.L;this.add(PAPER.image(this.O.url,s.left,s.top,s.innerWidth,s.innerHeight),this.O);this.appear(t,n,r,i)}function zSVG(e,t,n,r,i){this.redraw=function(e,t,n,r,i){this.animate(e,t,n,r,i);if(this.L&&e.layout){var s=this.L,o={x:s.x,y:s.y};s.set(e.layout);this.raphObj.translate(s.x-o.x,s.y-o.y)}};zSimpleDrone(this,e,"zSVG");this.add(PAPER.path(this.O.path),this.O);this.appear(t,n,r,i)}function zComplexDrone(e,t,n){zSimpleDrone(zo.shyExtend(e,{"class":"zComplexDrone",parts:{},forEach:function(t,n,r,i,s,o,u){if(typeof t=="string")for(var a in e.parts)e.parts[a][t](n,r,i,s,o,u);else if(typeof t=="function")for(var a in e.parts)t(e.parts[a],a)},add:function(t,n){var r=zDrones.make(t.type,t);if(!r)return;r.parent=e;e.parts[n]=r;return r},show:function(t,n,r,i){e.invisibleShow();var s,o={opacity:e.O.opacity||1};for(s in e.parts)if(e.O[s]&&e.O[s].opacity)o[s]={opacity:e.O[s].opacity};e.animate(o,t,n,r,i)},invisibleShow:function(){if(e.hidden)e.forEach("invisibleShow");else if(!e.hiding)return;e.hidden=e.hiding=false},parseOrders:function(t){if(!t)return{};t=za.asObject(t);var n,r={},i={},s=zo.clone(typeof t=="string"?e.O[t]||{}:t);for(n in e.parts)r[n]=s[n]?zo.removeProperty(s,n):{};i=zo.clone(s);for(n in e.parts)i[n]=zo.shyExtend(r[n],s);return i},animate:function(t,n,r,i,s){t=e.parseOrders(t);if(zo.isEmpty(t)||e.markOfDeath)return;for(var o in e.parts)if(t[o]){e.parts[o].animate(t[o],n,r,i,s);i=null,s=e.K}return t},redraw:function(t,n,r,i,s){t=e.parseOrders(t);if(zo.isEmpty(t)||e.markOfDeath)return;for(var o in e.parts)if(t[o]){e.parts[o].redraw(t[o],n,r,i,s);i=null,s=e.K}},clearEvents:function(){e.forEach("clearEvents")},initialise:function(t){if(t.base)t=zo.clone(zo.removeProperty(t,"base"),t);for(var n in t)if(t[n]&&t[n].type)e.parts[n]={};e.O=e.parseOrders(t);if(e.O.layout){if(e.O.margin!=null)e.O.layout.margin=e.O.margin;e.L=e.O.layout.type=="zLayout"?e.O.layout:new zLayout(e.O.layout,e)}}}),t,n)}function zMultiDrone(e,t,n,r,i){var s=this,o,u;zComplexDrone(s,e,"zMultiDrone");e=s.parseOrders(s.O);for(o in s.parts){u=s.add(e[o],o);if(!s.K)s.K=u.K}s.appear(t,n,r,i)}function zTextBox(e,t,n,r,i){var s=this,o,u;s.plotAccessories=function(e){if(s.parts.background)e.background.layout=s.L;if(s.parts.branch)e.branch.points=[s.L.radialStartPoint,s.L.radialEndPoint]};s.redraw=function(e,t,n,r,i){e=s.parseOrders(e);if(zo.isEmpty(e)||s.markOfDeath)return;s.parts.textObj.redraw(e.textObj,t,n,r,i);s.plotAccessories(e);if(s.parts.background)s.parts.background.redraw(e.background,t,n,null,s.K);if(s.parts.branch)s.parts.branch.redraw(e.branch,t,n,null,s.K)};s.initialise=function(e,t){if(e.base)e=zo.clone(zo.removeProperty(e,"base"),e);if(e.background)e.background.type="zRectangle";if(e.branch&&e.layout.radialEnd!=null)e.branch.type="zLine";e.textObj=e.textObj||{};e.textObj.type="zText";for(o in e)if(e[o]&&e[o].type)s.parts[o]={};s.O=s.parseOrders(e);if(s.O.layout){if(s.O.margin!=null)s.O.layout.margin=s.O.margin;s.L=s.O.layout.type=="zLayout"?s.O.layout:new zLayout(s.O.layout,s)}};zComplexDrone(s,e,"zTextBox");s.add(s.O.textObj,"textObj");s.K=s.parts.textObj.K;s.L=s.parts.textObj.L;if(s.parts.background){s.O.background.layout=s.L;s.add(s.O.background,"background")}if(s.parts.branch){s.O.branch.points=[s.L.radialStartPoint,s.L.radialEndPoint];s.add(s.O.branch,"branch")}s.parts.textObj.toFront();s.appear(t,n,r,i)}function zTooltipBox(e){var t=new zTextBox(zo.extend({type:"zTooltipBox",text:"Empty tooltip",margin:10,layout:{},"font-size":14,fill:"#eee",background:{rounded:15,stroke:null,fill:"black",opacity:.85}},e));t.moveToEvent=function(e,n){var r=zt.getEventPosition(e);t.redraw({layout:zo.extend({x:Math.max(r.x-12,t.L.width),y:Math.max(r.y-12,t.L.height),xAlign:"right",yAlign:"bottom"},n)})};t.showAt=function(e,n,r,i,s){t.redraw(e);t.toFront();t.show(n,r,i,s)};t.type="zTooltipBox";t.hide();t.hover(function(){t.show(100)},function(){t.hide(100)});t.click(function(){t.hide(100)});return t}function zHTML(e,t,n,r,i){var s=this;s.add=function(e){var t=$("<div"+(e.setClass?" class="+e.setClass:"")+(e.setID?" id="+e.setID:"")+"></div>");s.raphObj=t;$("#Raphael").append(t);return t};s.animate=function(e,t,n,r,i){e=s.parseOrders(e);if(zo.isEmpty(e)||s.markOfDeath)return;s.stop();$(s.raphObj).animate(e,t||0,"linear",r);return e};s.clearEvents=function(){$(s.raphObj).unbind()};s.getBBox=function(e,t){if(e.content){s.raphObj.html(zo.removeProperty(e,"content"));s.bBox={width:s.raphObj.width(),height:s.raphObj.height()}}return s.bBox};s.redraw=function(e,t,n,r,i){if(!e||s.markOfDeath)return;var o,e=s.parseOrders(e);s.getBBox(e);if(e.layout){s.L.setByBBox(s,e);o=zt.getDocumentPosition({x:s.L.left,y:s.L.top});zo.extend(e,{position:"absolute",left:o.x+"px",top:o.y+"px",width:s.autoWidth?"auto":Math.round(s.L.innerWidth)+"px",height:s.autoHeight?"auto":Math.round(s.L.innerHeight)+"px",padding:s.L.margin+"px"})}e=zo.clone(s.O,e);s.raphObj.attr("style",zt.asCSSString(e))};zSimpleDrone(s,e,"zHTML");s.bBox={};var o=e.layout;s.autoWidth=o.width=="auto"||!o.width&&!o.innerWidth;s.autoHeight=o.height=="auto"||!o.height&&!o.innerHeight;s.add(s.O);s.redraw(s.O);s.appear(t,n,r,i)}function zHTMLTooltipBox(e){var t=new zHTML(zo.extend({text:"Empty tooltip",layout:{},margin:10,opacity:.8,"z-index":9999,"-moz-box-shadow":"10px 10px 5px #888","-webkit-box-shadow":"10px 10px 5px #888","box-shadow":"5px 5px 5px #bbb",border:"solid 1px #c4dde2","border-radius":"10px","background-color":"#d4edf2","font-family":"sans-serif","font-size":"13px"},e));t.moveToEvent=function(e,n){var r=zt.getEventPosition(e);t.redraw({layout:zo.extend({x:Math.max(r.x-12,t.L.width),y:Math.max(r.y-12,t.L.height),xAlign:"right",yAlign:"bottom"},n)})};t.showAt=function(e,n,r,i,s){if(e.text)e.content=zo.removeProperty(e,"text");t.redraw(e,null,null,function(){t.show(n,r,i,s)})};t.type="zHTMLTooltipBox";t.hide();t.hover(function(){t.show(100)},function(){t.hide(100)});t.click(function(){t.hide(100)});return t}function zNarrator(e){var t=new zHTML(zo.extend({setID:"narrator",margin:20,opacity:.92,"z-index":9999,"-moz-box-shadow":"10px 10px 5px #888","-webkit-box-shadow":"10px 10px 5px #888","box-shadow":"5px 5px 5px #bbb",border:"solid 1px #c4dde2","border-radius":"10px","background-color":"#d4edf2","font-family":"sans-serif","font-size":"13px",layout:{},content:"<div id='content'>bfgb</div><br><br>"+"<div id='nav'>"+"<a href=javascript:void(0) id='prev'>Prev</a>"+"<a href=javascript:void(0) id='next'>Next</a>"+"<div id='middle'>"+"<div id='pageCount'></div>"+"<a href=javascript:void(0) id='close'>Close</a>"+"</div>"+"</div>"},e));t.setScene=function(n){var r=t.script[n-1];t.page=n;if(n==1)t.elements.prev.hide();else if(n==2)t.elements.prev.show();else if(n==t.script.length-1)t.elements.next.html("Next");else if(n==t.script.length)t.elements.next.html("Close");else if(n>t.script.length){t.remove(200,"<>");if(e.onClose)e.onClose();return}t.elements.content.html(r.content);t.elements.pageCount.html(n+"/"+t.script.length);if(r.action)r.action();t.redraw({layout:r.layout})};t.type="zNarrator";t.script=e.script;t.elements={content:$("#narrator #content"),prev:$("#narrator #nav #prev"),next:$("#narrator #nav #next"),pageCount:$("#narrator #nav #middle #pageCount"),close:$("#narrator #nav #middle #close")};t.elements.close.click(function(){t.setScene(t.script.length+1)});t.elements.prev.click(function(){t.setScene(t.page-1)});t.elements.next.click(function(){t.setScene(t.page+1)});t.setScene(1);return t}function zDataCube(e){this.isR=function(e){return e&&(e.isR||e.rs||e.r!=null)};this.parsePos=function(e){if(e==null)logger("zDataCube.parsePos(): null is not a valid pos.");else if(e.d==null)logger("zDataCube.parsePos(): No dimension defined ("+zt.asString(e)+").");else{if(e.a!=null)return{d:e.d,p:e.a};if(e.r!=null)return{d:e.d,p:e.r,isR:true};if(e.p!=null)return{d:e.d,p:e.p,isR:e.isR};if(e.as instanceof Array)return{d:e.d,p:e.as[e.d]};if(e.rs instanceof Array)return{d:e.d,p:e.rs[e.d],isR:true};if(e.s instanceof Array)return{d:e.d,p:e.s[e.d],isR:e.isR}}};this.parseSpace=function(e){if(e==null)return logger("zDataCube.parseSpace(): null is not a valid space.");var t=e.as||e.rs||e.s||e;if(t instanceof Array)return t.slice();else if(typeof t=="string"){if(t!="all"&&t!="mask")logger("zDataCube.parseSpace(): Only 'all' or 'mask' are valid strings for spaces. I don't know what "+zt.asString(t)+" is.");else return za.fill(t,this.dLen)}else{var n,r=this.parsePos(e);if(r){n=za.fill("mask",this.dLen);n[r.d]=r.p;return n}}logger("zDataCube.parseSpace(): "+zt.asString(e)+" is not a valid space.")};this.asAPos=function(e){e=this.parsePos(e);if(!e)return;if(e.isR){if(e.p=="all")return this.shown[e.d].slice();if(typeof e.p=="number"||e.p instanceof Array)return za.map(this.shown[e.d],e.p);return e.p}else{if(e.p=="all")return za.fill(0,this.getSize(e.d),1);return e.p}};this.asRPos=function(e){e=this.parsePos(e);if(!e)return;if(!e.isR){if(e.p=="all")return za.unmap(this.shown[e.d],za.fill(0,this.getSize(e.d),1));if(typeof e.p=="number"||e.p instanceof Array)return za.unmap(this.shown[e.d],e.p);return e.p}else{if(e.p=="all")return za.fill(0,this.shown[e.d].length,1);return e.p}};this.asASpace=function(e){var t,n=this.isR(e),r=this.parseSpace(e);for(t=0;t<this.dLen;t++)r[t]=this.asAPos({d:t,p:r[t],isR:n});return r};this.asRSpace=function(e){var t,n=this.isR(e),r=this.parseSpace(e);for(t=0;t<this.dLen;t++)r[t]=this.asRPos({d:t,p:r[t],isR:n});return r};this.addSpaces=function(e,t){e=this.parseSpace(e);if(!t)return e;t=this.parseSpace(t);for(var n=0;n<this.dLen;n++)if(t[n]=="mask")t[n]=e[n];return t};this.listSpaces=function(e,t){var n,r,i=[],s=[],o=za.fill(0,this.dLen),u=o.slice();e=this.isR(e)?this.asRSpace(e):this.asASpace(e);if(t){t=this.parseSpace(t);for(n=0;n<t.length;n++)if(t[n]!="mask")e[n]="mask"}for(n=0;n<this.dLen;n++){e[n]=e[n]instanceof Array?e[n]:[e[n]];s[n]=e[n].length-1;if(s[n]<0)return i}while(u){for(r=[],n=0;n<this.dLen;n++)r[n]=e[n][u[n]];i.push(this.addSpaces(r,t));u=za.counter(u,o,s,"array")}return i};this.setShown=function(e,t){if(e!=null){this.oldShown[e]=this.shown[e];this.shown[e]=t||za.fill(0,this.getSize(e),1)}else for(e=0;e<this.dLen;e++)this.setShown(e)};this.filterShown=function(e,t,n,r,i){var s=this.getMeta(e,{d:t,r:"all"}),o=za.findAll(s,n,r,i),u=this.asAPos({d:t,r:o});this.setShown(t,u);return shown};this.setMeta=function(e,t,n){if(e!=null&&e!="all"){var r,i=this.meta[t.d],s=this.asAPos(t);if(s==null)i[e]=n;else{if(!i[e]){logger("zDataCube.setMeta(): Creating new meta of type "+e+" in dimension "+t.d+".");i[e]=[]}if(typeof s=="number")i[e][s]=n;else if(s instanceof Array)for(r=0;r<s.length;r++){i[e][s[r]]=n}}}else for(e in n){if(e=="all")logger("zDataCube.setMeta(): 'all' is a reserved type name used to call up all types of metadata at once. Don't use it in your data.");else this.setMeta(e,t,n[e])}};this.getMetaObj=function(e){var t,n,r,i=this.meta[e.d],s=this.asAPos(e);if(s==null)s=this.asAPos({d:e.d,a:"all"});if(s instanceof Array){r=[];for(t=0;t<s.length;t++)r[t]=this.getMetaObj({d:e.d,a:s[t]})}else{r={};for(n in i)r[n]=i[n][s];r.a=s}return r};this.getMeta=function(e,t){var n=this.asAPos(t),r=this.meta[t.d][e];if(!r)logger("zDataCube.getMeta(): Metadata type "+e+" in dimension "+t.d+" is empty or does not exist.");else return n==null?r:za.map(r,n)};this.findMeta=function(e,t,n,r,i){var s=this.asAPos(t),o=this.getMeta(e,t),u=za.find(o,n,r,i);return s==null?u:za.map(s,u)};this.findAllMeta=function(e,t,n,r,i){var s=this.asAPos(t),o=this.getMeta(e,t),u=za.findAll(o,n,r,i);return s==null?u:za.map(s,u)};this.findName=function(e,t){return this.findMeta("name",e,t)};this.shyPushMeta=function(e,t,n){var r=this.findMeta(e||"name",{d:t},n.name||n);if(r!=null)return r;r=this.getSize(t);this.shown[t].push(r);this.setMeta(e,{d:t,a:r},n);return r};this.getSize=function(e,t){if(e!=null){if(!this.meta[e].name)explode("zDataCube.getSize(): Dimension "+e+" does not contain name property.");else return t?this.shown[e].length:this.meta[e].name.length}else{for(var n=[],e=0;e<this.dLen;e++)n[e]=this.getSize(e,t);return n}};this.get=this.getName=function(e){return this.getMeta("name",e)};this.setColour=function(e,t,n){t=t||zt.getPalette(null,12,"sequential");var r,i,s,o,u,a=[],f=[],l,c,h=this.asAPos(e);if(n=="hierarchic"||n=="randomHierarchic"){if(t.length<3)explode("zDataCube.setColour(): Can't do a hierarchic assignment with less than 3 colours.");r=this.meta[e.d].hierarchy;for(i=0;i<r.length;i++)for(s=0;s<r[i].length;s++){if(!f.length)f=n=="hierarchic"?t.slice():za.getRandom(t,t.length);u=this.getMetaObj({d:e.d,a:r[i][s]});for(o=0;o<f.length;o++){c=l&&a[l.a]==f[o]?false:u.parentPos!=null&&a[u.parentPos]==f[o]?false:true;if(c){a[u.a]=f.splice(o,1)[0];break}else if(o==f.length-1){o=-1;f=f.concat(n=="hierarchic"?t.slice():za.getRandom(t,t.length))}}l=u}}else a=zt.getPalette(t,h.length,n||"sequential");this.setMeta("colour",{d:e.d},a)};this.calcMeta=function(e,t,n){return za.calc(this.getMeta(e,t),n,true)};this.addCalcMeta=function(e,t,n){var r,i=this.asAPos(t),s=zt.camelCase([e,n]),o=this.calcMeta(e,t,n);for(r=0;r<i.length;r++){this.setMeta(s,{d:t.d,a:i[r]},o[r])}};this.addDataType=function(e,t){this.data[e]=t||[]};this.setData=function(e,t,n){za.setDeep(this.data[e],this.asASpace(t),n)};this.getData=function(e,t){return za.getDeep(this.data[e],this.asASpace(t))};this.getVal=function(e){return this.getData("val",e)};this.listData=function(e,t){var n,r=[],i=this.listSpaces(t);for(n=0;n<i.length;n++){r[n]={as:i[n],val:this.getData(e,{as:i[n]})}}return r};this.forData=function(e,t,n){var r,i=[],s=this.listSpaces(t);for(r=0;r<s.length;r++){this.setData(e,{as:s[r]},n(s[r],this.getData(e,{as:s[r]})))}};this.calcData=function(e,t,n,r){var i=za.flatten(za.asArray(this.getData(e,t)));return za.calc(i,n,r)};this.addCalcData=function(e,t,n,r){var i,s,o,u,a=this.isR(t),f=zt.camelCase([e,r]),l=this.listSpaces(t,n);if(!this.data[f])this.addDataType(f);for(i=0;i<l.length;i++){u=this.calcData(e,{s:l[i],isR:a},r,true);o=this.listSpaces({s:l[i],isR:a});for(s=0;s<o.length;s++){this.setData(f,{s:o[s],isR:a},u[s])}}};this.makeHierarchy=function(e){if(e!=null){var t,n,r=[],i,s=[],o=[],u=[],a=[],f=this.meta[e].parentPos,l=zo.removeProperty(this.meta[e],"parentName"),c=f?f.length:l?l.length:null;if(l)for(f=[],t=0;t<this.getSize(e);t++){if(l[t]=="root"||l[t]==null)f[t]=null;else f[t]=this.shyPushMeta("name",e,l[t])}if(f)for(t=0;t<this.getSize(e);t++){n=f[t];if(n==t)explode("zDataCube.makeHierarchy(): UH OH - "+this.getName({d:e,a:t})+" is its own parent. Space-time continuum collapsing.");f[t]=n==-1?null:n;s[t]=[];o[t]=0}else return;for(t=0;t<this.getSize(e);t++){n=f[t];if(n!=null)s[n].push(t)}r=za.findAll(f,null);while(r.length>0){i=[];for(t=0;t<r.length;t++){n=r[t];u[n]=a.length;i=i.concat(s[n])}a.push(r);r=i}this.setMeta("parentPos",{d:e},f);this.setMeta("childrenPos",{d:e},s);this.setMeta("leaves",{d:e},o);this.setMeta("hierarchy",{d:e},a);this.setMeta("generation",{d:e},u);this.showNodes({d:e,a:"all"});logger("zDataCube.makeHierarchy(): "+f.length+" nodes added into "+a.length+" generations, with "+(f.length-c)+" imputed nodes.")}else for(e=0;e<this.dLen;e++)this.makeHierarchy(e)};this.addRootNode=function(e,t){var n,r=this.meta[e],i=this.findMeta("name",{d:e},t||"root");if(i==null)i=this.getSize(e);for(n=0;n<r.generation.length;n++){if(r.generation[n]==0)r.parentPos[n]=i;r.generation[n]++}this.setMeta(null,{d:e,a:i},{name:t||"root",parentPos:null,childrenPos:r.hierarchy[0],generation:0,leaves:za.calcObjects(r.hierarchy[0],"leaves","sum")});r.hierarchy=[[i]].concat(r.hierarchy);return this.getMetaObj({d:e,a:i})};this.liveFilter=function(e,t,n){if(!n)return t;if(t instanceof Array){var r,i,s=[];for(r=0;r<t.length;r++){i=this.liveFilter(e,t[r],true);if(i)s.push(i)}return s}else if(this.getMeta("leaves",{d:e,a:t})>0)return t};this.findParent=function(e){return this.getMeta("parentPos",e)};this.findAncestors=function(e){var t,n=[],r=this.asAPos(e);for(t=0;t<this.getMeta("hierarchy",{d:e.d}).length;t++){r=this.findParent({d:e.d,a:r});if(r!=null)n.push(r);else return n}};this.findChildren=function(e,t){var n=this.getMeta("childrenPos",e);return this.liveFilter(e.d,n,t)};this.findDescendants=function(e,t){var n,r,i=[],s=za.flatten(this.findChildren(e,t));while(s!=null&&s.length>0){r=[];for(n=0;n<s.length;n++){i.push(s[n]);r=r.concat(this.findChildren({d:e.d,a:s[n]},t))}s=r}return this.liveFilter(e.d,za.getUniques(i),t)};this.findSiblings=function(e,t){var n,r,i=[],s=this.asAPos(e);if(s instanceof Array){for(n=0;n<s.length;n++)i[n]=this.findSiblings({d:e.d,a:s[n]})}else{r=this.getMeta("parentPos",e);i=this.findMeta("parentPos",{d:e.d},r);i=za.subtract(i,s)}return this.liveFilter(e.d,i,t)};this.findRelationship=function(e,t,n){if(this.asAPos({d:e,a:t})==null)return logger("zDataCube.findRelationship(): startAPos "+zt.asString(t)+" is not valid.");if(this.asAPos({d:e,a:n})==null)return logger("zDataCube.findRelationship(): endAPos "+zt.asString(n)+" is not valid.");var r,i,s=[t].concat(this.findAncestors({d:e,a:t})),o=za.reverse([n].concat(this.findAncestors({d:e,a:n})));for(r=0;r<s.length;r++){i=za.find(o,s[r]);if(i!=null)return s.slice(0,r).concat(o.slice(i))}return[]};this.getParent=function(e){var t=this.findParent(e);if(t!=null)return this.getMetaObj({d:e.d,a:t})};this.getAncestors=function(e){var t=this.findAncestors(e);if(t!=null)return this.getMetaObj({d:e.d,a:t})};this.getChildren=function(e,t){var n=this.findChildren(e);if(n!=null)return this.getMetaObj({d:e.d,a:n})};this.getDescendants=function(e,t){var n=this.findDescendants(e);if(n!=null)return this.getMetaObj({d:e.d,a:n})};this.getSiblings=function(e,t){var n=this.findSiblings(e);if(n!=null)return this.getMetaObj({d:e.d,a:n})};this.getRelationship=function(e,t,n){var r=this.findRelationship(e,t,n);if(r!=null)return this.getMetaObj({d:e,a:r})};this.getGeneration=function(e,t,n){return za.getAllObjects(this.getMetaObj(e),"generation",t)};this.showNodes=function(e){var t,n,r,i,s=this.asAPos(e),o=this.meta[e.d].leaves;if(s instanceof Array)for(t=0;t<s.length;t++)this.showNodes({d:e.d,a:s[t]});else{n=this.findParent(e);r=this.findChildren(e);i=this.calcMeta("leaves",{d:e.d,a:r},"sum");o[e.a]=Math.max(1,i);za.shyPush(this.shown[e.d],e.a);if(n!=null)this.showNodes({d:e.d,a:n})}};this.hideNodes=function(e,t){var n,r,i,s=this.asAPos(e),o=this.meta[e.d].leaves;if(s instanceof Array)for(n=0;n<s.length;n++)this.hideNodes({d:e.d,a:s[n]});else{r=this.findParent(e);i=this.findDescendants(e);o[e.a]=0;za.remove(this.shown[e.d],i);if(r!=null)this.hideNodes({d:e.d,a:r},true);if(!t){this.setMeta("leaves",{d:e.d,a:i},0);za.remove(this.shown[e.d],i)}}};this.calcHierarchyDec=function(e){logger("zDataCube.calcHierarchyDec(): Calculating positions for the hierarchy tree.");var t=this,n,r,i,s,o,u=t.meta[e].hierarchy,a=t.calcMeta("leaves",{d:e,a:u[0]},"sum"),f=function(n,r){var i,s,o;for(i=0;i<n.length;i++){s={d:e,a:n[i]};o=t.getMeta("leaves",s)/a;t.setMeta("pos",s,{start:r,mid:r+.5*o,end:r+=o})}};f(u[0],0);for(n=0;n<u.length-1;n++)for(r=0;r<u[n].length;r++){i={d:e,a:u[n][r]};s=t.getMeta("pos",i).start;o=t.findChildren(i);f(o,s)}};this.calcHierarchyData=function(e,t){var n,r,i,s,o,u,a,f,l,c=this.getMeta("hierarchy",{d:t}),h=this.listSpaces({as:"all"},{d:t,a:"na"});for(i=c.length-2;i>=0;i--)for(s=0;s<c[i].length;s++){n={d:t,a:c[i][s]};o=this.findChildren(n,true);if(o)for(r=0;r<h.length;r++){u=this.addSpaces(h[r],n);a=this.addSpaces(h[r],{d:t,a:o});f=this.getData(e,{as:u});l=this.calcData(e,{as:a},"sum");if(f!=null&&f!=l)logger("zDataCube.setNodeData(): UH OH - Node "+u+" has a value of "+f+" for "+e+" but its children have a value of "+l+".");this.setData(e,{as:u},l)}}};this.disaggregate=function(e){var t=this.asAPos(e),n=za.asArray(this.findChildren(e));if(!n||!n.length)return;this.setShown(e.d,za.insert(this.shown[e.d],n,t))};this.aggregate=function(e){var t=this.asRPos(e),n=this.findParent(e),r=this.findChildren({d:e.d,a:n});if(n==null)return;this.shown[e.d][t]=n;this.setShown(e.d,za.subtract(this.shown[e.d],r))};this.autoAggregate=function(e,t){var n,r,i,s,o=e.d,u=this.asAPos(e),a=this.meta[o].hierarchy;if(!a)return u;for(n=a.length-2;n>=0;n--)for(r=0;r<a[n].length;r++){i=a[n][r];s=this.findChildren({d:o,a:i});if(za.isSubset(s,u)){u[za.find(u,s[0])]=i;u=za.subtract(u,s)}}if(!t)this.shown[o]=u;return u};this.treemap=function(e,t,n){var r,i,s,o,u,a,f,l,c=[],h=this.getMetaObj(e),p=za.sum(za.getAll(t,0,">")),d=n instanceof zLayout?n.getVitals():zp.completeBox(n),v=d.xAlign=="right"?"right":"left",m=d.yAlign=="bottom"?"bottom":"top",g=v=="right"?-1:1,y=m=="bottom"?-1:1;for(r=0;r<h.length;r++){h[r].area=isNaN(t[r])||t[r]<=0?0:d.width*d.height*t[r]/p}h=za.sortObjects(h,"area",true);for(r=0;r<h.length;null){o=[h[r]];u=Math.min(d.width,d.height)-Math.sqrt(h[r].area);for(r++;r<h.length&&u>=0;r++){u-=Math.sqrt(h[r].area);o.push(h[r])}a=za.sum(za.extract(o,"area"))/Math.min(d.width,d.height);if(a<=0){for(i=0;i<o.length;i++){s=o[i];this.setMeta("layout",{d:e.d,a:s.a},{x:d[v],y:d[m],width:0,height:0,xAlign:v,yAlign:m})}}else if(d.width<d.height){f=d[v];for(i=0;i<o.length;i++){s=o[i];this.setMeta("layout",{d:e.d,a:s.a},{x:f,y:d[m],width:s.area/a,height:a,xAlign:v,yAlign:m});f+=g*s.area/a}d[m]+=y*a;d.height-=a}else{l=d[m];for(i=0;i<o.length;i++){s=o[i];this.setMeta("layout",{d:e.d,a:s.a},{x:d[v],y:l,width:a,height:s.area/a,xAlign:v,yAlign:m});l+=y*s.area/a}d[v]+=g*a;d.width-=a}}};this.importCSV=function(e,t){t=t||"sheet";logger("zDataCube.importCSV(): Reading "+e.name+".");var n=this,r=new FileReader;r.onloadend=function(){var e=("[["+this.result.substr(0,this.result.length-1)+"]]").replace(/\n/g,"],[").replace(/\[\,/g,"[null,").replace(/\,\]/g,",null]").replace(/\,\,/g,",null,").replace(/\,\,/g,",null,");if(t=="sheet")n.importSheet(JSON.parse(e));else if(t=="strip")n.importStrip(JSON.parse(e));logger("zDataCube.importCSV(): "+e.length+" lines read.")};r.readAsText(e)};this.importSheet=function(e,t){t=t||"val";var n,r,i,s,o;for(s=1;e[s][0]!=null;s++);for(o=1;e[0][o]!=null;o++);for(n=1;n<o;n++){i=za.getDeep(e,["all",n]);this.setMeta(i[0],{d:0},i.slice(s))}for(n=1;n<s;n++){i=e[n];this.setMeta(i[0],{d:1},i.slice(o))}e.splice(0,s);for(n=0;n<e.length;n++)e[n].splice(0,o);this.data[t]=e;this.setShown();this.makeHierarchy();return this};this.importStrip=function(e,t){var n,r,i,s,o,u,a,f=[],l={};for(n=0;n<e[0].length;n++){r=e[0][n].split("~");if(r.length==2){i=r[0];o=r[1];f[i]=f[i]||{};if(f[i][o])logger("zDataCube.importStrip(): UH OH - "+f[i][o]+" already exists.");f[i][o]=n}else if(r.length==1){o=r[0];l[o]=n}else logger("zDataCube.importStrip(): UH OH - I don't understand header "+e[0][n]+". Metadata headers should be [dimension]~[type] (e.g. '0~name'), data headers should be [type] (e.g. 'data').")}if(zo.isEmpty(l))logger("zDataCube.importStrip(): UH OH - no data found in strip.");if(zo.isEmpty(f))logger("zDataCube.importStrip(): UH OH - no metadata found in strip.");for(i=0;i<f.length;i++)if(f[i].name==null)logger("zDataCube.importStrip(): UH OH - no name found for dimension "+i+".");if(!t)this.initialise(f.length);for(s in l)this.addDataType(s);for(n=1;n<e.length;n++){u=e[n];a=[];for(i=0;i<this.dLen;i++){a[i]=this.findMeta("name",{d:i},u[f[i].name]);if(a[i]==null){r={};for(s in f[i])r[s]=u[f[i][s]];a[i]=this.shyPushMeta(null,i,r)}}for(s in l)this.setData(s,{as:a},u[l[s]])}this.setShown();this.makeHierarchy();return this};this.importDumb=function(e){this.meta[0]["name"]=e||[];this.setShown();return this};this.importProtoCube=function(e){this.dLen=e.meta.length;this.meta=e.meta;this.data=e.data;this.setShown();var t,n,r,i=this.getSize();for(n in this.data){r=za.deepLength(this.data[n]);if(r.length!=i.length){logger("zDataCube.importProtoCube(): Data type "+n+" has "+r.length+" dimensions but "+i.length+" dimensions have been defined in meta.")}for(t=0;t<this.dLen;t++)if(r[t]!=i[t]){logger("zDataCube.importProtoCube(): Data type "+n+" has "+r[t]+" elements in dimension "+t+" but meta has "+i[t]+" elements: "+zt.asString(this.meta[t].name)+".")}}return this};this.exportProtoCube=function(){return{meta:zo.clone(this.meta),data:zo.clone(this.data)}};this.madroxClone=function(){var e=new zDataCube(this.dLen);e.meta=this.meta;e.data=this.data;e.shown=zo.clone(this.shown);e.oldShown=zo.clone(this.oldShown);return e};this.initialise=function(e){this.meta=[];this.shown=[];this.oldShown=[];this.data={};this.dLen=e;for(var t=0;t<e;t++){this.meta[t]={name:[]};this.shown[t]=[];this.oldShown[t]=[]}};this.type="zDataCube";this.initialise(e)}function zSwarmConstructor(e,t,n){zo.shyExtend(e,{forSwarms:function(t,n,r,i,s,o,u){for(var a=e.swarms.length-1;a>=0;a--){if(typeof t=="function")t(e.swarms[a],n,r,i,s,o,u);else if(e.swarms[a][t])e.swarms[a][t](n,r,i,s,o,u)}},forOwnedSwarm:function(t,n,r,i,s,o,u){for(var a=e.swarms.length-1;a>=0;a--)if(e.swarms[a]!=e){if(typeof t=="function")t(e.swarms[a],n,r,i,s,o,u);else if(e.swarms[a][t])e.swarms[a][t](n,r,i,s,o,u)}},forDrones:function(t,n,r,i,s,o,u,a){var f,l=e.get(t);if(!l)return;if(typeof n=="string"){for(f=l.length-1;f>=0;f--){if(l[f][n]){if(l[f].class=="zSwarm")l[f][n]("swarm",r,i,s,o,u,a);else l[f][n](r,i,s,o,u,a)}}}else if(typeof n=="function"){for(f=l.length-1;f>=0;f--){n(l[f])}}},forRoles:function(t,n,r,i,s,o,u){for(var a in e.P)if(e.P[a]&&!e.P[a].ignore)t(e.P[a])},lock:function(){if(e.locked!="Superlocked")e.locked=Math.round(Math.random()*9e3)+999},unlock:function(){if(e.locked!="Superlocked")e.locked=null},superLock:function(){e.locked="Superlocked"},superUnlock:function(){e.locked=null},getRole:function(t){var n=t.role?t.role:typeof t=="string"&&t!="all"&&t!="mask"&&t!="fixed"?t:null;return n?e.P[n]:null},addDimension:function(t){if(t!=null&&t.d==null&&(t.a!=null||t.r!=null||t.as||t.rs))t.d=e.d;return t},asAPos:function(t){return e.dc.asAPos(e.addDimension(t))},asRPos:function(t){return e.dc.asRPos(e.addDimension(t))},asASpace:function(t){return e.dc.asASpace(e.addDimension(t))},asRSpace:function(t){return e.dc.asRSpace(e.addDimension(t))},setSpace:function(t,n,r,i,s){var o=t.d==null?e.d:t.d,u=e.asAPos(t),a=e.asRPos(t);if(a!=null){if(typeof a=="number"){if(u==null)return logger(e.type+".setSpace(): Found rPos for "+zt.asString(t)+", but it doesn't match to a valid aPos.");if(typeof e.R[o]=="number")e.R[o]=a;e.forRoles(function(t){if(t.mask=="fixed")return;if(t.mask[o]=="number")t.mask[o]=a;if(typeof e.dc.addSpaces(e.R,t.mask)[o]=="number"){e.forDrones(t.name,function(e){e.A[o]=u})}})}else if(a instanceof Array){if(e.R[o]instanceof Array||e.R[o]=="all"){e.R[o]=a.slice();e.forRoles(function(t){if(t.mask[o]!="mask")return;e.forDrones(t.name,function(t){if(!za.contains(u,t.A[o]))t.remove(n,r,null,s||e.K)});e.add(t.name,n,r,null,s||e.K)});if(!s||i)e.G.redraw(n,r,i,s)}else explode(e.type+".setSpace(): Can't change "+zt.asString(e.R[o])+" to "+zt.asString(a)+".")}else explode(e.type+".setSpace(): "+za.asString(t)+" contains rPos ("+za.asString(a)+"), but is neither an array nor a number.")}else logger(e.type+".setSpace(): No rPos or rMask specified ("+zt.asString(t)+").")},disaggregate:function(t,n,r,i,s){if(t.d==null)t.d=e.d;var o=e.dc.asAPos(t),u=e.dc.findChildren(t);if(!u||!u.length)return;e.dc.disaggregate(t);e.updateData(n,r,null,s);e.add({d:t.d,a:u,mode:{disaggregate:true}},n,r,null,s);e.remove({d:t.d,a:o},n,r,i,s)},aggregate:function(t,n,r,i,s){if(t.d==null)t.d=e.d;var o=e.dc.findParent(t),u=e.dc.findChildren({d:t.d,a:o});if(o==null)return;e.dc.aggregate(t);e.updateData(n,r,null,s);e.add({d:t.d,a:o},n,r,null,s);e.remove({d:t.d,a:u,mode:{aggregate:true}},n,r,i,s)},get:function(t){if(t instanceof Array)return t;else if(t==null||t=="swarm"||t=="all"||t.all)return e.drones;else if(t=="curr"||t.curr)return e.currDrones;else if(t=="fixed")return za.getAllObjects(e.drones,"A","fixed");else if(t.string||typeof t=="string")return za.getAllObjects(e.drones,"role",t.string||t);else if(t.role&&t.d==null)return za.getAllObjects(e.drones,"role",t.role);var n,r,i,s=e.asASpace(t),o=t.role?za.getAllObjects(e.drones,"role",t.role):e.drones;for(n=0;n<s.length;n++){if(o.length==0)break;if(typeof s[n]=="number"){o=za.getAllObjects(o,"A",s[n],"atPos",n)}else if(s[n]instanceof Array){i=[];for(r=0;r<o.length;r++){if(za.contains(s[n],o[r].A[n]))i.push(o[r])}o=i}}return o},setCurrDrones:function(t){return e.currDrones=e.get(t)},plot:function(t,n){var r,i,s=e.get(t),o=t&&t.mode?t.mode:{};for(r=0;r<s.length;r++){i=s[r];i.oldOrders=i.currOrders;i.newOrders=e.P[i.role].curr?e.P[i.role].curr(e,i.A,i,e.Y[i.role],o):{};i.noChange=!n&&zo.equals(i.newOrders,i.oldOrders);zo.extend(i.O,i.parseOrders(i.newOrders))}},layer:function(){var t,n,r=[],i=function(e){var t=e.O.layer*1;if(t!=null&&!isNaN(t)){r[t]=r[t]||[];r[t].push(e)}else if(e.type=="zMultiDrone"){for(n in e.parts)i(e.parts[n])}};e.forDrones("all",i);for(t=0;t<r.length;t++)if(r[t])e.forDrones(r[t],"toFront")},addDrone:function(t,n,r,i,s,o,u){var a,f=e.P[t],l={id:zt.asString(n)+" "+t,A:n,role:t,parent:e,directRedraw:f.directRedraw};if(za.getObject(e.drones,"id",l.id))return;l.currOrders=f.curr?f.curr(e,n,l,e.Y[t],r)||{}:{};a=zo.clone(e.Y[t]);a=zo.extend(a,l.currOrders);a=zo.extend(a,f.init?f.init(e,n,l,e.Y[t],r)||{}:{});if(a.ignore)return;else if(typeof f.type=="string"||typeof f.type=="function"){l=zo.extend(zDrones.make(f.type,a,i,s,o,u),l);e.drones.push(l);if(l.O.onAdd)l.O.onAdd(l);if(l.O.mouseEvents)l.O.mouseEvents(l)}else logger(e.type+".addDrone(): Plan.type ("+f.type+" is invalid.")},addRole:function(t,n,r,i,s,o,u){if(t.mask=="fixed")e.addDrone(t.name,"fixed",r,i,s,o,u);else{var a,f=e.dc.listSpaces({rs:t.rSpace||n},{rs:t.mask});for(a=0;a<f.length;a++){e.addDrone(t.name,e.asASpace({rs:f[a]}),r,i,s,o,u);o=null}}},add:function(t,n,r,i,s){var o=e.getRole(t),u=zo.extend({initialising:true},t.mode),a=e.dc.addSpaces(e.R,typeof t=="string"?null:e.asRSpace(t));u.initialising=true;if(o){o.ignore=false;e.addRole(o,a,u,n,r,null,s||e.K)}else if(t=="fixed"){e.forRoles(function(t){if(t.mask=="fixed")e.addRole(t,a,u,n,r,null,s||e.K)})}else{e.forRoles(function(t){if(t.mask!="fixed")e.addRole(t,a,u,n,r,null,s||e.K)})}e.layer();if(!s||i)e.G.redraw(n,r,i,s)},remove:function(t,n,r,i,s){if(t=="swarm"){if(n){e.clearEvents();e.hide("all",n,r,function(){e.remove("swarm",null,null,i)},s)}else{e.markOfDeath=true;if(e.parent&&e.parent.drones)za.remove(e.parent.drones,e);e.forDrones("all","remove");delete e;if(i)i()}}else{var o=e.getRole(t);if(o)o.ignore=true;e.forDrones(t,"remove",n,r,null,s||e.K);if(!s||i)e.G.redraw(n,r,i,s)}},show:function(t,n,r,i,s){e.forDrones(t,"show",n,r,null,s||e.K);if(!s||i)e.G.redraw(n,r,i,s)},hide:function(t,n,r,i,s){e.forDrones(t,"hide",n,r,null,s||e.K);if(!s||i)e.G.redraw(n,r,i,s)},invisibleShow:function(t){e.forDrones(t,"invisibleShow")},appear:function(t,n,r,i,s){e.forDrones(t,"appear",n,r,null,s||e.K);if(!s||i)e.G.redraw(n,r,i,s)},toFront:function(t){e.forDrones(t,"toFront")},toBack:function(t){e.forDrones(t,"toBack")},parseOrders:function(e){return e},animate:function(t,n,r,i,s,o){e.forDrones(t,"animate",n,r,i,null,o||e.K);if(!o||s)e.G.redraw(r,i,s,o)},frameRedraw:function(t,n){e.forDrones(t,function(e){e.currOrders=zo.mid(n,e.oldOrders,e.newOrders);if(e.class=="zSwarm")e.refresh("all");else e.redraw(e.currOrders);if(e.O.onRedraw)e.O.onRedraw(e)});e.currDec=n;e.frame++},redraw:function(t,n,r,i,s,o){e.forDrones(t,"redraw",n,r,i,null,o||e.K);if(!o||s)e.G.redraw(r,i,s,o)},refresh:function(t,n,r,i,s){var o,u,a=[],f=[],l=e.thread=Math.round(Math.random()*1e3),h=t&&t.mode?t.mode:{},p=e.setCurrDrones(t);e.frame=0;if(e.currDec<1)e.frameRedraw(p,e.currDec,true);if(!h.noUpdateData&&e.updateData)e.updateData(n,r,null,e.K);e.plot({curr:true,mode:h});e.preRedraw(p);if(h.forceFrameRedraw)a=p;else if(h.forceDirectRedraw)f=p;else{a=p.slice();f=za.removeAllObjects(a,"directRedraw",true)}za.removeAllObjects(a,"noChange",true);za.removeAllObjects(a,"markOfDeath",true);za.removeAllObjects(f,"noChange",true);za.removeAllObjects(f,"markOfDeath",true);if(e.currDec==1){e.clearEvents("all");e.G.onAnimation(function(){e.frameRedraw(a,e.G.getVal())})}e.G.redraw(n,r,function(){if(e.thread!=l)return;e.G.onAnimation();e.frameRedraw(p,1);e.postRedraw(p);e.mouseEvents("all");if(i)i()},s);for(o=0;o<f.length;o++){u=f[o];u.redraw(u.newOrders,n,r,null,e.K)}},stop:function(t){e.G.stop();e.forDrones(t,"stop")},setOrders:function(t,n,r,i,s,o){e.forDrones(t,"setOrders",n,r,i,null,o||e.K);if(!o||s)e.G.redraw(r,i,s,o)},addOrders:function(t,n,r,i,s,o){e.forDrones(t,"addOrders",n,r,i,null,o||e.K);if(!o||s)e.G.redraw(r,i,s,o)},setMode:function(t,n,r,i,s,o){e.forDrones(t,"setMode",n,r,i,null,o||e.K);if(!o||s)e.G.redraw(r,i,s,o)},unsetMode:function(t,n,r,i,s){e.forDrones(t,"unsetMode",n,r,null,s||e.K);if(!s||i)e.G.redraw(n,r,i,s)},highlight:function(t,n,r,i,s){var o=e.asAPos(t),u=za.subtract(o,e.highlighted),a=za.subtract(e.highlighted,o);e.forDrones({d:t.d==null?e.d:t.d,a:a},"reset",n,r,null,s||e.K);e.forDrones({d:t.d==null?e.d:t.d,a:u},"highlight",n,r,null,s||e.K);if(!s||i)e.G.redraw(n,r,i,s);e.highlighted=o},reset:function(t,n,r,i,s){e.forDrones(t,"reset",n,r,null,s||e.K);if(!s||i)e.G.redraw(n,r,i,s);e.highlighted=[]},select:function(t,n,r,i,s){e.forDrones(e.selected,"deselect",n,r,null,s||e.K);e.forDrones(t,"select",n,r,null,s||e.K);e.oldSelected=e.selected;e.selected={d:e.d,a:e.asAPos(t),r:e.asRPos(t)};if(!s||i)e.G.redraw(n,r,i,s)},deselect:function(t,n,r,i,s){e.unsetMode(t,n,r,i,s)},clearEvents:function(t){e.forDrones(t,"clearEvents")},enableEvents:function(t){e.forDrones(t,"enableEvents")},disableEvents:function(t){e.forDrones(t,"disableEvents")},click:function(t,n){e.forDrones(t,"click",n)},dblclick:function(t,n){e.forDrones(t,"dblclick",n)},mousedown:function(t,n){e.forDrones(t,"mousedown",n)},mouseup:function(t,n){e.forDrones(t,"mouseup",n)},mousemove:function(t,n){e.forDrones(t,"mousemove",n)},touchstart:function(t,n){e.forDrones(t,"touchstart",n)},touchMove:function(t,n){e.forDrones(t,"touchMove",n)},touchend:function(t,n){e.forDrones(t,"touchend",n)},touchcancel:function(t,n){e.forDrones(t,"touchcancel",n)},hover:function(t,n,r){e.forDrones(t,"hover",n,r)},drag:function(t,n,r,i){e.forDrones(t,"drag",n,r,i)},onAnimation:function(t,n){e.forDrones(t,"onAnimation",n)},hoverHighlight:function(t,n,r){e.forDrones(t,"hoverHighlight",n,r)},tooltip:function(t,n,r,i){e.forDrones(t,"tooltip",n,r,i)},mouseEvents:function(t){e.clearEvents(t);e.forDrones(t,function(e){if(e.O.mouseEvents)e.O.mouseEvents(e);else if(e.mouseEvents)e.mouseEvents("all")})},preRedraw:function(t,n,r,i,s){e.forDrones(t,function(e){if(e.O.preRedraw)e.O.preRedraw(e,n,r,i,s);else if(e.preRedraw)e.preRedraw("all",n,r,i,s)})},postRedraw:function(t,n,r,i,s){e.forDrones(t,function(e){if(e.O.postRedraw)e.O.postRedraw(e,n,r,i,s);else if(e.postRedraw)e.postRedraw("all",n,r,i,s)})},zoom:function(t,n,r,i,s,o){e.L.zoom(t,n);e.refresh("all",r,i,s,o)},move:function(t,n,r,i,s){e.L.set(t);e.refresh("all",n,r,i,s)},initialise:function(t,n){var r;e.type=n;e.class="zSwarm";e.drones=[];e.axes={};e.style={};e.plan={};e.layout={};e.highlighted=[];for(r in t)e[r]=t[r];for(r in e.plan){if(e.plan[r]){e.plan[r].name=r;if(e.plan[r].mask!="fixed")e.plan[r].mask=e.dc.parseSpace(e.plan[r].mask)}else delete e.plan[r]}if(e.layout instanceof zLayout){if(e.style.margin!=null)e.layout.set({margin:e.style.margin})}else{if(e.style.margin!=null)e.layout.margin=e.style.margin;e.layout=new zLayout(e.layout)}e.currDec=1;e.guide=new zGuide(true);e.guide.parent=e;e.O=t;e.P=e.plan;e.L=e.layout;e.Y=zt.parseStyle(e.style);e.R=e.rSpace;e.G=e.guide;e.K=e.G.K;if(e.axes)for(r in e.axes)if(e.axes[r].swarms)e.axes[r].swarms.push(e)}});e.initialise(t,n)}function zAxisConstructor(e,t){zSwarmConstructor(e,zo.extend({dc:null,d:null,rSpace:null,range:[],selected:null,swarms:[e],layout:{rotation:0},style:{extension:.5,perpendicularSize:1,parallelSize:.6,select:{t:500,e:"<>"},highlight:{t:200,e:"-"},background:null,axisLine:{},axisTitle:{},label:{margin:5,branch:null}},pointToRPos:function(t){var n=e.L.getDec(t).x;return zt.mid(n,e.range[0]-e.Y.extension,e.range[1]+e.Y.extension)},pointToAPos:function(t){var n=Math.round(zt.forceBetween(e.pointToRPos(t),e.range[0],e.range[1]));return e.asAPos({d:e.d,r:n})},getOffset:function(t){var n=e.asRPos(t),r=zt.calcDec(n,e.range[0]-e.Y.extension,e.range[1]+e.Y.extension);return e.L.getOffset(r,e.L.yAlign=="yCentre"?.5:0,true)},addOffset:function(t,n){return zp.addPoints(e.getOffset(t),n)},getPoint:function(t){return e.addOffset(t,e.L)},getX:function(t){return e.getPoint(t).x},getY:function(t){return e.getPoint(t).y},getLength:function(t){return e.L.width*t/(e.range[1]-e.range[0]+2*(e.Y.extension||0))},setShown:function(t){t=t||e.dc.shown[e.d];if(e.Y.maxNotches){e.trimmedShown=[];var n,r=zt.getMaxFactor(t.length-1,e.Y.maxNotches),i=(t.length-1)/r;for(n=0;n<=r;n++)e.trimmedShown[n]=t[i*n]}else if(e.Y.notchStep){e.trimmedShown=[];for(var n=za.min(t);n<=za.max(t);n+=e.Y.notchStep)e.trimmedShown.push(n)}e.dc.setShown(e.d,t);e.range=[0,Math.max(e.dc.getSize(e.d,true)-1,1)]},axisSelect:function(t,n,r,i,s){if(!t.forced&&e.asRPos(t)==e.selected.r)return;e.select(t,n,r,i,s);e.forOwnedSwarm("setSpace",t);e.forSwarms("refresh","all",n,r,null,e.K);if(e.onSelect)e.onSelect(n,r,null,s||e.K)},replace:function(t,n,r,i,s){e.setShown(t);e.forSwarms("updateData",n,r,null,e.K);e.forSwarms("add",{a:za.subtract(e.dc.shown[e.d],e.dc.oldShown[e.d])},n,r,null,e.K);e.forSwarms("remove",{a:za.subtract(e.dc.oldShown[e.d],e.dc.shown[e.d])},n,r,null,e.K);e.forSwarms("layer");if(!s||i)e.G.redraw(n,r,i,s)},disaggregate:function(t,n,r,i,s){if(t.d==null)t.d=e.d;var o=e.dc.asAPos(t),u=e.dc.findChildren(t);if(!u||!u.length)return;e.forSwarms("add",{d:t.d,a:u,mode:{disaggregate:true}});e.forSwarms("remove",{d:t.d,a:o});e.forSwarms("refresh","all",n,r,null,e.K);e.G.redraw(n,r,i,s)},aggregate:function(t,n,r,i,s){if(t.d==null)t.d=e.d;var o=e.dc.findParent(t),u=e.dc.findChildren({d:t.d,a:o});if(o==null)return;e.forSwarms("refresh",{d:t.d,a:u,mode:{aggregate:true}},n,r,null,e.K);e.G.redraw(n,r,function(){e.forSwarms("add",{d:t.d,a:o});e.forSwarms("remove",{d:t.d,a:u});if(i)i()},s)},plan:{axisLine:{type:"zLine",mask:"fixed",curr:function(e,t,n,r){return{layer:10,points:[e.L.getPoint(0,0),e.L.getPoint(1,0)]}}},axisTitle:{type:"zTextBox",mask:"fixed",init:function(e,t,n,r){var i=zt.isBetween(e.L.rotation,90,270)?zp.inverseDeg(e.L.rotation):e.L.rotation;return{text:e.title,layout:{anchor:e.L.getPoint(.5,1),xAlign:"xCentre",yAlign:"top",rotation:i}}}},label:{type:"zTextBox",mask:"mask",init:function(t,n,r,i){if(t.trimmedShown&&!za.contains(t.trimmedShown,n[t.d]))return{ignore:true};return{layer:1,text:t.dc.getName({d:t.d,a:n[t.d]}),layout:t.L.yAlign=="yCentre"?{xAlign:"xCentre",yAlign:"yCentre"}:{radial:(t.L.rotation||0)+(t.L.yAlign=="top"?90:-90),radialEnd:e.notchHeight},mouseEvents:t.baseMouseEvents}},curr:function(e,t,n,r){return{layout:e.getPoint({a:t[e.d]})}}}}},t),"zUndefinedAxis");e.R=za.fill("na",e.dc.dLen);e.R[e.d]="all";e.maxShown=e.Y.collapsedShown||e.Y.expandedShown;e.setShown()}function zAxis(e,t,n,r,i){var s=this;zAxisConstructor(s,zo.extend({type:"zAxis",dc:(new zDataCube(1)).importDumb(),d:0,rSpace:["all"],range:[0,100],title:null,layout:{rotation:0},style:{extension:0,maxNotches:10,label:{format:{dp:10},radialStart:0,radialEnd:6,margin:10}},getOffset:function(e){return s.L.getOffset(zt.calcDec(e,s.range[0],s.range[1]),0,true)},setShown:function(e,t,n,r,i){e=e||s.range;if(isNaN(e[0])||isNaN(e[1])||e[0]==e[1])return logger("zAxis(): Called with invalid range "+zt.asString(e));var o,u,a,f,l,h=[],e=za.sort([e[0],e[1]]);u=(e[1]-e[0])/(s.Y.maxNotches||10);u=zt.getFactorOfTen(u);if(s.label)u=Math.max(u,1);if(s.Y.minNotchGap)u=Math.max(u,s.Y.minNotchGap);a=u*Math.ceil(e[0]/u);for(o=a;o<=e[1];o=zt.roundTo(o+u,10))h.push(o);f=za.subtract(s.dc.shown[0],h);l=za.subtract(h,s.dc.shown[0]);s.dc.setShown(0,h);if(s.P["label"]&&!s.P["label"].ignore)s.add("label");if(s.P["gridLine"]&&!s.P["gridLine"].ignore)s.add("gridLine");if(t==null||PAPER.noAnimation)s.remove({a:f});s.range=e;s.refresh("all",t,n,r,i)},plan:{label:{type:"zTextBox",mask:"mask",init:function(e,t,n,r){return{text:t[0],layout:{radial:(e.L.rotation||0)+(e.L.yAlign=="top"?90:-90),radialStart:r.radialStart,radialEnd:r.radialEnd},branch:t[0]==0?r.baseBranch:r.branch}},curr:function(e,t,n,r){var i=e.asRPos({a:t[0]})!=null,s=zt.isBetween(t[e.d],e.range[0],e.range[1]);return{layout:{anchor:e.getPoint(t[0])},onAdd:function(e){if(!s)e.hide()},onRedraw:n.hidden&&s?function(t){if(!e.L.contains(t.L))return;t.show();t.O.onRedraw=null}:!n.hidden&&!s?function(t){if(e.L.contains(t.L))return;t.remove()}:!i?function(e){e.remove()}:null}}}}},e));if(s.updateData)s.updateData(t,n,null,s.K);s.add("fixed",t,n,null,s.K);s.add("all",t,n,r,i);s.layer()}function zSmartAxis(e,t,n,r,i){var s=this;zAxisConstructor(s,zo.extend({type:"zSmartAxis",updateData:function(){if(s.Y.parallelSize)s.notchWidth=s.Y.parallelSize*s.L.innerWidth/s.dc.getSize(s.d,true);if(s.Y.perpendicularSize)s.notchHeight=s.Y.perpendicularSize*s.L.height}},e));if(s.baseSelected)s.baseSelected={d:s.d,a:s.asAPos(s.baseSelected),r:s.asRPos(s.baseSelected)};if(s.selected)s.selected={d:s.d,a:s.asAPos(s.selected),r:s.asRPos(s.selected)};if(s.updateData)s.updateData(t,n,null,s.K);s.add("fixed",t,n,null,s.K);s.add("all",t,n,r,i);s.layer();if(s.selected)s.axisSelect({forced:true,a:s.selected.a,r:s.selected.r},t,n,null,s.K)}function zLegend(e,t,n,r,i){return new zSmartAxis(zo.extend({type:"zLegend",style:{notch:{rounded:0,"stroke-opacity":.2,highlight:{"stroke-opacity":1},select:{"stroke-opacity":1}}},plan:{notch:{init:function(e,t,n,r){return{fill:e.dc.getMeta("colour",{d:e.d,a:t[e.d]})}}}}},e),t,n,r,i)}function zSelectAxis(e,t,n,r,i){return new zSmartAxis(zo.extend({type:"zSelectAxis",baseMouseEvents:function(e){var t=e.parent,n={d:t.d,a:e.A[t.d]},r=t.Y.highlight,i=t.Y.select;e.click(function(){t.axisSelect(n,i.t,i.e)});e.hover(function(){t.highlight(n,r.t,r.e)},function(){t.reset(n,r.t,r.e)})}},e),t,n,r,i)}function zMultiSelectAxis(e,t,n,r,i){return new zSelectAxis(zo.extend({type:"zMultiSelectAxis",selected:{a:[],r:[]},axisSelect:function(e,t,n,r,i){var s=this;s.select(e,t,n,r,i);s.forOwnedSwarm("setSpace",e);s.forSwarms("refresh","all",t,n,null,s.K);if(s.onSelect)s.onSelect(t,n,null,i||s.K)},select:function(e,t,n,r,i){var s,o=this,u=o.asRPos(e);if(za.isEmpty(u))return;u=za.asArray(u);for(s=0;s<u.length;s++){if(za.contains(o.selected.r,u[s])){za.remove(o.selected.r,u[s]);o.forDrones({r:u[s]},"deselect",t,n,null,i||o.K)}else{o.selected.r.push(u[s]);o.forDrones({r:u[s]},"select",t,n,null,i||o.K)}}o.selected.a=o.asAPos({r:o.selected.r});if(!i||r)o.G.redraw(t,n,r,i)}},e),t,n,r,i)}function zDragSelectAxis(e,t,n,r,i){return new zSmartAxis(zo.extend({type:"zDragSelectAxis",selected:{a:[],r:[]},baseMouseEvents:function(e){var t=e.parent,n={d:t.d,a:e.A[t.d]},r=t.Y.highlight,i=t.Y.select;e.drag(null,function(){t.dragRange=[n.a,n.a];t.deselect({a:"all"},r.t,r.e);t.select({a:[n.a]},r.t,r.e)},function(){if(!t.dragRange)return;t.axisSelect({a:za.fillRange(t.dragRange)},i.t,i.e);t.dragRange=null});e.hover(function(){if(!t.dragRange)return t.highlight({a:e.A[t.d]},r.t,r.e);t.dragRange[1]=n.a;t.highlight({a:za.fillRange(t.dragRange)},r.t,r.e)},function(){if(!t.dragRange)return t.reset({a:e.A[t.d]},r.t,r.e)})}},e),t,n,r,i)}function zScrollAxis(e,t,n,r,i){var s=new zSmartAxis(zo.extend({type:"zScrollAxis",expanded:true,style:{collapsedShown:1,expandedShown:8,expand:{t:500,e:"<>"},scroll:{t:500,e:"<>"},label:{"font-size":14,"font-weight":"bold",fill:"#ccc",opacity:.8,highlight:{opacity:1},select:{opacity:1,"font-size":28}},upArrow:{xSize:20,ySize:40,fill:"#fff",opacity:.3,highlight:{opacity:1}},downArrow:{xSize:20,ySize:40,fill:"#fff",opacity:.3,highlight:{opacity:1}}},baseMouseEvents:function(e){var t=e.parent,n={d:t.d,a:e.A[t.d]},r=t.Y.highlight,i=t.Y.expand;e.click(function(){if(t.expanded)t.collapse(n,i.t,i.e);else t.expand(i.t,i.e)});e.hoverHighlight(r.t,r.e)},scroll:function(e,t,n,r,i){var s=this,o;if(s.maxShown>=s.dc.getSize(s.d,true))s.range=[0,s.maxShown-1];else{o=zt.forceBetween(s.asRPos(e),0,s.dc.getSize(s.d,true)-1);s.range=[o-(s.maxShown-1)/2,o+(s.maxShown-1)/2]}s.refresh("all",t,n,r,i)},scrollBy:function(e,t,n,r,i){var s=this,o;if(!s.expanded)s.expand(t,n,function(){s.scrollBy(e,t,n,r,i)},i);else{o=za.mean(s.range)+e;s.scroll({r:o},t,n,r,i)}},scrollSelect:function(e,t,n,r,i){var s=this;s.select(e,t,n,function(){s.scroll(e,t,n,function(){s.forSwarms("setSpace",e);s.forSwarms("refresh","all",t,n,null,s.K);s.show("axisTitle",t,n,null,i);if(s.onSelect)s.onSelect(t,n,null,i||s.K);s.G.redraw(t,n,r,i)},i)},i)},expand:function(e,t,n,r){var i=this;if(i.expanded)return;i.expanded=true;i.maxShown=i.Y.expandedShown;i.L.set({innerWidth:i.L.innerWidth*i.Y.expandedShown/i.Y.collapsedShown});i.hide("axisTitle",e,t,null,r);i.scroll({r:i.selected.r},e,t,n,r)},collapse:function(e,t,n,r,i){var s=this;if(!s.expanded)return;s.expanded=false;s.maxShown=s.Y.collapsedShown;s.L.set({innerWidth:s.L.innerWidth*s.Y.collapsedShown/s.Y.expandedShown});s.scrollSelect(e,t,n,r,i)},plan:{axisLine:null,axisTitle:{type:"zTextBox",mask:"fixed",init:function(e,t,n,r){return{layer:0,text:e.dc.getMeta("title",{d:e.d}),layout:{anchor:e.L.getPoint(0,0),xAlign:"xCentre",yAlign:"bottom"}}}},label:{curr:function(e,t,n,r){var i={d:e.d,a:t[e.d]},s=e.asRPos(i),o=e.range[0]==e.range[1]?s==e.range[0]?.5:0:zt.calcDec(s,e.range[0],e.range[1]),u=zt.isBetween(s,e.range[0],e.range[1]);return{layout:e.getPoint(i,true),opacity:u?1-Math.abs(o-.5)*1.3:0,postRedraw:function(e){if(!u)e.hide()},onRedraw:n.hidden&&u?function(t){if(!e.L.contains(t.L))return;t.invisibleShow();t.O.onRedraw=null}:!n.hidden&&!u?function(t){if(e.L.contains(t.L))return;t.hide();t.O.onRedraw=null}:null}}},upArrow:{type:"zShape",mask:"fixed",init:function(e,t,n,r){var i=e.Y.highlight,s=e.Y.scroll;return{layer:0,onAdd:function(e){e.hide()},preRedraw:function(t){if(!e.expanded||za.min(e.range)<=0)t.hide();else t.show()},mouseEvents:function(t){t.hoverHighlight(i.t,i.e);t.mousedown(function(){t.highlight(i.t,i.e,null,e.K);e.scroll({r:e.range[0]},s.t,s.e,function(){t.reset(i.t,i.e)})})}}},curr:function(e,t,n,r){var i=e.L;return{points:[{x:i.x,y:i.top-r.xSize},{x:i.x-r.ySize/2,y:i.top},{x:i.x+r.ySize/2,y:i.top}]}}},downArrow:{type:"zShape",mask:"fixed",init:function(e,t,n,r){var i=e.Y.highlight,s=e.Y.scroll,o=e.Y.expand;return{layer:0,preRedraw:function(t){if(e.expanded&&za.max(e.range)>=e.dc.getSize(e.d,true)-1)t.hide();else t.show()},mouseEvents:function(t){t.hoverHighlight(i.t,i.e);t.mousedown(function(){if(e.maxShown==e.Y.expandedShown){t.highlight(s.t,s.e,null,e.K);e.scroll({r:e.range[1]},s.t,s.e,function(){t.reset(i.t,i.e)})}else e.expand(o.t,o.e)})}}},curr:function(e,t,n,r){var i=e.L;return{points:[{x:i.x,y:i.bottom+r.xSize},{x:i.x-r.ySize/2,y:i.bottom},{x:i.x+r.ySize/2,y:i.bottom}]}}}}},e),t,n,r,i);if(s.selected)s.scroll(s.selected);return s}function zSlideAxis(e,t,n,r,i){return new zSmartAxis(zo.extend({type:"zSlideAxis",selected:{r:0},baseSelected:{r:0},style:{perpendicularSize:1,select:{t:200,e:"-"},slideBar:{fill:"#801c7e",background:{rounded:8,"stroke-width":1,"stroke-opacity":1,stroke:"#000",opacity:.2},foreground:{opacity:1}},label:{"font-family":"sans-serif",margin:7,"font-size":12,"font-weight":"bold",fill:"#666"},baseNotch:{label:{"font-size":12}},currNotch:{flagWidth:10,flagHeight:20,width:48,height:36,ring:{stroke:"#801c7e","stroke-width":3,fill:"#dedede"},label:{"font-family":"sans-serif","font-size":18,fill:"#dedede",background:null},background:{fill:"#000",opacity:.75},highlight:{opacity:1}},playButton:{background:{rounded:6,fill:"white"},foreground:{fill:"#444",stroke:null}}},setBase:function(e,t,n,r,i){this.baseSelected={d:this.d,a:this.asAPos(e),r:this.asRPos(e)};this.forSwarms("refresh","all",t,n,r,i)},axisSelect:function(e,t,n,r,i){var s=this,o=Math.round(Math.random()*1e3),u=s.dragging?{}:s.Y.highlight,a=zt.forceBetween(zp.isPoint(e)?s.pointToRPos(e):s.asRPos(e),s.range[0],s.range[1]),f=function(e,t){s.G.scripting=true;s.select({d:s.d,r:e});s.G.scripting=false;s.forSwarms("setSpace",{d:s.d,r:e});s.forSwarms("updateData");s.forSwarms("plot","all",t)};if(a==s.rTargSelected)return;s.thread=o;s.rTargSelected=Math.round(a);t*=Math.abs(a-s.selected.r);if(!s.G.animating){s.G.redrawTo(s.selected.r);s.forOwnedSwarm("clearEvents");s.forSwarms("preRedraw")}else{s.G.stop();s.G.onAnimation()}if(a>s.selected.r){s.G.onAnimation(function(){var e=s.G.getVal();if(e>s.selected.r)f(Math.ceil(e));s.forSwarms("frameRedraw","all",e-(s.selected.r-1))})}else{s.G.onAnimation(function(){var e=s.G.getVal();if(e<s.selected.r)f(Math.floor(e));s.forSwarms("frameRedraw","all",s.selected.r+1-e)})}s.G.redrawTo(s.rTargSelected,t,n,function(){if(s.thread!=o)return;s.G.onAnimation();f(s.rTargSelected,true);s.forSwarms("frameRedraw","all",1);s.forSwarms("postRedraw");s.refresh({role:"playButton",mode:{noUpdateData:true}},u.t,u.e);s.forOwnedSwarm("mouseEvents");if(r)r();s.G.animating=false},i)},plan:{axisLine:null,slideBar:{type:"zMultiDrone",mask:"fixed",init:function(e,t,n,r){var i=e.Y.select;return{layer:0,mouseEvents:function(t){t.click(function(t){e.axisSelect(zt.getEventPosition(t),i.t,i.e)})},background:{type:"zRectangle",layout:{anchor:e.getPoint({r:0}),height:e.notchHeight,width:e.getLength(e.range[1])}},foreground:{type:"zRectangle",layout:{height:e.notchHeight}}}},curr:function(e,t,n,r){return{foreground:{layout:{anchor:e.getPoint(e.baseSelected),width:e.getLength(e.selected.r-e.baseSelected.r)}}}}},baseNotch:{type:"zMultiDrone",mask:"fixed",ignore:false,init:function(e,t,n){return{ring:{type:"zCircle",layer:0},background:{type:"zShape",layer:1},label:{type:"zTextBox",layer:2},mouseEvents:function(t){t.drag(function(t,n,r){e.setBase({a:e.pointToAPos({x:r})})})}}},curr:function(e,t,n,r){var i={d:e.d,a:e.baseSelected.a},s=zp.addPoints(e.getPoint(i),{y:e.L.height/2}),o=zp.flag({anchor:s,width:r.width,height:r.height,xAlign:"left",yAlign:"bottom"},r.flagWidth,r.flagHeight),u={anchor:zo.mid(.5,o[0],o[2]),xAlign:"xCentre",yAlign:"yCentre"};return{ring:{circle:{centre:s,radius:e.L.height/2-r.ring["stroke-width"]/2}},background:{points:o},label:{text:"From\n"+e.dc.getName(i),layout:u}}}},currNotch:{type:"zMultiDrone",mask:"fixed",init:function(e,t,n,r){return{ring:{type:"zCircle",layer:3},background:{type:"zShape",layer:4},label:{type:"zTextBox",layer:5},mouseEvents:function(t){t.drag(function(t,n,r,i){e.axisSelect({x:r,y:0})},function(){e.dragging=true},function(){e.dragging=false})}}},curr:function(e,t,n,r){var i={d:e.d,r:e.selected.r||0},s=zp.addPoints(e.getPoint(i),{y:e.L.height/2}),o=zp.flag({anchor:s,width:r.width,height:r.height,xAlign:"right",yAlign:"bottom"},r.flagWidth,r.flagHeight),u={anchor:zo.mid(.5,o[0],o[2]),xAlign:"xCentre",yAlign:"yCentre"};return{ring:{circle:{centre:s,radius:e.L.height/2-r.ring["stroke-width"]/2}},background:{points:o},label:{text:e.dc.getName(i),layout:u}}}},playButton:{type:"zMultiDrone",mask:"fixed",init:function(e,t,n,r){var i=e.Y.select,s=new zLayout({anchor:zp.addVector(e.L.rotation,-e.notchHeight,e.L.getPoint(0,.5,true)),width:e.notchHeight,height:e.notchHeight,xAlign:"xCentre",yAlign:"yCentre"});return{layer:0,background:{type:"zCircle",circle:{centre:s.anchor,radius:e.notchHeight/2}},foreground:{type:"zShape"},mouseEvents:function(t){t.click(function(){if(e.G.animating)e.axisSelect({r:e.selected.r},i.t,i.e);else if(e.selected.r==e.range[1])e.axisSelect({r:e.range[0]});else e.axisSelect({r:e.range[1]},i.t,i.e)})}}},curr:function(e,t,n,r){var i=e.Y.select,s=new zLayout({anchor:zp.addVector(e.L.rotation,-e.notchHeight,e.L.getPoint(0,.5,true)),width:e.notchHeight,height:e.notchHeight,xAlign:"xCentre",yAlign:"yCentre"});return{foreground:{points:s.getPoints(!e.G.animating?[[.33,.2],[.78,.5],[.78,.5],[.33,.8]]:[[.3,.3],[.7,.3],[.7,.7],[.3,.7]])}}}}}},e),t,n,r,i)}function zSwarm(e,t,n,r,i){zSwarmConstructor(this,zo.extend({rSpace:"all"},e),"zSwarm");if(this.updateData)this.updateData(t,n,null,this.K);this.add("fixed",t,n,null,this.K);this.add("all",t,n,r,i);this.layer();for(var s in this.axes)this.axes[s].layer()}var startTime=$.now(),logger=function(e){var t=$.now()-startTime+": "+e;if(typeof console=="object")console.log(t)},logobj=function(e){if(typeof console=="object")console.log($.now()-startTime+": "+zt.asString(e))},explode=function(e){logger("KABOOOM!: "+e);buggerSelf()},zDebug={show:function(e,t,n){t=t||"red";var r;if(e.left!=null&&e.right!=null&&e.top!=null&&e.bottom!=null){r=new zShape({points:zp.boxToPoints(e),stroke:t,"stroke-width":1})}else if(e instanceof Array&&e[0].x!=null&&e[0].y!=null){r=new zLine({points:e,stroke:t,"stroke-width":.5})}else if(e.x!=null&&e.y!=null){r=new zCircle({circle:{centre:e,radius:5},fill:t})}r.remove(n||5e3,"<")},mapShow:function(e,t,n,r){zDebug.show(zt.mapPoints(e,t,n),r)},button:function(e,t){var n=new zCircle({circle:{centre:t||{x:20,y:20},radius:10},stroke:"#666",fill:"#888",opacity:.3});n.click(e)}};var zDrones={make:function(e,t,n,r,i,s){if(!e)return logger("zDrones.make(): WARNING - No type defined.");else if(typeof e=="function")return new e(t,n,r,i,s);else if(typeof e=="string"){if(!zDrones[e])return logger("zDrones.make(): WARNING - "+e+" is not a valid drone type.");return new zDrones[e](t,n,r,i,s)}},zGuide:zGuide,zLine:zLine,zShape:zShape,zArc:zArc,zCircle:zCircle,zRectangle:zRectangle,zText:zText,zImage:zImage,zSVG:zSVG,zHTML:zHTML,zMultiDrone:zMultiDrone,zTextBox:zTextBox,zHTMLTooltipBox:zHTMLTooltipBox};var zPlot=zp={decToDeg:function(e){return(e||0)*360-90},decToRad:function(e){return(e||0)*2*Math.PI},degToDec:function(e){return(e||0)/360},degToRad:function(e){return(e||0)*Math.PI/180},radToDec:function(e){return(e||0)/2/Math.PI},radToDeg:function(e){return(e||0)*180/Math.PI},normaliseDeg:function(e,t,n){t=t||0;n=n||360;while(e>=n)e-=360;while(e<t)e+=360;return e},matchDeg:function(e,t){while(e>t+180)e-=360;while(e<t-180)e+=360;return e},inverseDeg:function(e){return zp.normaliseDeg(e+180)},degDiff:function(e,t){return zt.roundTo(Math.abs(zp.normaliseDeg(e)-zp.normaliseDeg(t)),10)},sin:function(e){return Math.sin(zp.degToRad(e))},cos:function(e){return Math.cos(zp.degToRad(e))},tan:function(e){return Math.tan(zp.degToRad(e))},asin:function(e){return zp.radToDeg(Math.asin(e))},acos:function(e){return zp.radToDeg(Math.acos(e))},atan:function(e){return zp.radToDeg(Math.atan2(e))},isRightAngle:function(e,t,n){var r=Math.round(zp.normaliseDeg(zp.calcDeg(e,t)-zp.calcDeg(t,n)));return r==90|r==270},areaToRadius:function(e){return Math.sqrt(e/Math.PI)},calcDist:function(e,t){var n=t.x-e.x,r=t.y-e.y;if(n==0&&r==0)return 0;return Math.sqrt(n*n+r*r)},calcDeg:function(e,t){var n=t.x-e.x,r=t.y-e.y;if(n==0&&r==0)return 0;return zp.radToDeg(Math.atan2(r,n))},calcVector:function(e,t){var n=t.x-e.x,r=t.y-e.y;if(n==0&&r==0)return{x:0,y:0,deg:0,dist:0};return{x:n,y:r,deg:zp.radToDeg(Math.atan2(r,n)),dist:Math.sqrt(n*n+r*r)}},addVector:function(e,t,n){if(e==-90)return{x:n.x,y:n.y-t};if(t==0)return n;var r=zp.degToRad(e);return{x:n.x+Math.cos(r)*t,y:n.y+Math.sin(r)*t}},arcToPoints:function(e,t,n,r,i){while(r<0)r+=360,i+=360;var s,o=[],u=function(r){if(t)o.push(zp.addVector(r,t,e));o.push(zp.addVector(r,n,e))};if(!t)o.push(e);u(r);for(s=90;s<=360;s+=90)if(zt.isBetween(s,r,i))u(s);u(i);return o},alignmentToDeg:function(e,t){if(e=="left"){return t=="top"?315:t=="yCentre"?0:t=="bottom"?45:null}else if(e=="xCentre"){return t=="top"?270:t=="yCentre"?0:t=="bottom"?90:null}else if(e=="right"){return t=="top"?225:t=="yCentre"?180:t=="bottom"?135:null}else return null},alignmentToDec:function(e){switch(e){case"right":case"bottom":return 1;case"xCentre":case"yCentre":return.5;case"left":case"top":return 0;default:return logger("zTools.alignmentToDec(): "+e+" doesn't look like an alignment.")}},alignmentToMod:function(e){switch(e){case"right":case"bottom":return 1;case"xCentre":case"yCentre":return 0;case"left":case"top":return-1;default:return logger("zTools.alignmentToDec(): "+e+" doesn't look like an alignment.")}},degToAlignment:function(e){e=zp.normaliseDeg(e);return e==0?{xAlign:"xCentre",yAlign:"bottom"}:e<90?{xAlign:"left",yAlign:"bottom"}:e==90?{xAlign:"left",yAlign:"yCentre"}:e<180?{xAlign:"left",yAlign:"top"}:e==180?{xAlign:"xCentre",yAlign:"top"}:e<270?{xAlign:"right",yAlign:"top"}:e==270?{xAlign:"right",yAlign:"yCentre"}:e<360?{xAlign:"right",yAlign:"bottom"}:{xAlign:"xCentre",yAlign:"bottom"}},inverseAlignment:function(e){switch(e){case"xCentre":return"xCentre";case"left":return"right";case"right":return"left";case"yCentre":return"yCentre";case"top":return"bottom";case"bottom":return"top"}},completeBox:function(e){if(e instanceof zLayout)return e;e=zo.clone(e);if(e.anchor)e.x=e.anchor.x,e.y=e.anchor.y;else e.anchor={x:e.x,y:e.y};if(e.xAlign)e[e.xAlign]=e.x;if(e.yAlign)e[e.yAlign]=e.y;e.left=e.left!=null?e.left:e.right!=null&&e.width!=null?e.right-e.width:e.xCentre!=null&&e.width!=null?e.xCentre-e.width/2:e.x||0;e.top=e.top!=null?e.top:e.bottom!=null&&e.height!=null?e.bottom-e.height:e.yCentre!=null&&e.height!=null?e.yCentre-e.height/2:e.y||0;e.width=e.width!=null?e.width:e.right!=null?e.right-e.left:0;e.height=e.height!=null?e.height:e.bottom!=null?e.bottom-e.top:0;e.right=e.right!=null?e.right:e.left+e.width;e.bottom=e.bottom!=null?e.bottom:e.top+e.height;e.xCentre=e.xCentre!=null?e.xCentre:zt.mid(.5,e.left,e.right);e.yCentre=e.yCentre!=null?e.yCentre:zt.mid(.5,e.top,e.bottom);e.centre={x:e.xCentre,y:e.yCentre};return e},pointsToBox:function(e){var t=za.sort(za.extract(e,"x")),n=za.sort(za.extract(e,"y"));return{left:t[0],right:za.last(t),top:n[0],bottom:za.last(n)}},boxToPoints:function(e){return[{x:e.left,y:e.top},{x:e.right,y:e.top},{x:e.right,y:e.bottom},{x:e.left,y:e.bottom}]},boxToArray:function(e){return[e.left,e.top,e.width,e.height]},boxToSVG:function(e){return zp.shape(zp.boxToPoints(e))},boxIntersection:function(e,t){var n={left:Math.max(e.left,t.left),right:Math.min(e.right,t.right),top:Math.max(e.top,t.top),bottom:Math.min(e.bottom,t.bottom)};return n.left<=n.right&&n.top<=n.bottom?n:null},boxUnion:function(e,t){return{left:Math.min(e.left,t.left),right:Math.max(e.right,t.right),top:Math.min(e.top,t.top),bottom:Math.max(e.bottom,t.bottom)}},boxRatio:function(e){return(e.bottom-e.top)/(e.right-e.left)},isInBox:function(e,t,n){return zt.isBetween(e.x,t.left,t.right,n&&t.left!=t.right)&&zt.isBetween(e.y,t.top,t.bottom,n&&t.top!=t.bottom)},isPoint:function(e){return e.x!=null&&e.y!=null},addPoints:function(e,t){return{x:(e.x||0)+(t.x||0),y:(e.y||0)+(t.y||0)}},subtractPoints:function(e,t){return{x:(e.x||0)-(t.x||0),y:(e.y||0)-(t.y||0)}},roundPoints:function(e,t){var n,r=[];if(e instanceof Array)for(var n=0;n<e.length;n++)r[n]={x:zt.roundTo(e[n].x,t),y:zt.roundTo(e[n].y,t)};else r={x:zt.roundTo(e.x,t),y:zt.roundTo(e.y,t)};return r},pointsEqual:function(e,t){return e&&t&&e.x==t.x&&e.y==t.y},pointToString:function(e,t){return zt.roundTo(e.x,t)+","+zt.roundTo(e.y,t)},start:function(e){return"M"+zp.pointToString(e||{x:0,y:0})},lineTo:function(e){return"L"+zp.pointToString(e)},quadraticCurveTo:function(e,t){return"Q"+zp.pointToString(e)+","+zp.pointToString(t)},arcTo:function(e,t){return"A"+e+","+e+",0,0,1,"+zp.pointToString(t)},reverseArcTo:function(e,t){return"A"+e+","+e+",0,0,0,"+zp.pointToString(t)},close:function(e){return"Z"},line:function(e){var t=zp.start(e[0]);for(var n=1;n<e.length;n++)t+=zp.lineTo(e[n]);return t},shape:function(e){return zp.line(e)+"Z"},readRawLayout:function(e,t){if(c.xAlign=="xCentre")xDec-=.5;else if(c.xAlign=="right")xDec*=-1;if(c.yAlign=="yCentre")yDec-=.5;else if(c.yAlign=="bottom")yDec*=-1;var n=innerBox?{x:(c.xAlign=="left"?c.margin:c.xAlign=="right"?-c.margin:0)+c.innerWidth*xDec,y:(c.yAlign=="top"?c.margin:c.yAlign=="top"?-c.margin:0)+c.innerHeight*yDec}:{x:c.width*xDec,y:c.height*yDec};n=zp.addPoints(c.trueAnchor,n);if(c.rotation)n=c.getRadialPoint(n,c.rotation);if(c.verticalSkew)n.y+=(n.x-c.x)*Math.sin(c.verticalSkew);return n},readLayout:function(e){var t=zp.alignmentToDec(e.xAlign),n=zp.alignmentToDec(e.yAlign);return zp.shape([{x:e.x+(t-1)*e.width,y:e.y-(n-1)*e.height},{x:e.x+t*e.width,y:e.y-(n-1)*e.height},{x:e.x+t*e.width,y:e.y-n*e.height},{x:e.x+(t-1)*e.width,y:e.y-n*e.height}])},arc:function(e){var t,n,r=e.degEnd-e.degStart,i=e.minSeg||Math.ceil(r/90),s=r/i;if(e.innerRadius){n=zp.start(zp.addVector(e.degStart,e.innerRadius,e.centre));for(t=1;t<=i;t++){n+=zp.arcTo(e.innerRadius,zp.addVector(e.degStart+t*s,e.innerRadius,e.centre))}}else n=zp.start(e.centre);if(e.outerRadius>e.innerRadius){n+=zp.lineTo(zp.addVector(e.degEnd,e.outerRadius,e.centre));for(t=i-1;t>=0;t--){n+=zp.reverseArcTo(e.outerRadius,zp.addVector(e.degStart+t*s,e.outerRadius,e.centre))}}return n+"Z"},circle:function(e,t){var n,r=-135,i=4,s=360/i,o=zp.start(zp.addVector(r,t,e));if(t)for(n=1;n<=i;n++){o+=zp.arcTo(t,zp.addVector(r+n*s,t,e))}return o},flag:function(e,t,n){e=zp.completeBox(e);var r=t*zp.alignmentToMod(e.xAlign),i=n*zp.alignmentToMod(e.yAlign),s=[e[e.xAlign],e[zp.inverseAlignment(e.xAlign)]],o=[e[e.yAlign],e[zp.inverseAlignment(e.yAlign)]];return[{x:s[0],y:o[1]-i},{x:s[1],y:o[1]-i},{x:s[1],y:o[0]-i},{x:s[0]-r,y:o[0]-i},{x:s[0],y:o[0]}]}};var zArray=za={isEmpty:function(e){return e==null||e.length==0},asArray:function(e){return e instanceof Array?e:[e]},asObject:function(e){if(e.length==0){var t,n={};for(t=0;t<e.length;t++)n[t]=e[t];return n}else return e},createDeep:function(e,t){var n=[],r,i=e[0],s=e.slice(1);if(e.length>1)for(r=0;r<i;r++)n[r]=za.createDeep(s,t);else for(r=0;r<i;r++)n[r]=t;return n},getDeep:function(e,t){if(za.isEmpty(t)||e==null)return e;var n,r=[],i=t[0],s=t.slice(1);if(i instanceof Array)for(n=0;n<i.length;n++)r[n]=za.getDeep(e[i[n]],s);else r=za.getDeep(e[i],s);return r},setDeep:function(e,t,n){var r,i=t[0]=="all"?za.fill(0,e.length,1):za.asArray(t[0]);if(t.length>1){t=t.slice(1);for(r=0;r<i.length;r++){e[i[r]]=za.setDeep(e[i[r]]||[],t,n)}}else for(r=0;r<i.length;r++)e[i[r]]=zo.clone(n);return e},deepLength:function(e){var t=[],n=e;while(n instanceof Array){t.push(n.length);n=n[0]}return t},flatten:function(e){var t,n=[];for(t=0;t<e.length;t++){if(e[t]instanceof Array){n=n.concat(za.flatten(e[t]))}else n.push(e[t])}return n},fill:function(e,t,n){var r,i=[];if(n)for(r=0;r<t;r++)i[r]=e+r*n;else for(r=0;r<t;r++)i[r]=zo.clone(e);return i},fillRange:function(e){var t=Math.abs(e[0]-e[1])+1,n=e[0]<e[1]?1:e[0]==e[1]?0:-1;return za.fill(e[0],t,n)},shyPush:function(e,t){if(!za.contains(e,t))e.push(t);return e},shyConcat:function(e,t){for(var n=0;n<t.length;n++)za.shyPush(e,t[n]);return e},switchOut:function(e,t,n){var e=e.slice();e[t]=n;return e},asIndexedObjects:function(e){var t,n=[];for(t=0;t<e.length;t++)n[t]={id:t,val:e[t]};return n},map:function(e,t){if(typeof t=="number")return e[t];else if(t instanceof Array){var n,r=[];for(n=0;n<t.length;n++)r[n]=e[t[n]];return r}else return e},unmap:function(e,t){if(typeof t=="number")return za.find(e,t);else if(t instanceof Array){var n,r=[];for(n=0;n<t.length;n++)r[n]=za.find(e,t[n]);return r}else return e},sort:function(e,t){e.sort(function(e,t){return e>t?1:t>e?-1:0});return t?e.reverse():e},reverse:function(e){var t,n=[];for(t=e.length-1;t>=0;t--)n.push(e[t]);return n},last:function(e){return e[e.length-1]},equals:function(e,t,n){if(!(e instanceof Array))return zo.equals(e,t);if(!(t instanceof Array)||e.length!=t.length)return false;if(n){for(var r=0;r<e.length;r++){if(!za.equals(e[r],t[r],true))return false}return true}else return za.subtract(e,t).length==0},compareTests:{"==":function(e,t){return e==t},"===":function(e,t){return e===t},"<":function(e,t){return e<t},"<=":function(e,t){return e<=t},">":function(e,t){return e>t},">=":function(e,t){return e>=t},"><":function(e,t,n){return e>t&&e<n},">=<":function(e,t,n){return e>=t&&e<=n},"<>":function(e,t,n){return e<t||e>n},"<=>":function(e,t,n){return e<=t||e>=n},"!=":function(e,t){return e!=t},type:function(e,t){return zt.getType(e)==t},atPos:function(e,t,n){return e[n]==t},equals:function(e,t,n){return za.equals(e,t,n)},superset:function(e,t,n){return za.isSuperset(e,t,n)},subset:function(e,t,n){return za.isSubset(e,t,n)},intersects:function(e,t){return za.intersects(e,t)},match:function(e,t){return za.get(t,e)!=null},notMatch:function(e,t){return za.get(t,e)==null}},find:function(e,t,n,r){if(!e)return null;var i,s=za.compareTests[n||"=="];if(s){for(i=0;i<e.length;i++)if(s(e[i],t,r))return i;return null}else if(n=="max"){return za.find(e,za.max(e))}else if(n=="min"){return za.find(e,za.min(e))}else if(n=="closest"){var o=za.sortObjects(za.asIndexedObjects(e),"val"),u=t>za.last(o).val?e.length-1:za.findObject(o,"val",t,">"),a=Math.max(0,u-1);return o[Math.abs(t-o[u].val)<Math.abs(t-o[a].val)?u:a].id}else logger("za.find(): I don't understand how to find(a, "+t+", "+n+", "+r+").")},reverseFind:function(e,t,n,r){var i=za.find(e.slice().reverse(),t,n,r);return e.length-1-i},contains:function(e,t,n,r,i){return za.find(e,t,n,r,i)!=null},findAll:function(e,t,n,r){var i,s=[],o=za.compareTests[n||"=="];if(o){for(i=0;i<e.length;i++)if(o(e[i],t,r))s.push(i)}else if(n=="max"||n=="min"){var u=za.sortObjects(za.asIndexedObjects(e),"val",n=="max");t=t==null?u.length:zt.forceBetween(t,1,u.length);for(i=0;i<t;i++)s.push(u[i].id)}else logger("za.findAll(): I don't understand how to findAll(a, "+t+", "+n+", "+r+").");return s},get:function(e,t,n,r,i){var s=za.find(e,t,n,r,i);return s==null?null:e[s]},getAll:function(e,t,n,r){return za.map(e,za.findAll(e,t,n,r))},remove:function(e,t,n,r,i){var s=za.find(e,t,n,r,i);return s==null?null:e.splice(s,1)[0]},removeAll:function(e,t,n,r){var i=[],s=za.sort(za.findAll(e,t,n,r),true);for(var o=0;o<s.length;o++)i=i.concat(e.splice(s[o],1));return i},getRandom:function(e,t,n){if(t==null||t==1){if(!e)explode("zArray.getRandom(): Can't get a random element from an undefined array.");return e[Math.round(Math.random()*(e.length-1))]}var r,i,s=[],o=za.fill(0,e?e.length:t,1);if(n==null||n=="random"){while(s.length<t){s.push(Math.round(Math.random()*(o.length-1)))}}else if(n=="randomNoRepeat"){while(s.length<t){i=o.slice();for(r=0;r<t;r++)s.push(i.splice(Math.round(Math.random()*(i.length-1)),1)[0])}}else if(n=="sequential"){while(s.length<t){s=s.concat(o)}}if(e)for(r=0;r<t;r++)s[r]=e[s[r]];return s},getType:function(e){var t,n=typeof e[0];for(t=1;t<e.length;t++){if(typeof e[t]!=n)return"mixed"}return n},getNumbers:function(e){return za.getAll(za.asArray(e),"number","type")},getDuplicates:function(e){var t,n=[];e=za.sort(e);for(t=1;t<e.length;t++){if(e[t]==e[t-1])n.push(e[t])}return n},getUniques:function(e){var t,n,r=[];e=za.sort(e);for(t=0;t<e.length;t++){if(e[t]!=e[t-1])r.push(e[t])}return r},replaceAll:function(e,t,n,r){for(var i=0;i<e.length;i++)if(za.equals(e[i],t,r))e[i]=n;return e},extract:function(e,t){for(var n=[],r=0;r<e.length;r++)n[r]=e[r][t];return n},mergeStacked:function(e){return{start:za.min(za.extract(e,"start")),end:za.max(za.extract(e,"end"))}},sortObjects:function(e,t,n){var r=e.slice();r.sort(function(e,n){return e[t]>n[t]?1:n[t]>e[t]?-1:0});return n?r.reverse():r},calcObjects:function(e,t,n,r){var i=za.getNumbers(za.extract(e,t));if(!n)return i;if(za[n])return za[n](i,r)},findObject:function(e,t,n,r,i){return za.find(za.extract(e,t),n,r,i)},getObject:function(e,t,n,r,i){return e[za.findObject(e,t,n,r,i)]},removeObject:function(e,t,n,r,i){return e.splice(za.findObject(e,t,n,r,i),1)[0]},findAllObjects:function(e,t,n,r,i){return za.findAll(za.extract(e,t),n,r,i)},getAllObjects:function(e,t,n,r,i){return za.map(e,za.findAllObjects(e,t,n,r,i))},removeAllObjects:function(e,t,n,r,i){var s=[],o=za.findAllObjects(e,t,n,r,i);for(var u=o.length-1;u>=0;u--)s=s.concat(e.splice(o[u],1));return s},insert:function(e,t,n){return e.slice(0,n).concat(t,e.slice(n+1))},subtract:function(e,t,n){e=za.asArray(e),t=za.asArray(t);var r,i=e.slice();for(r=0;r<t.length;r++)za.remove(i,t[r],"equals",null,n);return i},union:function(e,t){return za.getUniques(e.concat(t))},intersection:function(e,t){return za.getAll(e,t,"match")},symmetricDifference:function(e,t){var n,r=[];for(n=0;n<e.length;n++)if(!za.contains(t,e[n]))r.push(e[n]);for(n=0;n<t.length;n++)if(!za.contains(e,t[n]))r.push(t[n]);return za.getUniques(r)},isSubset:function(e,t,n){if(t.length-e.length<n)return false;return za.subtract(e,t).length==0},isSuperset:function(e,t,n){return za.isSubset(t,e,n)},intersects:function(e,t){return za.get(e,t,"match")!=null},calc:function(e,t,n){if(za[t])return za[t](e,n);logger("zArray.calc(): I don't know how to calculate "+t+".")},sum:function(e,t){var n,r=0;if(t)for(n=0;n<e.length;n++)r+=e[n];else for(n=0;n<e.length;n++)if(!isNaN(e[n]))r+=e[n];return r},max:function(e,t){if(!t)e=za.getNumbers(e);return Math.max.apply({},e)},min:function(e,t){if(!t)e=za.getNumbers(e);return Math.min.apply({},e)},range:function(e){return[za.min(e),za.max(e)]},rank:function(e,t,n){var r,i=[];if(!n)e=za.getNumbers(e);e=za.sortObjects(za.asIndexedObjects(e),"val",t);for(r=0;r<e.length;r++)i[e[r].id]=r;return i},mean:function(e,t){if(!t)e=za.getNumbers(e);return za.sum(e,!t)/e.length},median:function(e){return za.percentile(e,.5)},percentile:function(e,t){var n=(e.length-1)*t;e=za.sort(e);return zt.mid(n-Math.floor(n),e[Math.floor(n)],e[Math.ceil(n)])},dec:function(e){var t,n=[],r=za.sum(e);if(r)for(t=0;t<e.length;t++)if(!isNaN(e[t]))n[t]=e[t]/r;else for(t=0;t<e.length;t++)n[t]=0;return n},stacked:function(e){var t,n=[],r=0;for(t=0;t<e.length;t++){n[t]={start:r,end:!isNaN(e[t])?r+=e[t]:r}}return n},change:function(e){var t,n,r=0,i=[];for(t=0;t<e.length;t++){n=e[t]||0;i[t]=n-r;r=n}return i},decChange:function(e){var t,n=0,r=[];for(t=0;t<e.length;t++){r[t]=e[t]?n?e[t]/n-1:1:n?-1:0;n=e[t]}return r},totalChange:function(e){var t,n,r=[],i=e[0]||0;for(t=0;t<e.length;t++){n=e[t]||0;r[t]=n-i}return r},totalDecChange:function(e){var t,n=[];for(t=0;t<e.length;t++){n[t]=e[t]?e[0]?e[t]/e[0]-1:1:e[0]?-1:0}return n},roundTo:function(e,t){var n,r=[];for(n=0;n<e.length;n++)r[n]=zt.roundTo(e[n],t);return r},counter:function(e,t,n,r){var i;switch(r){case"array":for(i=e.length-1;i>=0;i--){if(e[i]<n[i]){e[i]++;for(i++;i<e.length;i++)e[i]=t[i];return e}}return null;case"non-repeat":for(i=e.length-1;i>=0;i--){if(e[i]<n+i+1-e.length){e[i]++;for(i++;i<e.length;i++)e[i]=e[i-1]+1;return e}}return null;case"ordered":for(i=e.length-1;i>=0;i--){if(e[i]<n){e[i]++;for(i++;i<e.length;i++)e[i]=e[i-1];return e}}return null;default:for(i=e.length-1;i>=0;i--){if(e[i]<n){e[i]++;for(i++;i<e.length;i++)e[i]=t;return e}}return null}},getPairs:function(e){if(e.length<2)return[];var t=[],n=[0,1];while(n!=null){t.push(e[n[0]]+","+e[n[1]]);n=za.counter(n,0,e.length-1,"non-repeat")}return t},calcSimilarity:function(e,t,n){var r,i,s,o=0,u=n?(e.length+t.length)*n/2:0;if(e.length>=t.length)i=e,s=t;else i=t,s=e;if(s.length<u)return null;for(r=0;r<s.length;r++){if(za.get(i,s[r]))o++;else if(o+s.length-r<u)return null}return 2*o/(e.length+t.length)},frequency:function(e,t,n){var r=0,i,s,o=[];if(typeof e[0]=="number"&&t){n=n||1;e=e.slice();for(r=0;r<t.length-1;r++){i=t[r];s=t[r+1];if(s==">")o.push({label:"More than "+(i-n),count:za.removeAll(e,i-n,">").length});else if(i=="<")o.push({label:"Less than "+s,count:za.removeAll(e,s,"<").length});else o.push({label:i+" to "+(s-n),count:za.removeAll(e,s,"<").length})}if(e.length>0)logger("WARNING: "+e.length+" items could not be were not counted. Maybe they're of the wrong type or out of interval range?")}else{for(r=0;r<e.length;r++){i=za.getObject(o,"item",e[r]);if(i)i.count++;else o.push({item:e[r],count:1})}o=za.sortObjects(o,"count",true)}return o}};var zObject=zo={get:function(e,t){t=t.split(".");for(var n=0;n<t.length&&e;n++)e=e[t[n]];return e},equals:function(e,t){if(e==t)return true;var n,r=typeof e,i=typeof t;if(r!=i)return false;else if(r=="object"){if(e==null||t==null)return false;for(n in e)if(!zo.equals(e[n],t[n]))return false;return true}else if(r=="function"){return zt.asString(e)==zt.asString(t)}else return false},isEmpty:function(e){return $.isEmptyObject(e)},listProperties:function(e){var t,n=[];for(t in e)n.push(t);return n},removeProperty:function(e,t){var n=e[t];delete e[t];return n},deepGetProperty:function(e,t){var n,r={},i;for(n in e){if(n==t)r[n]=e[n];else if(typeof e[n]=="object"){i=zo.deepGetProperty(e[n],t);if(i)r[n]=i}}return zo.isEmpty(r)?null:r},extend:function(e,t,n){return $.extend(!n,e,t)},shyExtend:function(e,t){if(typeof e!="object"||typeof t!="object")return;for(p in t){if(e[p]==null)e[p]=zo.clone(t[p]);else zo.shyExtend(e[p],t[p])}return e},clone:function(e,t){var n=e instanceof Array?zo.extend([],e):typeof e=="object"?zo.extend({},e):e;if(t)n=zo.extend(n,t);return n},map:function(e,t){var n,r={};for(n in t){if(typeof t[n]=="object")r[n]=zo.map(e[n],t[n]);else r[n]=e[n]}return r},sort:function(e,t){t=t||za.sort(zo.listProperties(e));for(var n={},r=0;r<t.length;r++){if(e[t[r]]!=null)n[t[r]]=e[t[r]]}return n},mid:function(e,t,n){if(e==0||n==null||t==n)return t;if(e==1||t==null)return n;var r=zt.getType(n);if(r=="object"){var i,s={};for(i in n)s[i]=zo.mid(e,t[i],n[i]);return s}else if(r=="array"){var o,s=[];for(o=0;o<n.length;o++)s[o]=zo.mid(e,t[o],n[o]);return s}else if(r=="number"&&zt.getType(t)=="number")return zt.mid(e,t,n);else if(r=="colour")return zt.getColour(e,t,n);else return n}};var zTools=zt={getType:function(e){if(e==null)return"null";switch(typeof e){case"object":return e instanceof Array?"array":e.r!=null&&e.g!=null&&e.b!=null?"colour":"object";case"string":return e[0]=="#"?"colour":"string";case"number":return isNaN(e)?null:"number";case"function":return"function";case"boolean":return"boolean";default:logger("zt.getType(): I don't know what "+e+" is.")}},getRGB:function(e){var t=typeof e;if(t=="string")return Raphael.getRGB(e);if(t=="object"&&e.r!=null&&e.g!=null&&e.b!=null)return e;logger("zt.getRGB(): "+e+" is not a recognised colour.")},getHex:function(e){e=zt.getRGB(e);var t,n="#",r,i=[e.r,e.g,e.b];for(t=0;t<i.length;t++){r=zt.forceBetween(Math.round(i[t]),0,255).toString(16);if(r.length<2)r="0"+r;n+=r}return n},addColours:function(e,t,n,r){e=zt.getRGB(e);t=zt.getRGB(t);var i={r:e.r+t.r*n,g:e.g+t.g*n,b:e.b+t.b*n};return r?i:zt.getHex(i)},subtractColours:function(e,t,n){e=zt.getRGB(e);t=zt.getRGB(t);var r={r:e.r-t.r,g:e.g-t.g,b:e.b-t.b};return n?r:zt.getHex(r)},getColour:function(e,t,n,r){if(e==0||!r&&e<0)return t;if(e==1)return n;if(e==-1&&r)return r;var i=[],s=zt.getRGB(t),o=zt.getRGB(r&&e<0?r:n);e=Math.min(Math.abs(e),1);return zt.getHex({r:zt.mid(e,s.r,o.r),g:zt.mid(e,s.g,o.g),b:zt.mid(e,s.b,o.b)})},getRandomColour:function(e,t){e=e||0;t=t||255;var n=t-e;return zt.getHex({r:e+Math.random()*n,g:e+Math.random()*n,b:e+Math.random()*n})},getPalette:function(e,t,n){e=e||["#8DD3C7","#FFFFB3","#BEBADA","#FB8072","#80B1D3","#FDB462","#B3DE69","#FCCDE5","#D9D9D9","#BC80BD","#CCEBC5","#FFED6F"];return za.getRandom(e,t,n)},asString:function(e){var t=zt.getType(e);if(e==null)return null;if(t=="string"||t=="colour")return'"'+e+'"';if(t=="array"){var n,r=[];for(n=0;n<e.length;n++)r[n]=zt.asString(e[n]);return"["+r.join(",")+"]"}if(t=="object"){var i,r="{";for(i in e)r+=i+":"+zt.asString(e[i])+",";return r.substr(0,r.length-1||1)+"}"}return e+""},roundTo:function(e,t,n){var r=n=="ceil"?Math.ceil:n=="floor"?Math.floor:Math.round;if(!t)return r(e);var i=Math.pow(10,Math.abs(t));return t>=0?r(e*i)/i:r(e/i)*i},roundToNearest:function(e,t,n){var r=n=="ceil"?Math.ceil:n=="floor"?Math.floor:Math.round;return r(e/t)*t},toSignificantFigures:function(e,t){return zt.roundTo(e,-zt.calcMagnitude(e)-1+t)},shorten:function(e,t){if(e==null)return"";if(e.length<=t)return e;return e.substr(0,t)+".."},wrap:function(e,t){if(e==null||typeof e!="string")return e;var n,r,i="",s="",o=e.split(" "),u;for(n=0;n<o.length;n++){u=o[n].split("\n");for(r=0;r<u.length;r++){if(s==""){s=u[r]}else if(s.length+u[r].length<t){s+=" "+u[r]}else{i+=s+"\n";s=u[r]}if(r<u.length-1){i+=(s||" ")+"\n";s=""}}}return i+s},format:function(e,t){if(e instanceof Array){var n,r=[];for(n=0;n<e.length;n++)r.push(zt.format(e[n],t));return r}var i=function(e){var t,n=e.split(".");for(t=n[0].length-3;t>0;t-=3){n[0]=n[0].slice(0,t)+","+n[0].slice(t)}if(n[1])for(t=3;t<n[1].length;t+=4){n[1]=n[1].slice(0,t)+","+n[1].slice(t)}return n.join(".")},s=function(e){if(isNaN(e))e=0;return[Math.floor(e/60),Math.round(e%60)]};t=t||{};if(typeof t=="string")t={mode:t};if(t.m)t.mode=t.m;var o,u="",a=Math.abs(e*(t.multiply||1));if(t.noSign)o="";else if(t.wordSign)o=e>0?"up ":e<0?"down ":"";else if(t.forceSign)o=e>0?"+":e<0?"-":"";else o=e>=0||t.noSign?"":"-";if(t.prefix)o+=t.prefix;if(t.mode=="time"){var f=s(a);if(f[1]<10)f[1]="0"+f[1];return o+f.join(":")}else if(t.mode=="hours"){var f=s(a);if(f[0])f[0]+="hr";if(f[1])f[1]+="min";return o+f.join(" ")}else if(t.mode=="hoursLong"){var f=s(a);if(f[0])f[0]+=f[0]==1?" hour":" hours";if(f[1])f[1]+=f[1]==1?" minute":" minutes";return o+f.join(" ")}else if(t.mode=="%"){u="%";a*=100}else if(t.mode=="th"){a=Math.round(a);var l=za.last(a),c=a[a.length-2];u=c==1?"th":l==1?"st":l==2?"nd":l==3?"rd":"th"}else if(t.mode=="abbreviate"&&e>999){var h=["","k","M","B","T"],p=Math.floor(zt.calcMagnitude(a)/3)*3;a=a/Math.pow(10,p);u=h[p/3]}a=zt.roundTo(a,t.dp==null?10:t.dp);if(!t.noCommas)a=i(a+"");return o+a+u+(t.suffix||"")},camelCase:function(e){for(var t=""+e[0],n=1;n<e.length;n++)t+=e[n].substr(0,1).toUpperCase()+e[n].substr(1);return t},titleCase:function(e){e=e instanceof Array?e:e.split(" ");for(var t="",n=0;n<e.length;n++){t+=e[n].substr(0,1).toUpperCase()+e[n].substr(1);if(n+1<e.length)t+=" "}return t},isWhole:function(e){return e==Math.round(e)},calcMagnitude:function(e){e=Math.abs(e);if(e==0)return 0;else if(e>=1)return(Math.round(e)+"").length-1;else return-za.find((e+"").split(".")[1],0,"!=")-1},isEven:function(e){return e%2==0},isBetween:function(e,t,n,r){if(r)return t>n?e>n&&e<t:e>t&&e<n;else return t>n?e>=n&&e<=t:e>=t&&e<=n},sayBetween:function(e,t,n){if(e<t&&e<n)return"<";if(e>t&&e>n)return">";return"="},forceBetween:function(e,t,n){return Math.max(t,Math.min(n,e))},calcDec:function(e,t,n){if(t==n)return 0;return(e-t)/(n-t)},mid:function(e,t,n){if(e==null)e=.5;return t+(n-t)*e},random:function(e,t){e=e||0;t=t||1;return e+Math.random()*(t-e)},factorial:function(e){for(var t=1,n=e;n>0;n--)t*=n;return t},scale:function(e,t,n,r,i){var s=zt.calcDec(e,t,n);return zt.mid(s,r,i)},getFactorOfTen:function(e){if(isNaN(e))return;if(e==0)return 0;var t=e<0?-1:1,n=Math.pow(10,zt.calcMagnitude(e)),r=Math.ceil(Math.abs(e)/n);while(10%r!=0)r++;return t*r*n},getMaxFactor:function(e,t){if(t>=e)return e;for(var n=Math.ceil(t);n>=1;n--){if(e%n==0)return n}},getEventPosition:function(e){var t=PAPER.fixedOffset||PAPER.offset||$(PAPER.canvas).offset();return{x:e.pageX-t.left,y:e.pageY-t.top}},getDocumentPosition:function(e){var t=PAPER.fixedOffset||PAPER.offset||$(PAPER.canvas).offset();return{x:Math.round(e.x+t.left),y:Math.round(e.y+t.top)}},makePaper:function(e){var t=Raphael("Raphael",e.width,e.height);t.fixedOffset=$(t.canvas).offset();return t},fixPaperOffset:function(){PAPER.fixedOffset=$(PAPER.canvas).offset()},getPaperSize:function(){return{x:0,y:0,width:PAPER.width,height:PAPER.height}},setPaperSize:function(e){PAPER.setSize(e.width,e.height);zt.fixPaperOffset()},getWindowSize:function(){return{anchor:{x:0,y:0},width:$(window).width(),height:$(window).height()}},getMaxLayout:function(e,t,n){return new zLayout({width:Math.max(e,$(window).width()-$("#Raphael").offset().left-8),height:Math.max(t,$(window).height()-$("#Raphael").offset().top-13),margin:n})},parseStyle:function(e,t){var n,r,i,s={};t=t||e;if(e.baseStyle){i=e.baseStyle.split(" ");for(n=0;n<i.length;n++){zo.extend(s,zo.get(t,i[n]))}zo.extend(s,e);delete s.baseStyle}else s=e;for(r in s)if(s[r]&&typeof s[r]=="object")s[r]=zt.parseStyle(s[r],t);return s},asCSSString:function(e){var t,n="";for(t in e){n+=t+":"+e[t]+";"}return n}}