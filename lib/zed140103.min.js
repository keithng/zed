function zLayout(e,t){var n=this;n.set=function(e){if(!e)return n;n=zo.extend(n,e instanceof zLayout?e.getVitals():e);if(e.anchor){n.x=n.anchor.x;n.y=n.anchor.y}else{n.x=n.x||0;n.y=n.y||0;n.anchor={x:n.x,y:n.y}}n.margin=n.margin||0;if(e.width==null||e.width=="auto"){n.innerWidth=n.innerWidth||0;n.width=n.innerWidth+2*n.margin}else n.innerWidth=n.width-2*n.margin;if(e.height==null||e.height=="auto"){n.innerHeight=n.innerHeight||0;n.height=n.innerHeight+2*n.margin}else n.innerHeight=n.height-2*n.margin;if(n.align){if(n.align=="centre")n.xAlign="xCentre",n.yAlign="yCentre";else if(n.align=="leftTop")n.xAlign="left",n.yAlign="top";else if(n.align=="centreTop")n.xAlign="xCentre",n.yAlign="top";else if(n.align=="rightTop")n.xAlign="right",n.yAlign="top";else if(n.align=="rightCentre")n.xAlign="right",n.yAlign="yCentre";else if(n.align=="rightBottom")n.xAlign="right",n.yAlign="bottom";else if(n.align=="centreBottom")n.xAlign="xCentre",n.yAlign="bottom";else if(n.align=="leftBottom")n.xAlign="left",n.yAlign="bottom";else if(n.align=="leftCentre")n.xAlign="left",n.yAlign="yCentre"}if(n.radial==null){n.xAlign=n.xAlign||"left";n.yAlign=n.yAlign||"top";n.trueAnchor=n.anchor}else{var t=zp.normaliseDeg(n.radial);n.xAlign=n.xAlign||"xCentre";n.yAlign=n.yAlign||"yCentre";n.radialStartPoint=n.radialStart!=null?zp.addVector(t,n.radialStart,n.anchor):n.anchor;n.radialEndPoint=n.radialEnd!=null?zp.addVector(t,n.radialEnd,n.anchor):n.radialStartPoint;n.trueAnchor=zo.add(t<45?{x:.5*n.width,y:.5*n.height*zt.calcDec(t,0,45)}:t<135?{x:.5*n.width*zt.calcDec(t,90,45),y:.5*n.height}:t<225?{x:-.5*n.width,y:.5*n.height*zt.calcDec(t,180,135)}:t<315?{x:.5*n.width*zt.calcDec(t,270,315),y:-.5*n.height}:{x:.5*n.width,y:-.5*n.height*zt.calcDec(t,360,315)},n.radialEndPoint)}n.centre=n.getPoint(.5,.5);n.xCentre=n.centre.x;n.yCentre=n.centre.y;n.corners=n.getCorners();zo.extend(n,zp.pointsToBox(n.corners));n.innerBox=zp.pointsToBox(n.getCorners(true));return n};n.zoom=function(e,t){n.prevLayout=n.getVitals();e=zp.completeBox(e);t=zp.completeBox(t||n);var r,i,s={x:n.width/e.width,y:n.height/e.height};if(s.x<s.y){s=s.x;e.height=n.height/s;i=t.yAlign||e.yAlign||n.yAlign;e.top=i=="top"?e.top:i=="bottom"?e.bottom-e.height:e.yCentre-e.height/2;e.bottom=e.top+e.height}else if(s.y<s.x){s=s.y;e.width=n.width/s;i=t.xAlign||e.xAlign||n.xAlign;e.left=i=="left"?e.left:i=="right"?e.right-e.width:e.xCentre-e.width/2;e.right=e.left+e.width}else s=s.x;r={x:(n[n.xAlign]-e[n.xAlign])/e.width,y:(n[n.yAlign]-e[n.yAlign])/e.height};return n.set({x:t.x+t.width*r.x,y:t.y+t.height*r.y,width:t.width*s,height:t.height*s})};n.unzoom=function(){if(n.prevLayout){n.set(n.prevLayout);n.prevLayout=null}};n.setByBBox=function(e,t){var r=t.layout||{};if(r.width=="auto")e.autoWidth=true;else if(r.width!=null||r.innerWidth!=null)e.autoWidth=false;if(r.height=="auto")e.autoHeight=true;else if(r.height!=null||r.innerHeight!=null)e.autoHeight=false;if(t.margin!=null)r.margin=t.margin;e.getBBox(t);if(e.autoWidth)r.innerWidth=e.bBox.width;if(e.autoHeight)r.innerHeight=e.bBox.height;n.set(r)};n.clone=function(e){return new zLayout(n.getVitals(e))};n.getVitals=function(e){var t,r={},i=["x","y","anchor","margin","width","height","xAlign","yAlign","left","right","top","bottom","rotation","radial","radialStart","radialEnd","verticalSkew"];for(t=0;t<i.length;t++)if(n[i[t]]!=null)r[i[t]]=zo.clone(n[i[t]]);return e?zo.extend(r,e):r};n.getCorners=function(e){return[n.getPoint(0,0,e),n.getPoint(1,0,e),n.getPoint(1,1,e),n.getPoint(0,1,e)]};n.getPoint=function(e,t,r){var i={x:n.getX(e,r),y:n.getY(t,r)};if(n.rotation)i=n.getRadialPoint(i,n.rotation);if(n.verticalSkew)i.y+=(i.x-n.x)*Math.sin(n.verticalSkew);return i};n.getX=function(e,t){if(n.xAlign=="xCentre")e-=.5;else if(n.xAlign=="right")e*=-1;if(!t)return n.trueAnchor.x+n.width*e;else return n.trueAnchor.x+n.innerWidth*e+(n.xAlign=="left"?n.margin:n.xAlign=="right"?-n.margin:0)};n.getY=function(e,t){if(n.yAlign=="yCentre")e-=.5;else if(n.yAlign=="bottom")e*=-1;if(!t)return n.trueAnchor.y+n.height*e;else return n.trueAnchor.y+n.innerHeight*e+(n.yAlign=="top"?n.margin:n.yAlign=="bottom"?-n.margin:0)};n.getOffset=function(e,t,r){return zo.subtract(n.getPoint(e,t,r),n.trueAnchor)};n.getDec=function(e,t){if(n.rotation)e=n.getRadialPoint(e,-n.rotation);if(t)return{x:zt.calcDec(e.x,n.innerLeft,n.innerRight),y:zt.calcDec(e.y,n.innerTop,n.innerBottom)};else return{x:zt.calcDec(e.x,n.left,n.right),y:zt.calcDec(e.y,n.top,n.bottom)}};n.getXDec=function(e,t){return n.getDec({x:e.x!=null?e.x:e,y:0},t).x};n.getYDec=function(e,t){return n.getDec({x:0,y:e.y!=null?e.y:e},t).y};n.getRadialPoint=function(e,t){if(!t)return e;var r=zp.vector(n.trueAnchor,e);return zp.addVector(r.deg+t,r.dist,n.trueAnchor)};n.getPoints=function(e,t){var r,i=[];for(r=0;r<e.length;r++)i.push(n.getPoint(e[r][0],e[r][1],t));return i};n.type="zLayout";n.parent=t;n.set(e)}function zSimpleDrone(e,t,n){zo.shyExtend(e,{"class":"zSimpleDrone",type:n,forEach:function(t,n,r,i,s,o,u){if(typeof t=="string")e.raphObj[t](n,r,i,s,o,u);else if(typeof t=="function")t(e.raphObj,n,r,i,s,o,u)},add:function(t,n){t.attr(n);t.parent=e;e.raphObj=t;return t},remove:function(t,n,r,i){if(t){e.clearEvents();e.hide(t,n,function(){e.remove(null,null,r)},i)}else{e.markOfDeath=true;if(e.parent&&e.parent.drones)za.remove(e.parent.drones,e);e.forEach("remove");delete e;if(r)r()}},show:function(t,n,r,i){e.invisibleShow();e.animate({opacity:e.O.opacity||1},t,n,r,i)},hide:function(t,n,r,i){e.hiding=true;e.animate({opacity:0},t,n,function(){if(!e.hiding)return;e.forEach("hide");e.hidden=true;if(r)r()},i)},invisibleShow:function(){if(e.hidden)e.forEach("show");else if(!e.hiding)return;e.hidden=e.hiding=false},appear:function(t,n,r,i){if(!t)return;e.hide();e.show(t,n,r,i)},toFront:function(){e.forEach("toFront")},toBack:function(){e.forEach("toBack")},parseOrders:function(t){if(typeof t=="string")t=e.O[t];return t?za.asObject(t):{}},animate:function(t,n,r,i,s){t=e.parseOrders(t);if(zo.isEmpty(t)||e.markOfDeath)return;if(!n||e.hidden||PAPER.noAnimation){e.forEach("attr",t);if(i)i()}else{e.forEach(s&&s.animation?function(e){e.animation=Raphael.animation(t,n,r,i);e.animateWith(s,s.animation,e.animation);i=null}:function(e){e.animation=Raphael.animation(t,n,r,i);e.animate(e.animation);i=null})}return t},stop:function(){e.forEach("stop")},setOrders:function(t,n,r,i,s){e.O=e.parseOrders(t);e.reset(n,r,i,s)},addOrders:function(t,n,r,i,s){e.setOrders(zo.extend(e.O,e.parseOrders(t)),n,r,i,s)},setMode:function(t,n,r,i,s){if(typeof t!="string"||!e.O[t])return;if(e.origO)e.O=zo.clone(e.origO);else e.origO=zo.clone(e.O);e.addOrders(t,n,r,i,s)},unsetMode:function(t,n,r,i){if(!e.origO)return;e.setOrders(e.origO,t,n,r,i);e.origO=null},highlight:function(t,n,r,i){e.animate("highlight",t,n,r,i)},reset:function(t,n,r,i){e.animate(e.O,t,n,r,i)},select:function(t,n,r,i){e.setMode("select",t,n,r,i)},deselect:function(t,n,r,i){e.unsetMode(t,n,r,i)},clearEvents:function(){e.forEach(function(e){if(!e.events)return;for(var t=0;t<e.events.length;t++)e.events[t].unbind();delete e.events})},click:function(t){e.forEach("click",t)},dblclick:function(t){e.forEach("dblclick",t)},mousedown:function(t){e.forEach("mousedown",t)},mouseup:function(t){e.forEach("mouseup",t)},mousemove:function(t){e.forEach("mousemove",t)},touchstart:function(t){e.forEach("touchstart",t)},touchmove:function(t){e.forEach("touchmove",t)},touchend:function(t){e.forEach("touchend",t)},touchcancel:function(t){e.forEach("touchcancel",t)},hover:function(t,n){e.forEach("hover",t,n)},drag:function(t,n,r){e.forEach("drag",t,n,r)},onAnimation:function(t){e.forEach("onAnimation",t)},hoverHighlight:function(t,n){e.hover(function(){e.highlight(t,n)},function(){e.reset(t,n)})},tooltip:function(t,n,r){e.mousemove(function(i){if(n.hidden)n.showAt({text:t||e.O.tooltipText},100);n.moveToEvent(i,r)});e.hover(function(i){n.showAt({text:t||e.O.tooltipText},100);n.moveToEvent(i,r)},function(){n.hide(100)})},initialise:function(t){if(t.base)t=zo.clone(zo.remove(t,"base"),t);e.O=e.parseOrders(t);if(e.O.layout){if(e.O.margin!=null)e.O.layout.margin=e.O.margin;e.L=e.O.layout.type=="zLayout"?e.O.layout:new zLayout(e.O.layout,e)}}});e.initialise(t)}function zGuide(){this.redraw=function(e,t,n,r){this.redrawTo(0);this.redrawTo(1,e,t,n,r)};this.redrawTo=function(e,t,n,r,i){if(r)this.bQueue.push(r);if(this.scripting)return;this.stop();var s=this;this.animating=true;this.animate({path:zp.start({x:e*1e3,y:0})},t,n,function(){var e,t=s.bQueue;s.bQueue=[];s.animating=false;for(e=0;e<t.length;e++)t[e]()},i)};this.stop=function(){this.animating=false;this.forEach("stop")};this.getVal=function(){var e=this.K.attrs.path,t=za.isArray(e)?e[0][1]:e[1]==" "?e.substr(2,e.length-4):e.substr(1,e.length-3);return t/1e3};this.runScript=function(e,t){if(!e||!e.length)return;if(!PAPER.noAnimation){var n=this,r=e.shift(),i=r[0][0]||1,s=r[0][1],o=r[1];this.redrawTo(0);this.redrawTo(1,i,s,function(){n.runScript(e,t)},t);this.scripting=true;if(o)o(i,s,this.K);this.scripting=false}else for(var u=0;u<e.length;u++)e[u][1]()};this.delay=function(e,t){this.redraw(e,"-",t)};zSimpleDrone(this,{},"zGuide");this.K=this.add(PAPER.path(zp.start()));this.animating=false;this.bQueue=[]}function zLine(e,t,n,r,i){this.redraw=function(e,t,n,r,i){if(e.points)e.path=zp.line(e.points);this.animate(e,t,n,r,i)};zSimpleDrone(this,e,"zLine");this.add(PAPER.path(zp.line(this.O.points)),this.O);this.appear(t,n,r,i)}function zShape(e,t,n,r,i){this.redraw=function(e,t,n,r,i){if(e.points)e.path=zp.shape(e.points);this.animate(e,t,n,r,i)};zSimpleDrone(this,e,"zShape");this.add(PAPER.path(zp.shape(this.O.points)),this.O);this.appear(t,n,r,i)}function zArc(e,t,n,r,i){this.redraw=function(e,t,n,r,i){if(e.arc)e.path=zp.arc(e.arc);this.animate(e,t,n,r,i)};zSimpleDrone(this,e,"zArc");this.add(PAPER.path(zp.arc(this.O.arc)),this.O);this.appear(t,n,r,i)}function zCircle(e,t,n,r,i){this.redraw=function(e,t,n,r,i){if(e.circle){var s=e.circle;if(s.centre)e.cx=s.centre.x,e.cy=s.centre.y;if(s.radius)e.r=s.radius}this.animate(e,t,n,r,i)};zSimpleDrone(this,e,"zCircle");var s=this.O.circle;this.add(PAPER.circle(s.centre.x,s.centre.y,s.radius),this.O);this.appear(t,n,r,i)}function zRectangle(e,t,n,r,i){zSimpleDrone(this,e,"zRectangle");if(!this.L&&this.O.rect){var s=this.O.rect;this.add(PAPER.rect(s.x,s.y,Math.abs(s.width),Math.abs(s.height)),this.O);this.redraw=function(e,t,n,r,i){if(!e)return;if(e.rect)zo.extend(e,e.rect);this.animate(e,t,n,r,i)}}else if(this.O.rounded==null){var o=this.L;this.add(PAPER.rect(o.left,o.top,Math.abs(o.width),Math.abs(o.height)),this.O);this.redraw=function(e,t,n,r,i){if(!e)return;this.L.set(e.layout);if(e.layout)zo.extend(e,{x:o.left,y:o.top,width:Math.abs(o.width),height:Math.abs(o.height)});this.animate(e,t,n,r,i)}}else{this.L.getSVG=function(e){if(!e||!this.width||!this.height)return zp.shape(this.corners);var t=zp.start,n=zp.lineTo,r=this.xAlign=="right"&&this.yAlign!="bottom"||this.xAlign!="right"&&this.yAlign=="bottom"?zp.reverseArcTo:zp.arcTo,i=e/this.width,s=e/this.height;return t(this.getPoint(i,0))+n(this.getPoint(1-i,0))+r(e,this.getPoint(1,s))+n(this.getPoint(1,1-s))+r(e,this.getPoint(1-i,1))+n(this.getPoint(i,1))+r(e,this.getPoint(0,1-s))+n(this.getPoint(0,s))+r(e,this.getPoint(i,0))};var u=this.L.getSVG(this.O.rounded);this.add(PAPER.path(u),this.O);this.redraw=function(e,t,n,r,i){if(!e)return;this.L.set(e.layout);if(e.rounded!=null)e.path=this.L.getSVG(e.rounded);else if(e.layout)e.path=this.L.getSVG(this.O.rounded);this.animate(e,t,n,r,i)}}this.appear(t,n,r,i)}function zText(e,t,n,r,i){var s=this;s.parseText=function(e){var t=s.O.format;if(!t||typeof t!="object")return e;if(!isNaN(e))e=zt.format(e,t);if(t.rows)e=zt.wrap(e,1.1*e.length/t.rows);else if(t.wrap)e=zt.wrap(e,t.wrap);if(t.shorten)e=zt.shorten(e,t.shorten);if(t.case)e=t.case=="upper"?e.toUpperCase():t.case=="lower"?e.toLowerCase():t.case=="camel"?zt.camelCase(e):t.case=="title"?zt.titleCase(e):e;return e};s.getBBox=function(e){var t,n={},r={},i=false,o=["text","font-size","font-weight"];for(t=0;t<o.length;t++)if(e[o[t]]!=null){n[o[t]]=e[o[t]];r[o[t]]=s.O[o[t]];i=true}if(i){s.raphObj.attr(n);s.bBox=s.raphObj.getBBox(true);s.raphObj.attr(r)}return s.bBox};s.redraw=function(e,t,n,r,i){if(!e)return;var o,u,a,f,l,h,p,d=s.parseOrders(e);if(d.text!=null)d.text=s.parseText(d.text);s.L.setByBBox(s,d);o=d.textXAlign||s.O.textXAlign||s.L.xAlign;u=d.textYAlign||s.O.textYAlign||s.L.yAlign;a=zp.alignmentToDec(s.L.xAlign);f=zp.alignmentToDec(s.L.yAlign);l=zp.alignmentToDec(o);h=zp.alignmentToDec(u);p={x:s.L.trueAnchor.x+(l-a)*s.L.width-(l-.5)*2*s.L.margin,y:s.L.trueAnchor.y+(h-f)*s.L.height-(h-.5)*(2*s.L.margin+s.bBox.height),transform:s.L.rotation?"r"+s.L.rotation+","+s.L.trueAnchor.x+","+s.L.trueAnchor.y:null,"text-anchor":o=="left"?"start":o=="right"?"end":"middle"};d=zo.shyExtend(p,d);s.animate(d,t,n,r,i)};zSimpleDrone(s,e,"zText");s.bBox={};s.autoWidth=s.L.width=="auto"||!s.L.innerWidth;s.autoHeight=s.L.height=="auto"||!s.L.innerHeight;s.add(PAPER.text(s.L.x,s.L.y,"Placeholder"),s.O);if(!s.O.selectable)$(s.raphObj.node).attr("style",$(s.raphObj.node).attr("style")+"-webkit-touch-callout:none; -webkit-user-select:none; -khtml-user-select:none; -moz-user-select:none; -ms-user-select:none; user-select:none;");s.redraw(s.O);s.appear(t,n,r,i)}function zImage(e,t,n,r,i){this.redraw=function(e,t,n,r,i){var s=this.L;s.set(e.layout);zo.extend(e,{x:Math.round(s.left+s.margin),y:Math.round(s.top+s.margin),width:Math.round(s.innerWidth),height:Math.round(s.innerHeight)});this.animate(e,t,n,r,i)};zSimpleDrone(this,e,"zImage");var s=this.L;this.add(PAPER.image(this.O.url,s.left,s.top,s.innerWidth,s.innerHeight),this.O);this.appear(t,n,r,i)}function zSVG(e,t,n,r,i){this.redraw=function(e,t,n,r,i){this.animate(e,t,n,r,i);if(this.L&&e.layout){var s=this.L,o={x:s.x,y:s.y};s.set(e.layout);this.raphObj.translate(s.x-o.x,s.y-o.y)}};zSimpleDrone(this,e,"zSVG");this.add(PAPER.path(this.O.path),this.O);this.appear(t,n,r,i)}function zComplexDrone(e,t,n){zSimpleDrone(zo.shyExtend(e,{"class":"zComplexDrone",parts:{},forEach:function(t,n,r,i,s,o,u){if(typeof t=="string")for(var a in e.parts)e.parts[a][t](n,r,i,s,o,u);else if(typeof t=="function")for(var a in e.parts)t(e.parts[a],a)},add:function(t,n){var r=zDrones.make(t.type,t);if(!r)return;r.parent=e;e.parts[n]=r;return r},show:function(t,n,r,i){e.invisibleShow();var s,o={opacity:e.O.opacity||1};for(s in e.parts)if(e.O[s]&&e.O[s].opacity)o[s]={opacity:e.O[s].opacity};e.animate(o,t,n,r,i)},invisibleShow:function(){if(e.hidden)e.forEach("invisibleShow");else if(!e.hiding)return;e.hidden=e.hiding=false},parseOrders:function(t){if(!t)return{};t=za.asObject(t);var n,r={},i={},s=zo.clone(typeof t=="string"?e.O[t]||{}:t);for(n in e.parts)r[n]=s[n]?zo.remove(s,n):{};i=zo.clone(s);for(n in e.parts)i[n]=zo.shyExtend(r[n],s);return i},animate:function(t,n,r,i,s){t=e.parseOrders(t);if(zo.isEmpty(t)||e.markOfDeath)return;for(var o in e.parts)if(t[o]){e.parts[o].animate(t[o],n,r,i,s);i=null,s=e.K}return t},redraw:function(t,n,r,i,s){t=e.parseOrders(t);if(zo.isEmpty(t)||e.markOfDeath)return;for(var o in e.parts)if(t[o]){e.parts[o].redraw(t[o],n,r,i,s);i=null,s=e.K}},clearEvents:function(){e.forEach("clearEvents")},initialise:function(t){if(t.base)t=zo.clone(zo.remove(t,"base"),t);for(var n in t)if(t[n]&&t[n].type)e.parts[n]={};e.O=e.parseOrders(t);if(e.O.layout){if(e.O.margin!=null)e.O.layout.margin=e.O.margin;e.L=e.O.layout.type=="zLayout"?e.O.layout:new zLayout(e.O.layout,e)}}}),t,n)}function zMultiDrone(e,t,n,r,i){var s=this,o,u;zComplexDrone(s,e,"zMultiDrone");e=s.parseOrders(s.O);for(o in s.parts){u=s.add(e[o],o);if(!s.K)s.K=u.K}s.appear(t,n,r,i)}function zTextBox(e,t,n,r,i){var s=this,o,u;s.plotAccessories=function(e){if(s.parts.background)e.background.layout=s.L;if(s.parts.branch)e.branch.points=[s.L.radialStartPoint,s.L.radialEndPoint]};s.redraw=function(e,t,n,r,i){e=s.parseOrders(e);if(zo.isEmpty(e)||s.markOfDeath)return;s.parts.textObj.redraw(e.textObj,t,n,r,i);s.plotAccessories(e);if(s.parts.background)s.parts.background.redraw(e.background,t,n,null,s.K);if(s.parts.branch)s.parts.branch.redraw(e.branch,t,n,null,s.K)};s.initialise=function(e,t){if(e.base)e=zo.clone(zo.remove(e,"base"),e);if(e.background)e.background.type="zRectangle";if(e.branch&&e.layout.radialEnd!=null)e.branch.type="zLine";e.textObj=e.textObj||{};e.textObj.type="zText";for(o in e)if(e[o]&&e[o].type)s.parts[o]={};s.O=s.parseOrders(e);if(s.O.layout){if(s.O.margin!=null)s.O.layout.margin=s.O.margin;s.L=s.O.layout.type=="zLayout"?s.O.layout:new zLayout(s.O.layout,s)}};zComplexDrone(s,e,"zTextBox");s.add(s.O.textObj,"textObj");s.K=s.parts.textObj.K;s.L=s.parts.textObj.L;if(s.parts.background){s.O.background.layout=s.L;s.add(s.O.background,"background")}if(s.parts.branch){s.O.branch.points=[s.L.radialStartPoint,s.L.radialEndPoint];s.add(s.O.branch,"branch")}s.parts.textObj.toFront();s.appear(t,n,r,i)}function zTooltipBox(e){var t=new zTextBox(zo.extend({type:"zTooltipBox",text:"Empty tooltip",margin:10,layout:{},"font-size":14,fill:"#eee",background:{rounded:15,stroke:null,fill:"black",opacity:.85}},e));t.moveToEvent=function(e,n){var r=zt.getEventPosition(e);t.redraw({layout:zo.extend({x:Math.max(r.x-12,t.L.width),y:Math.max(r.y-12,t.L.height),xAlign:"right",yAlign:"bottom"},n)})};t.showAt=function(e,n,r,i,s){t.redraw(e);t.toFront();t.show(n,r,i,s)};t.type="zTooltipBox";t.hide();t.hover(function(){t.show(100)},function(){t.hide(100)});t.click(function(){t.hide(100)});return t}function zHTML(e,t,n,r,i){var s=this;s.add=function(e){var t=$("<div"+(e.setClass?" class="+e.setClass:"")+(e.setID?" id="+e.setID:"")+"></div>");s.raphObj=t;$("#Raphael").append(t);return t};s.animate=function(e,t,n,r,i){e=s.parseOrders(e);if(zo.isEmpty(e)||s.markOfDeath)return;s.stop();$(s.raphObj).animate(e,t||0,"linear",r);return e};s.clearEvents=function(){$(s.raphObj).unbind()};s.getBBox=function(e,t){if(e.content){s.raphObj.html(zo.remove(e,"content"));s.bBox={width:s.raphObj.width(),height:s.raphObj.height()}}return s.bBox};s.redraw=function(e,t,n,r,i){if(!e||s.markOfDeath)return;var o,e=s.parseOrders(e);s.getBBox(e);if(e.layout){s.L.setByBBox(s,e);o=zt.getDocumentPosition({x:s.L.left,y:s.L.top});zo.extend(e,{position:"absolute",left:o.x+"px",top:o.y+"px",width:s.autoWidth?"auto":Math.round(s.L.innerWidth)+"px",height:s.autoHeight?"auto":Math.round(s.L.innerHeight)+"px",padding:s.L.margin+"px"})}e=zo.clone(s.O,e);s.raphObj.attr("style",zo.asCSSString(e))};zSimpleDrone(s,e,"zHTML");s.bBox={};var o=e.layout;s.autoWidth=o.width=="auto"||!o.width&&!o.innerWidth;s.autoHeight=o.height=="auto"||!o.height&&!o.innerHeight;s.add(s.O);s.redraw(s.O);s.appear(t,n,r,i)}function zHTMLTooltipBox(e){var t=new zHTML(zo.extend({text:"Empty tooltip",layout:{},margin:10,opacity:.8,"z-index":9999,"-moz-box-shadow":"10px 10px 5px #888","-webkit-box-shadow":"10px 10px 5px #888","box-shadow":"5px 5px 5px #bbb",border:"solid 1px #c4dde2","border-radius":"10px","background-color":"#d4edf2","font-family":"sans-serif","font-size":"13px"},e));t.moveToEvent=function(e,n){var r=zt.getEventPosition(e);t.redraw({layout:zo.extend({x:Math.max(r.x-12,t.L.width),y:Math.max(r.y-12,t.L.height),xAlign:"right",yAlign:"bottom"},n)})};t.showAt=function(e,n,r,i,s){if(e.text)e.content=zo.remove(e,"text");t.redraw(e,null,null,function(){t.show(n,r,i,s)})};t.type="zHTMLTooltipBox";t.hide();t.hover(function(){t.show(100)},function(){t.hide(100)});t.click(function(){t.hide(100)});return t}function zNarrator(e){var t=new zHTML(zo.extend({setID:"narrator",margin:20,opacity:.92,"z-index":9999,"-moz-box-shadow":"10px 10px 5px #888","-webkit-box-shadow":"10px 10px 5px #888","box-shadow":"5px 5px 5px #bbb",border:"solid 1px #c4dde2","border-radius":"10px","background-color":"#d4edf2","font-family":"sans-serif","font-size":"13px",layout:{},content:"<div id='content'>bfgb</div><br><br>"+"<div id='nav'>"+"<a href=javascript:void(0) id='prev'>Prev</a>"+"<a href=javascript:void(0) id='next'>Next</a>"+"<div id='middle'>"+"<div id='pageCount'></div>"+"<a href=javascript:void(0) id='close'>Close</a>"+"</div>"+"</div>"},e));t.setScene=function(n){var r=t.script[n-1];t.page=n;if(n==1)t.elements.prev.hide();else if(n==2)t.elements.prev.show();else if(n==t.script.length-1)t.elements.next.html("Next");else if(n==t.script.length)t.elements.next.html("Close");else if(n>t.script.length){t.remove(200,"<>");if(e.onClose)e.onClose();return}t.elements.content.html(r.content);t.elements.pageCount.html(n+"/"+t.script.length);if(r.action)r.action();t.redraw({layout:r.layout})};t.type="zNarrator";t.script=e.script;t.elements={content:$("#narrator #content"),prev:$("#narrator #nav #prev"),next:$("#narrator #nav #next"),pageCount:$("#narrator #nav #middle #pageCount"),close:$("#narrator #nav #middle #close")};t.elements.close.click(function(){t.setScene(t.script.length+1)});t.elements.prev.click(function(){t.setScene(t.page-1)});t.elements.next.click(function(){t.setScene(t.page+1)});t.setScene(1);return t}function zDataCube(e){var t=this;t.isR=function(e){return e&&(e.isR||e.rs||e.r!=null)};t.parsePos=function(e){if(e==null)logger("zDataCube.parsePos(): null is not a valid pos.");else if(e.d==null)logger("zDataCube.parsePos(): No dimension defined ("+zt.asString(e)+").");else{if(e.a!=null)return{d:e.d,p:e.a};if(e.r!=null)return{d:e.d,p:e.r,isR:true};if(e.p!=null)return{d:e.d,p:e.p,isR:e.isR};if(za.isArray(e.as))return{d:e.d,p:e.as[e.d]};if(za.isArray(e.rs))return{d:e.d,p:e.rs[e.d],isR:true};if(za.isArray(e.s))return{d:e.d,p:e.s[e.d],isR:e.isR}}};t.parseSpace=function(e){if(e==null)return logger("zDataCube.parseSpace(): null is not a valid space.");var n=e.as||e.rs||e.s||e;if(za.isArray(n))return n.slice();else if(typeof n=="string"){if(n!="all"&&n!="mask")logger("zDataCube.parseSpace(): Only 'all' or 'mask' are valid strings for spaces. I don't know what "+zt.asString(n)+" is.");else return za.fill(n,t.dLen)}else{var r,i=t.parsePos(e);if(i){r=za.fill("mask",t.dLen);r[i.d]=i.p;return r}}logger("zDataCube.parseSpace(): "+zt.asString(e)+" is not a valid space.")};t.addSpaces=function(e,n){e=t.parseSpace(e);if(!n)return e;n=t.parseSpace(n);for(var r=0;r<t.dLen;r++)if(n[r]=="mask")n[r]=e[r];return n};t.asAPos=function(e){e=t.parsePos(e);if(!e)return;if(e.isR){if(e.p=="all")return t.shown[e.d].slice();if(typeof e.p=="number"||za.isArray(e.p))return za.map(t.shown[e.d],e.p);return e.p}else{if(e.p=="all")return za.fill(0,t.getSize(e.d),1);return e.p}};t.asRPos=function(e){e=t.parsePos(e);if(!e)return;if(!e.isR){if(e.p=="all")return za.unmap(t.shown[e.d],za.fill(0,t.getSize(e.d),1));if(typeof e.p=="number"||za.isArray(e.p))return za.unmap(t.shown[e.d],e.p);return e.p}else{if(e.p=="all")return za.fill(0,t.shown[e.d].length,1);return e.p}};t.asASpace=function(e){var n,r=t.isR(e),i=t.parseSpace(e);for(n=0;n<t.dLen;n++)i[n]=t.asAPos({d:n,p:i[n],isR:r});return i};t.asRSpace=function(e){var n,r=t.isR(e),i=t.parseSpace(e);for(n=0;n<t.dLen;n++)i[n]=t.asRPos({d:n,p:i[n],isR:r});return i};t.listSpaces=function(e){var n,r,s=[],o=[],u=[],a=t.isR(e)?t.asRSpace(e):t.asASpace(e);maskS=e.mask?t.parseSpace(e.mask):null;if(maskS)for(n=0;n<maskS.length;n++){if(maskS[n]!="mask")a[n]="mask"}for(n=0;n<t.dLen;n++){a[n]=za.asArray(a[n]);u[n]=a[n].length-1;if(u[n]<0)return o}r=za.count(u);for(i=0;i<r.length;i++){for(n=0;n<t.dLen;n++)s[n]=a[n][r[i][n]];o.push(t.addSpaces(s,maskS))}return o};t.forPos=function(e,n){var r,i=za.asArray(t.asAPos(e));for(r=0;r<i.length;r++)n({d:e.d,a:i[r]})};t.forSpaces=function(e,n){var r,i=t.listSpaces(e);for(r=0;r<i.length;r++)n({as:i[r]})};t.forGenerations=function(e,n,r,i,s){var o,u=t.getMeta("tree",{d:e});i=i||0;s=s||0;if(r){for(o=u.length-1-i;o>=s;o--){n({d:e,a:u[o]})}}else{for(o=i;o<u.length-s;o++){n({d:e,a:u[o]})}}};t.forMeta=function(e,n,r){var i,s;t.forPos(n,function(n){i=t.getMeta(e,n);s=r(i,n);t.setMeta(e,n,s)})};t.forData=function(e,n,r){var i,s;t.forSpaces(n,function(n){i=t.getData(e,n);s=r(i,n);t.setData(e,n,s)})};t.setShown=function(e,n){if(e!=null){t.oldShown[e]=t.shown[e];t.shown[e]=n||za.fill(0,t.getSize(e),1)}else for(e=0;e<t.dLen;e++)t.setShown(e)};t.filterShown=function(e,n,r,i,s){var o=t.getMeta(e,{d:n,r:"all"}),u=za.findAll(o,r,i,s),a=t.asAPos({d:n,r:u});t.setShown(n,a);return shown};t.getSize=function(e,n){if(e!=null){if(!t.meta[e].name)explode("zDataCube.getSize(): Dimension "+e+" does not contain name property.");else return n?t.shown[e].length:t.meta[e].name.length}else{for(var r=[],e=0;e<t.dLen;e++)r[e]=t.getSize(e,n);return r}};t.setMeta=function(e,n,r){if(e!=null&&e!="all"){var i,s=t.meta[n.d],o=t.asAPos(n);if(o==null)s[e]=r;else{if(!s[e]){logger("zDataCube.setMeta(): Creating new meta of type "+e+" in dimension "+n.d+".");s[e]=[]}if(typeof o=="number")s[e][o]=r;else if(za.isArray(o))for(i=0;i<o.length;i++){s[e][o[i]]=r}}}else for(e in r){if(e=="all")logger("zDataCube.setMeta(): 'all' is a reserved type name used to call up all types of metadata at once. Don't use it in your data.");else t.setMeta(e,n,r[e])}};t.getMeta=function(e,n){var r=t.asAPos(n),i=t.meta[n.d];if(e=="all"){var s,o;if(r==null)return null;if(za.isArray(r)){o=[];for(s=0;s<r.length;s++)o[s]=t.getMeta("all",{d:n.d,a:r[s]})}else{o={};for(e in i)o[e]=i[e][r];o.a=r}return o}else{if(!i[e])logger("zDataCube.getMeta(): Metadata type "+e+" in dimension "+n.d+" is empty or does not exist.");else return r==null?i[e]:za.map(i[e],r)}};t.getName=function(e){return t.getMeta("name",e)},t.findMeta=function(e,n,r,i,s){var o=t.asAPos(n),u=t.getMeta(e,n),a=za.find(u,r,i,s);return o==null?a:za.map(o,a)};t.findAllMeta=function(e,n,r,i,s){var o=t.asAPos(n),u=t.getMeta(e,n),a=za.findAll(u,r,i,s);return o==null?a:za.map(o,a)};t.shyPushMeta=function(e,n,r){var i=t.findMeta(e||"name",{d:n},r.name||r);if(i!=null)return i;i=t.getSize(n);t.shown[n].push(i);t.setMeta(e,{d:n,a:i},r);return i};t.calcMeta=function(e,n,r,i,s,o){var u=za.asArray(t.getMeta(n,r));return za.calc(e,u,i,s,o)};t.addCalcMeta=function(e,n,r,i,s,o){var u,a=t.asAPos(r),f=zt.camelCase([n,e]),l=t.calcMeta(e,n,r,i,s,o);for(u=0;u<a.length;u++){t.setMeta(f,{d:r.d,a:a[u]},l[u])}};t.setColour=function(e,n,r){n=n||zt.getPalette(null,12,"sequential");var i,s,o,u,a,f=[],l=[],h,p,d=t.asAPos(e);if(r=="hierarchic"||r=="randomHierarchic"){if(n.length<3)explode("zDataCube.setColour(): Can't do a hierarchic assignment with less than 3 colours.");i=t.meta[e.d].tree;for(s=0;s<i.length;s++)for(o=0;o<i[s].length;o++){if(!l.length)l=r=="hierarchic"?n.slice():za.getRandom(n,n.length);a=t.getMeta("all",{d:e.d,a:i[s][o]});for(u=0;u<l.length;u++){p=h&&f[h.a]==l[u]?false:a.parent!=null&&f[a.parent]==l[u]?false:true;if(p){f[a.a]=l.splice(u,1)[0];break}else if(u==l.length-1){u=-1;za.add(l,r=="hierarchic"?n.slice():za.getRandom(n,n.length))}}h=a}}else f=zt.getPalette(n,d.length,r||"sequential");t.setMeta("colour",{d:e.d},f)};t.addDataType=function(e,n){t.data[e]=n||[]};t.setData=function(e,n,r){za.setDeep(t.data[e],t.asASpace(n),r)};t.getData=function(e,n){return za.getDeep(t.data[e],t.asASpace(n))};t.calcData=function(e,n,r,i,s,o){var u=za.flatten(za.asArray(t.getData(n,r)));return za.calc(e,u,i,s,o)};t.addCalcData=function(e,n,r,i,s,o){var u,a=zt.camelCase([n,e]);if(!t.data[a])t.addDataType(a);t.forSpaces(r,function(r){var f=t.calcData(e,n,r,i,s,o),l=t.listSpaces(r);for(u=0;u<l.length;u++){t.setData(a,{as:l[u]},f[u])}});return t.getData(n,r)};t.makeTree=function(e){if(e!=null){var n,r,i=[],s,o=[],u=[],a=[],f=[],l=t.meta[e].parent,h=t.meta[e].parentName,p=h?h.length:l?l.length:null;if(h)for(l=[],n=0;n<t.getSize(e);n++){if(h[n]=="root"||h[n]==null)l[n]=null;else l[n]=t.shyPushMeta("name",e,h[n])}if(l)for(n=0;n<t.getSize(e);n++){r=l[n];if(r==n)explode("zDataCube.makeTree(): UH OH - "+t.getName({d:e,a:n})+" is its own parent. Space-time continuum collapsing.");l[n]=r==-1?null:r;o[n]=[];u[n]=0}else return;for(n=0;n<t.getSize(e);n++){r=l[n];if(r!=null)o[r].push(n)}i=za.findAll(l,null);while(i.length>0){s=[];for(n=0;n<i.length;n++){r=i[n];a[r]=f.length;za.add(s,o[r])}f.push(i);i=s}t.setMeta(null,{d:e},{parent:l,children:o,leaves:u,tree:f,generation:a});t.showNodes({d:e,a:"all"});logger("zDataCube.makeTree(): "+l.length+" nodes added into "+f.length+" generations, with "+(l.length-p)+" imputed nodes.")}else for(e=0;e<t.dLen;e++)t.makeTree(e)};t.addRootNode=function(e,n){var r,i=t.meta[e],s=t.findMeta("name",{d:e},n||"root");if(s==null)s=t.getSize(e);for(r=0;r<i.generation.length;r++){if(i.generation[r]==0)i.parent[r]=s;i.generation[r]++}t.setMeta(null,{d:e,a:s},{name:n||"root",parent:null,children:i.tree[0],generation:0,leaves:t.calcMeta("leaves",{d:e,a:i.tree[0]},"sum")});i.tree=[[s]].concat(i.tree);return t.getMeta("all",{d:e,a:s})};t.showNodes=function(e){var n,r,i,s=t.meta[e.d].leaves,o=za.asArray(t.asAPos(e));for(n=0;n<o.length;n++){e={d:e.d,a:o[n]};r=t.findParent(e);i=t.calcFamily("children","sum","leaves",e);t.setMeta("leaves",e,Math.max(1,i));za.shyPush(t.shown[e.d],e.a);if(r!=null)t.showNodes({d:e.d,a:r})}};t.hideNodes=function(e){var n,r,i,s,o,u=t.meta[e.d].leaves,a=t.asAPos(e);for(n=0;n<a.length;n++){e={d:e.d,a:a[n]};r={d:e.d,a:t.findParent(e)};i={d:e.d,a:t.findFamily("ancestors",e)};s={d:e.d,a:[a[n]].concat(t.findFamily("descendants",e))};o=t.getMeta("leaves",e);if(t.getMeta("leaves",r)>o)o--;t.forMeta("leaves",i,function(e){return e-o});t.setMeta("leaves",s,0);za.remove(t.shown[e.d],s)}};t.findFamily=function(e,n,r){var i=[],s;if(e=="all"){i=t.asAPos(n)}else if(e=="parent"){i=t.getMeta("parent",n)}else if(e=="children"){i=t.getMeta("children",n)}else if(e=="descendants"){s=za.flatten(t.findChildren(n,r));while(s!=null&&s.length>0){za.add(i,s);s=za.flatten(t.findChildren({d:n.d,a:s},r))}}else{var o,u,a,f=t.asAPos(n);if(e=="siblings"){u=t.findParent(n);a=za.flatten(t.findChildren({d:n.d,a:u}));i=za.subtract(a,f)}else if(e=="ancestors"){for(o=0;o<t.getMeta("generation",n);o++){f=t.findParent({d:n.d,a:f});if(f==null)break;i.push(f)}}}if(r&&za.isArray(i))return za.asArray(t.findAllMeta("leaves",{d:n.d,a:i},0,">"));else return i};t.findParent=function(e){return t.findFamily("parent",e)};t.findChildren=function(e,n){return t.findFamily("children",e,n)};t.findRelationship=function(e,n,r){if(t.asAPos({d:e,a:n})==null)return logger("zDataCube.findRelationship(): startAPos "+zt.asString(n)+" is not valid.");if(t.asAPos({d:e,a:r})==null)return logger("zDataCube.findRelationship(): endAPos "+zt.asString(r)+" is not valid.");var i,s,o=za.add([n],t.findFamily("ancestors",{d:e,a:n}));endToRoot=za.add([r],t.findFamily("ancestors",{d:e,a:r})).reverse();for(i=0;i<o.length;i++){s=za.find(endToRoot,o[i]);if(s!=null)return za.add(o.slice(0,i),endToRoot.slice(s))}return[]};t.getFamily=function(e,n,r){var i=t.findFamily(e,r);return t.getMeta(n,{d:r.d,a:i})};t.calcFamily=function(e,n,r,i,s){var o=t.findFamily(e,i,s),u=t.getMeta(r,{d:i.d,a:o});return za.calc(n,u)};t.calcTreeMeta=function(e,n,r){if(e=="stacked"){var i=t.meta[r].tree;t.addCalcMeta("stacked",n,{d:r,a:i[0]},0);t.forGenerations(r,function(e){t.forPos(e,function(e){var i,s=t.getMeta(n+"Stacked",e),o={d:r,a:t.findChildren(e)};t.addCalcMeta("stacked",n,o,s.start);i=za.mergeStacked(t.getMeta(n+"Stacked",o))})},false,0,1)}else{t.forGenerations(r,function(r){t.forMeta(n,r,function(r,i){var s=t.calcFamily("children",e,n,i);return s})},true,1,0)}};t.calcTreeData=function(e,n,r){if(e=="stacked"){t.forSpaces({as:"all",mask:{d:r,a:"na"}},function(e){e.as[r]=t.getMeta("tree",{d:r})[0];t.addCalcData("stacked",n,e,0);t.forGenerations(r,function(i){t.forSpaces({as:t.addSpaces(e,i)},function(e){var i,s=t.getData(n+"Stacked",e),o={d:r,a:t.findChildren({d:r,as:e.as})};e.mask=o;t.addCalcData("stacked",n,e,s.start);i=za.mergeStacked(t.getData(n+"Stacked",t.addSpaces(e.as,o)))})},false,0,1)})}else{t.forSpaces({as:"all",mask:{d:r,a:"na"}},function(i){t.forGenerations(r,function(s){t.forData(n,{as:t.addSpaces(i,s)},function(s,o){i.as[r]=t.findChildren({d:r,as:o.as});var u=t.calcData(e,n,i);return u})},true,1,0)})}};t.treemap=function(e,n,r){var i,s,o,u,a,f,l,h,p=[],d=t.getMeta("all",e),v=za.sum(za.getAll(n,0,">")),m=r instanceof zLayout?r.getVitals():zp.completeBox(r),g=m.xAlign=="right"?"right":"left",y=m.yAlign=="bottom"?"bottom":"top",b=g=="right"?-1:1,w=y=="bottom"?-1:1;for(i=0;i<d.length;i++){d[i].area=isNaN(n[i])||n[i]<=0?0:m.width*m.height*n[i]/v}d=za.sortObjects(d,"area",true);for(i=0;i<d.length;null){u=[d[i]];a=Math.min(m.width,m.height)-Math.sqrt(d[i].area);for(i++;i<d.length&&a>=0;i++){a-=Math.sqrt(d[i].area);u.push(d[i])}f=za.calcObjects(u,"area","sum")/Math.min(m.width,m.height);if(f<=0){for(s=0;s<u.length;s++){o=u[s];t.setMeta("layout",{d:e.d,a:o.a},{x:m[g],y:m[y],width:0,height:0,xAlign:g,yAlign:y})}}else if(m.width<m.height){l=m[g];for(s=0;s<u.length;s++){o=u[s];t.setMeta("layout",{d:e.d,a:o.a},{x:l,y:m[y],width:o.area/f,height:f,xAlign:g,yAlign:y});l+=b*o.area/f}m[y]+=w*f;m.height-=f}else{h=m[y];for(s=0;s<u.length;s++){o=u[s];t.setMeta("layout",{d:e.d,a:o.a},{x:m[g],y:h,width:f,height:o.area/f,xAlign:g,yAlign:y});h+=w*o.area/f}m[g]+=b*f;m.width-=f}}};t.importStrip=function(e,n){var r,i,s,o,u,a,f,l=[],h={};for(r=0;r<e[0].length;r++){i=e[0][r].split("~");if(i.length==2){s=i[0];u=i[1];l[s]=l[s]||{};if(l[s][u])logger("zDataCube.importStrip(): UH OH - "+l[s][u]+" already exists.");l[s][u]=r}else if(i.length==1){u=i[0];h[u]=r}else logger("zDataCube.importStrip(): UH OH - I don't understand header "+e[0][r]+". Metadata headers should be [dimension]~[type] (e.g. '0~name'), data headers should be [type] (e.g. 'data').")}if(zo.isEmpty(h))logger("zDataCube.importStrip(): UH OH - no data found in strip.");if(zo.isEmpty(l))logger("zDataCube.importStrip(): UH OH - no metadata found in strip.");for(s=0;s<l.length;s++)if(l[s].name==null)logger("zDataCube.importStrip(): UH OH - no name found for dimension "+s+".");if(!n)t.initialise(l.length);for(o in h)t.addDataType(o);for(r=1;r<e.length;r++){a=e[r];f=[];for(s=0;s<t.dLen;s++){f[s]=t.findMeta("name",{d:s},a[l[s].name]);if(f[s]==null){i={};for(o in l[s])i[o]=a[l[s][o]];f[s]=t.shyPushMeta(null,s,i)}}for(o in h)t.setData(o,{as:f},a[h[o]])}t.setShown();t.makeTree();return t};t.importDumb=function(e){t.meta[0]["name"]=e||[];t.setShown();return t};t.importProtoCube=function(e){t.dLen=e.meta.length;t.meta=e.meta;t.data=e.data;t.setShown();var n,r,i,s=t.getSize();for(r in t.data){i=za.deepLength(t.data[r]);if(i.length!=s.length){logger("zDataCube.importProtoCube(): Data type "+r+" has "+i.length+" dimensions but "+s.length+" dimensions have been defined in meta.")}for(n=0;n<t.dLen;n++)if(i[n]!=s[n]){logger("zDataCube.importProtoCube(): Data type "+r+" has "+i[n]+" elements in dimension "+n+" but meta has "+s[n]+" elements: "+zt.asString(t.meta[n].name)+".")}}return t};t.exportProtoCube=function(){return zt.asString({meta:t.meta,data:t.data})};t.initialise=function(e){t.meta=[];t.shown=[];t.oldShown=[];t.data={};t.dLen=e;for(var n=0;n<e;n++){t.meta[n]={name:[]};t.shown[n]=[];t.oldShown[n]=[]}};t.type="zDataCube";t.initialise(e)}function zSwarmConstructor(e,t,n){zo.shyExtend(e,{forSwarms:function(t,n,r,i,s,o,u){for(var a=e.swarms.length-1;a>=0;a--){if(typeof t=="function")t(e.swarms[a],n,r,i,s,o,u);else if(e.swarms[a][t])e.swarms[a][t](n,r,i,s,o,u)}},forOwnedSwarm:function(t,n,r,i,s,o,u){for(var a=e.swarms.length-1;a>=0;a--)if(e.swarms[a]!=e){if(typeof t=="function")t(e.swarms[a],n,r,i,s,o,u);else if(e.swarms[a][t])e.swarms[a][t](n,r,i,s,o,u)}},forDrones:function(t,n,r,i,s,o,u,a){var f,l=e.get(t);if(!l)return;if(typeof n=="string"){for(f=l.length-1;f>=0;f--){if(l[f][n]){if(l[f].class=="zSwarm")l[f][n]("swarm",r,i,s,o,u,a);else l[f][n](r,i,s,o,u,a)}}}else if(typeof n=="function"){for(f=l.length-1;f>=0;f--){n(l[f])}}},forRoles:function(t,n,r,i,s,o,u){for(var a in e.P)if(e.P[a]&&!e.P[a].ignore)t(e.P[a])},lock:function(){if(e.locked!="Superlocked")e.locked=Math.round(Math.random()*9e3)+999},unlock:function(){if(e.locked!="Superlocked")e.locked=null},superLock:function(){e.locked="Superlocked"},superUnlock:function(){e.locked=null},getRole:function(t){var n=t.role?t.role:typeof t=="string"&&t!="all"&&t!="mask"&&t!="fixed"?t:null;return n?e.P[n]:null},addDimension:function(t){if(t!=null&&t.d==null&&(t.a!=null||t.r!=null||t.as||t.rs))t.d=e.d;return t},asAPos:function(t){return e.dc.asAPos(e.addDimension(t))},asRPos:function(t){return e.dc.asRPos(e.addDimension(t))},asASpace:function(t){return e.dc.asASpace(e.addDimension(t))},asRSpace:function(t){return e.dc.asRSpace(e.addDimension(t))},setSpace:function(t,n,r,i,s){var o=t.d==null?e.d:t.d,u=e.asAPos(t),a=e.asRPos(t);if(a!=null){if(typeof a=="number"){if(u==null)return logger(e.type+".setSpace(): Found rPos for "+zt.asString(t)+", but it doesn't match to a valid aPos.");if(typeof e.R[o]=="number")e.R[o]=a;e.forRoles(function(t){if(t.mask=="fixed")return;if(t.mask[o]=="number")t.mask[o]=a;if(typeof e.dc.addSpaces(e.R,t.mask)[o]=="number"){e.forDrones(t.name,function(e){e.A[o]=u})}})}else if(za.isArray(a)){if(za.isArray(e.R[o])||e.R[o]=="all"){e.R[o]=a.slice();e.forRoles(function(t){if(t.mask[o]!="mask")return;e.forDrones(t.name,function(t){if(!za.contains(u,t.A[o]))t.remove(n,r,null,s||e.K)});e.add(t.name,n,r,null,s||e.K)});if(!s||i)e.G.redraw(n,r,i,s)}else explode(e.type+".setSpace(): Can't change "+zt.asString(e.R[o])+" to "+zt.asString(a)+".")}else explode(e.type+".setSpace(): "+za.asString(t)+" contains rPos ("+za.asString(a)+"), but is neither an array nor a number.")}else logger(e.type+".setSpace(): No rPos or rMask specified ("+zt.asString(t)+").")},disaggregate:function(t,n,r,i,s){if(t.d==null)t.d=e.d;var o=e.dc.shown,u=e.dc.asRPos(t),a=e.dc.asAPos(t),f=e.dc.findChildren(t);if(!f.length)return;o[t.d]=za.subtract(o[t.d],a);o[t.d]=za.insertAt(o[t.d],f,u);e.updateData(n,r,null,e.K);e.remove({d:t.d,a:a},n,r,null,e.K);e.add({d:t.d,a:f,mode:{asParent:true}},n,r,i,s)},aggregate:function(t,n,r,i,s){if(t.d==null)t.d=e.d;var o=e.dc.shown,u=e.dc.asRPos(t),a=e.dc.findParent(t),f=e.dc.findChildren({d:t.d,a:a});if(a==null)return;o[t.d]=za.subtract(o[t.d],f);o[t.d]=za.shyInsert(o[t.d],a,u);e.updateData(n,r,null,e.K);e.remove({d:t.d,a:f,mode:{asParent:true}},n,r,null,e.K);e.add({d:t.d,a:a},n,r,i,s)},get:function(t){if(za.isArray(t))return t;else if(t==null||t=="swarm"||t=="all"||t.all)return e.drones;else if(t=="curr"||t.curr)return e.currDrones;else if(t=="fixed")return za.getAllObjects(e.drones,"A","fixed");else if(t.string||typeof t=="string")return za.getAllObjects(e.drones,"role",t.string||t);else if(t.role&&t.d==null)return za.getAllObjects(e.drones,"role",t.role);var n,r,i,s=e.asASpace(t),o=t.role?za.getAllObjects(e.drones,"role",t.role):e.drones;for(n=0;n<s.length;n++){if(o.length==0)break;if(typeof s[n]=="number"){o=za.getAllObjects(o,"A",s[n],"atPos",n)}else if(za.isArray(s[n])){i=[];for(r=0;r<o.length;r++){if(za.contains(s[n],o[r].A[n]))i.push(o[r])}o=i}}return o},setCurrDrones:function(t){return e.currDrones=e.get(t)},plot:function(t,n){var r,i,s=e.get(t),o=t&&t.mode?t.mode:{};for(r=0;r<s.length;r++){i=s[r];i.oldOrders=i.currOrders;i.newOrders=e.P[i.role].curr?e.P[i.role].curr(e,i.A,i,e.Y[i.role],o):{};i.noChange=!n&&zo.equals(i.newOrders,i.oldOrders);zo.extend(i.O,i.parseOrders(i.newOrders))}},layer:function(){var t,n,r=[],i=function(e){var t=e.O.layer*1;if(t!=null&&!isNaN(t)){r[t]=r[t]||[];r[t].push(e)}else if(e.type=="zMultiDrone"){for(n in e.parts)i(e.parts[n])}};e.forDrones("all",i);for(t=0;t<r.length;t++)if(r[t])e.forDrones(r[t],"toFront")},addDrone:function(t,n,r,i,s,o,u){var a,f=e.P[t],l={id:zt.asString(n)+" "+t,A:n,role:t,parent:e,directRedraw:f.directRedraw};if(za.getObject(e.drones,"id",l.id))return;l.currOrders=f.curr?f.curr(e,n,l,e.Y[t],r)||{}:{};a=zo.clone(e.Y[t]);a=zo.extend(a,l.currOrders);a=zo.extend(a,f.init?f.init(e,n,l,e.Y[t],r)||{}:{});if(a.ignore)return;else if(typeof f.type=="string"||typeof f.type=="function"){l=zo.extend(zDrones.make(f.type,a,i,s,o,u),l);e.drones.push(l);if(l.O.onAdd)l.O.onAdd(l);if(l.O.mouseEvents)l.O.mouseEvents(l)}else logger(e.type+".addDrone(): Plan.type ("+f.type+" is invalid.")},addRole:function(t,n,r,i,s,o,u){if(t.mask=="fixed")e.addDrone(t.name,"fixed",r,i,s,o,u);else{var a,f=e.dc.listSpaces({rs:t.rSpace||n,mask:{rs:t.mask}});for(a=0;a<f.length;a++){e.addDrone(t.name,e.asASpace({rs:f[a]}),r,i,s,o,u);o=null}}},add:function(t,n,r,i,s){var o=e.getRole(t),u=zo.extend({initialising:true},t.mode),a=e.dc.addSpaces(e.R,typeof t=="string"?null:e.asRSpace(t));u.initialising=true;if(o){o.ignore=false;e.addRole(o,a,u,n,r,null,s||e.K)}else if(t=="fixed"){e.forRoles(function(t){if(t.mask=="fixed")e.addRole(t,a,u,n,r,null,s||e.K)})}else{e.forRoles(function(t){if(t.mask!="fixed")e.addRole(t,a,u,n,r,null,s||e.K)})}e.layer();if(!s||i)e.G.redraw(n,r,i,s)},remove:function(t,n,r,i,s){if(t=="swarm"){if(n){e.clearEvents();e.hide("all",n,r,function(){e.remove("swarm",null,null,i)},s)}else{e.markOfDeath=true;if(e.parent&&e.parent.drones)za.remove(e.parent.drones,e);e.forDrones("all","remove");delete e;if(i)i()}}else{var o=e.getRole(t);if(o)o.ignore=true;e.forDrones(t,"remove",n,r,null,s||e.K);if(!s||i)e.G.redraw(n,r,i,s)}},show:function(t,n,r,i,s){e.forDrones(t,"show",n,r,null,s||e.K);if(!s||i)e.G.redraw(n,r,i,s)},hide:function(t,n,r,i,s){e.forDrones(t,"hide",n,r,null,s||e.K);if(!s||i)e.G.redraw(n,r,i,s)},invisibleShow:function(t){e.forDrones(t,"invisibleShow")},appear:function(t,n,r,i,s){e.forDrones(t,"appear",n,r,null,s||e.K);if(!s||i)e.G.redraw(n,r,i,s)},toFront:function(t){e.forDrones(t,"toFront")},toBack:function(t){e.forDrones(t,"toBack")},parseOrders:function(e){return e},animate:function(t,n,r,i,s,o){e.forDrones(t,"animate",n,r,i,null,o||e.K);if(!o||s)e.G.redraw(r,i,s,o)},frameRedraw:function(t,n){e.forDrones(t,function(e){e.currOrders=zo.mid(e.oldOrders,e.newOrders,n);if(e.class=="zSwarm")e.frameRedraw("all",n);else e.redraw(e.currOrders);if(e.O.onRedraw)e.O.onRedraw(e)});e.currDec=n;e.frame++},redraw:function(t,n,r,i,s,o){e.forDrones(t,"redraw",n,r,i,null,o||e.K);if(!o||s)e.G.redraw(r,i,s,o)},refresh:function(t,n,r,i,s){var o,u,a=[],f=[],l=e.thread=Math.round(Math.random()*1e3),h=t&&t.mode?t.mode:{},p=e.setCurrDrones(t);e.frame=0;if(e.currDec<1)e.frameRedraw(p,e.currDec,true);if(!h.noUpdateData&&e.updateData)e.updateData(n,r,null,e.K);e.plot({curr:true,mode:h});e.preRedraw(p);if(h.forceFrameRedraw)a=p;else if(h.forceDirectRedraw)f=p;else{a=p.slice();f=za.removeAllObjects(a,"directRedraw",true)}za.removeAllObjects(a,"noChange",true);za.removeAllObjects(a,"markOfDeath",true);za.removeAllObjects(f,"noChange",true);za.removeAllObjects(f,"markOfDeath",true);if(e.currDec==1){e.clearEvents("all");e.G.onAnimation(function(){e.frameRedraw(a,e.G.getVal())})}e.G.redraw(n,r,function(){if(e.thread!=l)return;e.G.onAnimation();e.frameRedraw(p,1);e.postRedraw(p);e.mouseEvents("all");if(i)i()},s);for(o=0;o<f.length;o++){u=f[o];u.redraw(u.newOrders,n,r,null,e.K)}},stop:function(t){e.G.stop();e.forDrones(t,"stop")},setOrders:function(t,n,r,i,s,o){e.forDrones(t,"setOrders",n,r,i,null,o||e.K);if(!o||s)e.G.redraw(r,i,s,o)},addOrders:function(t,n,r,i,s,o){e.forDrones(t,"addOrders",n,r,i,null,o||e.K);if(!o||s)e.G.redraw(r,i,s,o)},setMode:function(t,n,r,i,s,o){e.forDrones(t,"setMode",n,r,i,null,o||e.K);if(!o||s)e.G.redraw(r,i,s,o)},unsetMode:function(t,n,r,i,s){e.forDrones(t,"unsetMode",n,r,null,s||e.K);if(!s||i)e.G.redraw(n,r,i,s)},highlight:function(t,n,r,i,s){var o=e.asAPos(t),u=za.subtract(o,e.highlighted),a=za.subtract(e.highlighted,o);e.forDrones({d:t.d==null?e.d:t.d,a:a},"reset",n,r,null,s||e.K);e.forDrones({d:t.d==null?e.d:t.d,a:u},"highlight",n,r,null,s||e.K);if(!s||i)e.G.redraw(n,r,i,s);e.highlighted=o},reset:function(t,n,r,i,s){e.forDrones(t,"reset",n,r,null,s||e.K);if(!s||i)e.G.redraw(n,r,i,s);e.highlighted=[]},select:function(t,n,r,i,s){e.forDrones(e.selected,"deselect",n,r,null,s||e.K);e.forDrones(t,"select",n,r,null,s||e.K);e.oldSelected=e.selected;e.selected={d:e.d,a:e.asAPos(t),r:e.asRPos(t)};if(!s||i)e.G.redraw(n,r,i,s)},deselect:function(t,n,r,i,s){e.unsetMode(t,n,r,i,s)},clearEvents:function(t){e.forDrones(t,"clearEvents")},enableEvents:function(t){e.forDrones(t,"enableEvents")},disableEvents:function(t){e.forDrones(t,"disableEvents")},click:function(t,n){e.forDrones(t,"click",n)},dblclick:function(t,n){e.forDrones(t,"dblclick",n)},mousedown:function(t,n){e.forDrones(t,"mousedown",n)},mouseup:function(t,n){e.forDrones(t,"mouseup",n)},mousemove:function(t,n){e.forDrones(t,"mousemove",n)},touchstart:function(t,n){e.forDrones(t,"touchstart",n)},touchMove:function(t,n){e.forDrones(t,"touchMove",n)},touchend:function(t,n){e.forDrones(t,"touchend",n)},touchcancel:function(t,n){e.forDrones(t,"touchcancel",n)},hover:function(t,n,r){e.forDrones(t,"hover",n,r)},drag:function(t,n,r,i){e.forDrones(t,"drag",n,r,i)},onAnimation:function(t,n){e.forDrones(t,"onAnimation",n)},hoverHighlight:function(t,n,r){e.forDrones(t,"hoverHighlight",n,r)},tooltip:function(t,n,r,i){e.forDrones(t,"tooltip",n,r,i)},mouseEvents:function(t){e.clearEvents(t);e.forDrones(t,function(e){if(e.O.mouseEvents)e.O.mouseEvents(e);else if(e.mouseEvents)e.mouseEvents("all")})},preRedraw:function(t,n,r,i,s){e.forDrones(t,function(e){if(e.O.preRedraw)e.O.preRedraw(e,n,r,i,s);else if(e.preRedraw)e.preRedraw("all",n,r,i,s)})},postRedraw:function(t,n,r,i,s){e.forDrones(t,function(e){if(e.O.postRedraw)e.O.postRedraw(e,n,r,i,s);else if(e.postRedraw)e.postRedraw("all",n,r,i,s)})},zoom:function(t,n,r,i,s,o){e.L.zoom(t,n);e.refresh("all",r,i,s,o)},move:function(t,n,r,i,s){e.L.set(t);e.refresh("all",n,r,i,s)},initialise:function(t,n){var r;e.type=n;e.class="zSwarm";e.drones=[];e.axes={};e.style={};e.plan={};e.layout={};e.highlighted=[];for(r in t)e[r]=t[r];for(r in e.plan){if(e.plan[r]){e.plan[r].name=r;if(e.plan[r].mask!="fixed")e.plan[r].mask=e.dc.parseSpace(e.plan[r].mask)}else delete e.plan[r]}if(e.layout instanceof zLayout){if(e.style.margin!=null)e.layout.set({margin:e.style.margin})}else{if(e.style.margin!=null)e.layout.margin=e.style.margin;e.layout=new zLayout(e.layout)}e.currDec=1;e.guide=new zGuide(true);e.guide.parent=e;e.O=t;e.P=e.plan;e.L=e.layout;e.Y=zo.parseStyle(e.style);e.R=e.rSpace;e.G=e.guide;e.K=e.G.K;if(e.axes)for(r in e.axes)if(e.axes[r].swarms)e.axes[r].swarms.push(e);if(e.onInit)e.onInit()}});e.initialise(t,n)}function zAxisConstructor(e,t){zSwarmConstructor(e,zo.extend({dc:null,d:null,rSpace:null,range:[],selected:null,swarms:[e],layout:{rotation:0},style:{extension:.5,perpendicularSize:1,parallelSize:.6,select:{t:500,e:"<>"},highlight:{t:200,e:"-"},background:null,axisLine:{},axisTitle:{},label:{margin:5,branch:null}},pointToRPos:function(t){var n=e.L.getDec(t).x;return zt.calcMid(e.range[0]-e.Y.extension,e.range[1]+e.Y.extension,n)},pointToAPos:function(t){var n=Math.round(zt.forceBetween(e.pointToRPos(t),e.range[0],e.range[1]));return e.asAPos({d:e.d,r:n})},getOffset:function(t){var n=e.asRPos(t),r=zt.calcDec(n,e.range[0]-e.Y.extension,e.range[1]+e.Y.extension);return e.L.getOffset(r,e.L.yAlign=="yCentre"?.5:0,true)},addOffset:function(t,n){return zo.add(e.getOffset(t),n)},getPoint:function(t){return e.addOffset(t,e.L)},getX:function(t){return e.getPoint(t).x},getY:function(t){return e.getPoint(t).y},getLength:function(t){return e.L.width*t/(e.range[1]-e.range[0]+2*(e.Y.extension||0))},setShown:function(t){t=t||e.dc.shown[e.d];var n,r;if(e.Y.maxNotches){r=Math.ceil(t.length/e.Y.maxNotches)}else if(e.Y.notchStep){r=e.Y.notchStep}if(r){e.trimmedShown=[];for(n=za.max(t);n>=za.min(t);n-=r)e.trimmedShown.push(n);e.trimmedShown.reverse()}e.dc.setShown(e.d,t);e.range=[0,Math.max(e.dc.getSize(e.d,true)-1,1)]},axisSelect:function(t,n,r,i,s){if(!t.forced&&e.asRPos(t)==e.selected.r)return;e.select(t,n,r,i,s);e.forOwnedSwarm("setSpace",t);e.forSwarms("refresh","all",n,r,null,e.K);if(e.onSelect)e.onSelect(n,r,null,s||e.K)},replace:function(t,n,r,i,s){e.setShown(t);e.forSwarms("updateData",n,r,null,e.K);e.forSwarms("add",{a:za.subtract(e.dc.shown[e.d],e.dc.oldShown[e.d])},n,r,null,e.K);e.forSwarms("remove",{a:za.subtract(e.dc.oldShown[e.d],e.dc.shown[e.d])},n,r,null,e.K);e.forSwarms("layer");if(!s||i)e.G.redraw(n,r,i,s)},disaggregate:function(t,n,r,i,s){if(t.d==null)t.d=e.d;var o=e.dc.asAPos(t),u=e.dc.findChildren(t);if(!u||!u.length)return;e.forSwarms("add",{d:t.d,a:u,mode:{disaggregate:true}});e.forSwarms("remove",{d:t.d,a:o});e.forSwarms("refresh","all",n,r,null,e.K);e.G.redraw(n,r,i,s)},aggregate:function(t,n,r,i,s){if(t.d==null)t.d=e.d;var o=e.dc.findParent(t),u=e.dc.findChildren({d:t.d,a:o});if(o==null)return;e.forSwarms("refresh",{d:t.d,a:u,mode:{aggregate:true}},n,r,null,e.K);e.G.redraw(n,r,function(){e.forSwarms("add",{d:t.d,a:o});e.forSwarms("remove",{d:t.d,a:u});if(i)i()},s)},plan:{axisLine:{type:"zLine",mask:"fixed",curr:function(e,t,n,r){return{layer:10,points:[e.L.getPoint(0,0),e.L.getPoint(1,0)]}}},axisTitle:{type:"zTextBox",mask:"fixed",init:function(e,t,n,r){var i=zt.isBetween(e.L.rotation,90,270)?zp.inverseDeg(e.L.rotation):e.L.rotation;return{text:e.title,layout:{anchor:e.L.getPoint(.5,1),xAlign:"xCentre",yAlign:"top",rotation:i}}}},label:{type:"zTextBox",mask:"mask",init:function(t,n,r,i){if(t.trimmedShown&&!za.contains(t.trimmedShown,n[t.d]))return{ignore:true};return{layer:1,text:t.dc.getName({d:t.d,a:n[t.d]}),layout:t.L.yAlign=="yCentre"?{xAlign:"xCentre",yAlign:"yCentre"}:{radial:(t.L.rotation||0)+(t.L.yAlign=="top"?90:-90),radialEnd:e.notchHeight},mouseEvents:t.baseMouseEvents}},curr:function(e,t,n,r){return{layout:e.getPoint({a:t[e.d]})}}}}},t),"zUndefinedAxis");e.R=za.fill("na",e.dc.dLen);e.R[e.d]="all";e.maxShown=e.Y.collapsedShown||e.Y.expandedShown;e.setShown()}function zAxis(e,t,n,r,i){var s=this;zAxisConstructor(s,zo.extend({type:"zAxis",dc:(new zDataCube(1)).importDumb(),d:0,rSpace:["all"],range:[0,100],title:null,layout:{rotation:0},style:{extension:0,maxNotches:10,clipMargin:20,label:{format:{dp:10},radialStart:0,radialEnd:6,margin:10}},getClipRect:function(){if(s.L.rotation==0||s.L.rotation==180){return[s.L.left-s.Y.clipMargin,0,s.L.right-s.L.left+s.Y.clipMargin*2,PAPER.height]}else if(s.L.rotation==90||s.L.rotation==270){return[0,s.L.top-s.Y.clipMargin,PAPER.width,s.L.bottom-s.L.top+s.Y.clipMargin*2]}},getOffset:function(e){return s.L.getOffset(zt.calcDec(e,s.range[0],s.range[1]),0,true)},setShown:function(e,t,n,r,i){var o,u,a,f,l=[];e=e||s.range;if(isNaN(e[0])||isNaN(e[1])||e[0]==e[1])return logger("zAxis(): Called with invalid range "+zt.asString(e));e=za.sort(e);u=(e[1]-e[0])/(s.Y.maxNotches||10);u=zt.getFactorOfTen(u);if(s.label)u=Math.max(u,1);if(s.Y.minNotchGap)u=Math.max(u,s.Y.minNotchGap);a=u*Math.ceil(e[0]/u);for(o=a;o<=e[1];o+=u)l.push(o);f=za.subtract(s.dc.shown[0],l);s.dc.setShown(0,l);if(s.P["label"]&&!s.P["label"].ignore)s.add("label");s.remove({a:f});s.range=e;s.refresh("all",t,n,r,i)},plan:{label:{type:"zTextBox",mask:"mask",init:function(e,t,n,r){return{text:t[0],layout:{radial:(e.L.rotation||0)+(e.L.yAlign=="top"?90:-90),radialStart:r.radialStart,radialEnd:r.radialEnd},"clip-rect":e.getClipRect(),branch:t[0]==0?r.baseBranch:r.branch}},curr:function(e,t,n,r){return{layout:e.getPoint(t[0])}}}}},e));if(s.updateData)s.updateData(t,n,null,s.K);s.add("fixed",t,n,null,s.K);s.add("all",t,n,r,i);s.layer()}function zSmartAxis(e,t,n,r,i){var s=this;zAxisConstructor(s,zo.extend({type:"zSmartAxis",updateData:function(){if(s.Y.parallelSize)s.notchWidth=s.Y.parallelSize*s.L.innerWidth/s.dc.getSize(s.d,true);if(s.Y.perpendicularSize)s.notchHeight=s.Y.perpendicularSize*s.L.height}},e));if(s.baseSelected)s.baseSelected={d:s.d,a:s.asAPos(s.baseSelected),r:s.asRPos(s.baseSelected)};if(s.selected)s.selected={d:s.d,a:s.asAPos(s.selected),r:s.asRPos(s.selected)};if(s.updateData)s.updateData(t,n,null,s.K);s.add("fixed",t,n,null,s.K);s.add("all",t,n,r,i);s.layer();if(s.selected)s.axisSelect({forced:true,a:s.selected.a,r:s.selected.r},t,n,null,s.K)}function zLegend(e,t,n,r,i){return new zSmartAxis(zo.extend({type:"zLegend",style:{notch:{rounded:0,"stroke-opacity":.2,highlight:{"stroke-opacity":1},select:{"stroke-opacity":1}}},plan:{notch:{init:function(e,t,n,r){return{fill:e.dc.getMeta("colour",{d:e.d,a:t[e.d]})}}}}},e),t,n,r,i)}function zSelectAxis(e,t,n,r,i){return new zSmartAxis(zo.extend({type:"zSelectAxis",baseMouseEvents:function(e){var t=e.parent,n={d:t.d,a:e.A[t.d]},r=t.Y.highlight,i=t.Y.select;e.click(function(){t.axisSelect(n,i.t,i.e)});e.hover(function(){t.highlight(n,r.t,r.e)},function(){t.reset(n,r.t,r.e)})}},e),t,n,r,i)}function zMultiSelectAxis(e,t,n,r,i){return new zSelectAxis(zo.extend({type:"zMultiSelectAxis",selected:{a:[],r:[]},axisSelect:function(e,t,n,r,i){var s=this;s.select(e,t,n,r,i);s.forOwnedSwarm("setSpace",e);s.forSwarms("refresh","all",t,n,null,s.K);if(s.onSelect)s.onSelect(t,n,null,i||s.K)},select:function(e,t,n,r,i){var s,o=this,u=o.asRPos(e);if(za.isEmpty(u))return;u=za.asArray(u);for(s=0;s<u.length;s++){if(za.contains(o.selected.r,u[s])){za.remove(o.selected.r,u[s]);o.forDrones({r:u[s]},"deselect",t,n,null,i||o.K)}else{o.selected.r.push(u[s]);o.forDrones({r:u[s]},"select",t,n,null,i||o.K)}}o.selected.a=o.asAPos({r:o.selected.r});if(!i||r)o.G.redraw(t,n,r,i)}},e),t,n,r,i)}function zDragSelectAxis(e,t,n,r,i){return new zSmartAxis(zo.extend({type:"zDragSelectAxis",selected:{a:[],r:[]},baseMouseEvents:function(e){var t=e.parent,n={d:t.d,a:e.A[t.d]},r=t.Y.highlight,i=t.Y.select;e.drag(null,function(){t.dragRange=[n.a,n.a];t.deselect({a:"all"},r.t,r.e);t.select({a:[n.a]},r.t,r.e)},function(){if(!t.dragRange)return;t.axisSelect({a:za.fillRange(t.dragRange)},i.t,i.e);t.dragRange=null});e.hover(function(){if(!t.dragRange)return t.highlight({a:e.A[t.d]},r.t,r.e);t.dragRange[1]=n.a;t.highlight({a:za.fillRange(t.dragRange)},r.t,r.e)},function(){if(!t.dragRange)return t.reset({a:e.A[t.d]},r.t,r.e)})}},e),t,n,r,i)}function zScrollAxis(e,t,n,r,i){var s=new zSmartAxis(zo.extend({type:"zScrollAxis",expanded:true,style:{collapsedShown:1,expandedShown:8,expand:{t:500,e:"<>"},scroll:{t:500,e:"<>"},label:{"font-size":14,"font-weight":"bold",fill:"#ccc",opacity:.8,highlight:{opacity:1},select:{opacity:1,"font-size":28}},upArrow:{xSize:20,ySize:40,fill:"#fff",opacity:.3,highlight:{opacity:1}},downArrow:{xSize:20,ySize:40,fill:"#fff",opacity:.3,highlight:{opacity:1}}},baseMouseEvents:function(e){var t=e.parent,n={d:t.d,a:e.A[t.d]},r=t.Y.highlight,i=t.Y.expand;e.click(function(){if(t.expanded)t.collapse(n,i.t,i.e);else t.expand(i.t,i.e)});e.hoverHighlight(r.t,r.e)},scroll:function(e,t,n,r,i){var s=this,o;if(s.maxShown>=s.dc.getSize(s.d,true))s.range=[0,s.maxShown-1];else{o=zt.forceBetween(s.asRPos(e),0,s.dc.getSize(s.d,true)-1);s.range=[o-(s.maxShown-1)/2,o+(s.maxShown-1)/2]}s.refresh("all",t,n,r,i)},scrollBy:function(e,t,n,r,i){var s=this,o;if(!s.expanded)s.expand(t,n,function(){s.scrollBy(e,t,n,r,i)},i);else{o=za.mean(s.range)+e;s.scroll({r:o},t,n,r,i)}},scrollSelect:function(e,t,n,r,i){var s=this;s.select(e,t,n,function(){s.scroll(e,t,n,function(){s.forSwarms("setSpace",e);s.forSwarms("refresh","all",t,n,null,s.K);s.show("axisTitle",t,n,null,i);if(s.onSelect)s.onSelect(t,n,null,i||s.K);s.G.redraw(t,n,r,i)},i)},i)},expand:function(e,t,n,r){var i=this;if(i.expanded)return;i.expanded=true;i.maxShown=i.Y.expandedShown;i.L.set({innerWidth:i.L.innerWidth*i.Y.expandedShown/i.Y.collapsedShown});i.hide("axisTitle",e,t,null,r);i.scroll({r:i.selected.r},e,t,n,r)},collapse:function(e,t,n,r,i){var s=this;if(!s.expanded)return;s.expanded=false;s.maxShown=s.Y.collapsedShown;s.L.set({innerWidth:s.L.innerWidth*s.Y.collapsedShown/s.Y.expandedShown});s.scrollSelect(e,t,n,r,i)},plan:{axisLine:null,axisTitle:{type:"zTextBox",mask:"fixed",init:function(e,t,n,r){return{layer:0,text:e.dc.getMeta("title",{d:e.d}),layout:{anchor:e.L.getPoint(0,0),xAlign:"xCentre",yAlign:"bottom"}}}},label:{curr:function(e,t,n,r){var i={d:e.d,a:t[e.d]},s=e.asRPos(i),o=e.range[0]==e.range[1]?s==e.range[0]?.5:0:zt.calcDec(s,e.range[0],e.range[1]),u=zt.isBetween(s,e.range[0],e.range[1]);return{"clip-rect":zp.boxToArray(e.L),layout:e.getPoint(i,true),opacity:u?1-Math.abs(o-.5)*1.3:0,preRedraw:function(e){if(u)e.invisibleShow()},postRedraw:function(e){if(!u)e.hide()}}}},upArrow:{type:"zShape",mask:"fixed",init:function(e,t,n,r){var i=e.Y.highlight,s=e.Y.scroll;return{layer:0,onAdd:function(e){e.hide()},preRedraw:function(t){if(!e.expanded||za.min(e.range)<=0)t.hide();else t.show()},mouseEvents:function(t){t.hoverHighlight(i.t,i.e);t.mousedown(function(){t.highlight(i.t,i.e,null,e.K);e.scroll({r:e.range[0]},s.t,s.e,function(){t.reset(i.t,i.e)})})}}},curr:function(e,t,n,r){var i=e.L;return{points:[{x:i.x,y:i.top-r.xSize},{x:i.x-r.ySize/2,y:i.top},{x:i.x+r.ySize/2,y:i.top}]}}},downArrow:{type:"zShape",mask:"fixed",init:function(e,t,n,r){var i=e.Y.highlight,s=e.Y.scroll,o=e.Y.expand;return{layer:0,preRedraw:function(t){if(e.expanded&&za.max(e.range)>=e.dc.getSize(e.d,true)-1)t.hide();else t.show()},mouseEvents:function(t){t.hoverHighlight(i.t,i.e);t.mousedown(function(){if(e.maxShown==e.Y.expandedShown){t.highlight(s.t,s.e,null,e.K);e.scroll({r:e.range[1]},s.t,s.e,function(){t.reset(i.t,i.e)})}else e.expand(o.t,o.e)})}}},curr:function(e,t,n,r){var i=e.L;return{points:[{x:i.x,y:i.bottom+r.xSize},{x:i.x-r.ySize/2,y:i.bottom},{x:i.x+r.ySize/2,y:i.bottom}]}}}}},e),t,n,r,i);if(s.selected)s.scroll(s.selected);return s}function zSlideAxis(e,t,n,r,i){return new zSmartAxis(zo.extend({type:"zSlideAxis",selected:{r:0},baseSelected:{r:0},style:{perpendicularSize:1,select:{t:200,e:"-"},slideBar:{fill:"#801c7e",background:{rounded:8,"stroke-width":1,"stroke-opacity":1,stroke:"#000",opacity:.2},foreground:{opacity:1}},label:{"font-family":"sans-serif",margin:7,"font-size":12,"font-weight":"bold",fill:"#666"},baseNotch:{baseStyle:"currNotch",label:{"font-size":12}},currNotch:{flagWidth:10,flagHeight:20,width:48,height:36,ring:{stroke:"#801c7e","stroke-width":3,fill:"#dedede"},label:{"font-family":"sans-serif","font-size":18,fill:"#dedede",background:null},background:{fill:"#000",opacity:.75},highlight:{opacity:1}},playButton:{background:{rounded:6,fill:"white"},foreground:{fill:"#444",stroke:null}}},setBase:function(e,t,n,r,i){this.baseSelected={d:this.d,a:this.asAPos(e),r:this.asRPos(e)};this.forSwarms("refresh","all",t,n,r,i)},axisSelect:function(e,t,n,r,i){var s=this,o=Math.round(Math.random()*1e3),u=s.dragging?{}:s.Y.highlight,a=zt.forceBetween(zp.isPoint(e)?s.pointToRPos(e):s.asRPos(e),s.range[0],s.range[1]),f=function(e,t){s.G.scripting=true;s.select({d:s.d,r:e});s.G.scripting=false;s.forSwarms("setSpace",{d:s.d,r:e});s.forSwarms("updateData");s.forSwarms("plot","all",t)};if(a==s.rTargSelected)return;s.thread=o;s.rTargSelected=Math.round(a);t*=Math.abs(a-s.selected.r);if(!s.G.animating){s.G.redrawTo(s.selected.r);s.forOwnedSwarm("clearEvents");s.forSwarms("preRedraw")}else{s.G.stop();s.G.onAnimation()}if(a>s.selected.r){s.G.onAnimation(function(){var e=s.G.getVal();if(e>s.selected.r)f(Math.ceil(e));s.forSwarms("frameRedraw","all",e-(s.selected.r-1))})}else{s.G.onAnimation(function(){var e=s.G.getVal();if(e<s.selected.r)f(Math.floor(e));s.forSwarms("frameRedraw","all",s.selected.r+1-e)})}s.G.redrawTo(s.rTargSelected,t,n,function(){if(s.thread!=o)return;s.G.onAnimation();f(s.rTargSelected,true);s.forSwarms("frameRedraw","all",1);s.forSwarms("postRedraw");s.refresh({role:"playButton",mode:{noUpdateData:true}},u.t,u.e);s.forOwnedSwarm("mouseEvents");if(r)r();s.G.animating=false},i)},plan:{axisLine:null,slideBar:{type:"zMultiDrone",mask:"fixed",init:function(e,t,n,r){var i=e.Y.select;return{layer:0,mouseEvents:function(t){t.click(function(t){e.axisSelect(zt.getEventPosition(t),i.t,i.e)})},background:{type:"zRectangle",layout:{anchor:e.getPoint({r:0}),height:e.notchHeight,width:e.getLength(e.range[1])}},foreground:{type:"zRectangle",layout:{height:e.notchHeight}}}},curr:function(e,t,n,r){return{foreground:{layout:{anchor:e.getPoint(e.baseSelected),width:e.getLength(e.selected.r-e.baseSelected.r)}}}}},baseNotch:{type:"zMultiDrone",mask:"fixed",ignore:false,init:function(e,t,n){return{ring:{type:"zCircle",layer:0},background:{type:"zShape",layer:1},label:{type:"zTextBox",layer:2},mouseEvents:function(t){t.drag(function(t,n,r){e.setBase({a:e.pointToAPos({x:r})})})}}},curr:function(e,t,n,r){var i={d:e.d,a:e.baseSelected.a},s=zo.add(e.getPoint(i),{y:e.L.height/2}),o=zp.flag({anchor:s,width:r.width,height:r.height,xAlign:"left",yAlign:"bottom"},r.flagWidth,r.flagHeight),u={anchor:zo.mid(o[0],o[2]),xAlign:"xCentre",yAlign:"yCentre"};return{ring:{circle:{centre:s,radius:e.L.height/2-r.ring["stroke-width"]/2}},background:{points:o},label:{text:"From\n"+e.dc.getName(i),layout:u}}}},currNotch:{type:"zMultiDrone",mask:"fixed",init:function(e,t,n,r){return{ring:{type:"zCircle",layer:3},background:{type:"zShape",layer:4},label:{type:"zTextBox",layer:5},mouseEvents:function(t){t.drag(function(t,n,r,i){e.axisSelect({x:r,y:0})},function(){e.dragging=true},function(){e.dragging=false})}}},curr:function(e,t,n,r){var i={d:e.d,r:e.selected.r||0},s=zo.add(e.getPoint(i),{y:e.L.height/2}),o=zp.flag({anchor:s,width:r.width,height:r.height,xAlign:"right",yAlign:"bottom"},r.flagWidth,r.flagHeight),u={anchor:zo.mid(o[0],o[2]),xAlign:"xCentre",yAlign:"yCentre"};return{ring:{circle:{centre:s,radius:e.L.height/2-r.ring["stroke-width"]/2}},background:{points:o},label:{text:e.dc.getName(i),layout:u}}}},playButton:{type:"zMultiDrone",mask:"fixed",init:function(e,t,n,r){var i=e.Y.select,s=new zLayout({anchor:zp.addVector(e.L.rotation,-e.notchHeight,e.L.getPoint(0,.5,true)),width:e.notchHeight,height:e.notchHeight,xAlign:"xCentre",yAlign:"yCentre"});return{layer:0,background:{type:"zCircle",circle:{centre:s.anchor,radius:e.notchHeight/2}},foreground:{type:"zShape"},mouseEvents:function(t){t.click(function(){if(e.G.animating)e.axisSelect({r:e.selected.r},i.t,i.e);else if(e.selected.r==e.range[1])e.axisSelect({r:e.range[0]});else e.axisSelect({r:e.range[1]},i.t,i.e)})}}},curr:function(e,t,n,r){var i=e.Y.select,s=new zLayout({anchor:zp.addVector(e.L.rotation,-e.notchHeight,e.L.getPoint(0,.5,true)),width:e.notchHeight,height:e.notchHeight,xAlign:"xCentre",yAlign:"yCentre"});return{foreground:{points:s.getPoints(!e.G.animating?[[.33,.2],[.78,.5],[.78,.5],[.33,.8]]:[[.3,.3],[.7,.3],[.7,.7],[.3,.7]])}}}}}},e),t,n,r,i)}function zSwarm(e,t,n,r,i){zSwarmConstructor(this,zo.extend({rSpace:"all"},e),"zSwarm");if(this.updateData)this.updateData(t,n,null,this.K);this.add("fixed",t,n,null,this.K);this.add("all",t,n,r,i);this.layer();for(var s in this.axes)this.axes[s].layer()}var startTime=$.now(),logger=function(e){var t=$.now()-startTime+": "+e;if(typeof console=="object")console.log(t)},logobj=function(e){if(typeof console=="object")console.log($.now()-startTime+": "+zt.asString(e))},explode=function(e){logger("KABOOOM!: "+e);buggerSelf()},zDebug={show:function(e,t,n){t=t||"red";var r;if(e.left!=null&&e.right!=null&&e.top!=null&&e.bottom!=null){r=new zShape({points:zp.boxToPoints(e),stroke:t,"stroke-width":1})}else if(za.isArray(e)&&e[0].x!=null&&e[0].y!=null){r=new zLine({points:e,stroke:t,"stroke-width":.5})}else if(e.x!=null&&e.y!=null){r=new zCircle({circle:{centre:e,radius:5},fill:t})}r.remove(n||5e3,"<")},mapShow:function(e,t,n,r){zDebug.show(zt.mapPoints(e,t,n),r)},button:function(e,t){var n=new zCircle({circle:{centre:t||{x:20,y:20},radius:10},stroke:"#666",fill:"#888",opacity:.3});n.click(e)}};var zDrones={make:function(e,t,n,r,i,s){if(!e)return logger("zDrones.make(): WARNING - No type defined.");else if(typeof e=="function")return new e(t,n,r,i,s);else if(typeof e=="string"){if(!zDrones[e])return logger("zDrones.make(): WARNING - "+e+" is not a valid drone type.");return new zDrones[e](t,n,r,i,s)}},zGuide:zGuide,zLine:zLine,zShape:zShape,zArc:zArc,zCircle:zCircle,zRectangle:zRectangle,zText:zText,zImage:zImage,zSVG:zSVG,zHTML:zHTML,zMultiDrone:zMultiDrone,zTextBox:zTextBox,zHTMLTooltipBox:zHTMLTooltipBox};var zPlot=zp={isPoint:function(e){return e.x!=null&&e.y!=null},pointToString:function(e,t){return zt.round(e.x,t)+","+zt.round(e.y,t)},decToDeg:function(e){return(e||0)*360-90},decToRad:function(e){return(e||0)*2*Math.PI},degToDec:function(e){return(e||0)/360},degToRad:function(e){return(e||0)*Math.PI/180},radToDec:function(e){return(e||0)/2/Math.PI},radToDeg:function(e){return(e||0)*180/Math.PI},normaliseDeg:function(e,t,n){t=t||0;n=n||360;while(e>=n)e-=360;while(e<t)e+=360;return e},matchDeg:function(e,t){while(e>t+180)e-=360;while(e<t-180)e+=360;return e},inverseDeg:function(e){return zp.normaliseDeg(e+180)},degDiff:function(e,t){return zt.round(Math.abs(zp.normaliseDeg(e)-zp.normaliseDeg(t)),10)},sin:function(e){return Math.sin(zp.degToRad(e))},cos:function(e){return Math.cos(zp.degToRad(e))},tan:function(e){return Math.tan(zp.degToRad(e))},asin:function(e){return zp.radToDeg(Math.asin(e))},acos:function(e){return zp.radToDeg(Math.acos(e))},atan:function(e){return zp.radToDeg(Math.atan2(e))},isRightAngle:function(e,t,n){var r=Math.round(zp.normaliseDeg(zp.deg(e,t)-zp.deg(t,n)));return r==90|r==270},dist:function(e,t){var n=t.x-e.x,r=t.y-e.y;if(n==0&&r==0)return 0;return Math.sqrt(n*n+r*r)},deg:function(e,t){var n=t.x-e.x,r=t.y-e.y;if(n==0&&r==0)return 0;return zp.radToDeg(Math.atan2(r,n))},vector:function(e,t){var n=t.x-e.x,r=t.y-e.y;if(n==0&&r==0)return{x:0,y:0,deg:0,dist:0};return{x:n,y:r,deg:zp.radToDeg(Math.atan2(r,n)),dist:Math.sqrt(n*n+r*r)}},addVector:function(e,t,n){if(e==-90)return{x:n.x,y:n.y-t};if(t==0)return n;var r=zp.degToRad(e);return{x:n.x+Math.cos(r)*t,y:n.y+Math.sin(r)*t}},arcToPoints:function(e,t,n,r,i){while(r<0)r+=360,i+=360;var s,o=[],u=function(r){if(t)o.push(zp.addVector(r,t,e));o.push(zp.addVector(r,n,e))};if(!t)o.push(e);u(r);for(s=90;s<=360;s+=90)if(zt.isBetween(s,r,i))u(s);u(i);return o},alignmentToDec:function(e){switch(e){case"right":case"bottom":return 1;case"xCentre":case"yCentre":return.5;case"left":case"top":return 0;default:return logger("zTools.alignmentToDec(): "+e+" doesn't look like an alignment.")}},alignmentToMod:function(e){switch(e){case"right":case"bottom":return 1;case"xCentre":case"yCentre":return 0;case"left":case"top":return-1;default:return logger("zTools.alignmentToMod(): "+e+" doesn't look like an alignment.")}},inverseAlignment:function(e){switch(e){case"xCentre":return"xCentre";case"left":return"right";case"right":return"left";case"yCentre":return"yCentre";case"top":return"bottom";case"bottom":return"top"}},completeBox:function(e){if(e instanceof zLayout)return e;e=zo.clone(e);if(e.anchor)e.x=e.anchor.x,e.y=e.anchor.y;else e.anchor={x:e.x,y:e.y};if(e.xAlign)e[e.xAlign]=e.x;if(e.yAlign)e[e.yAlign]=e.y;e.left=e.left!=null?e.left:e.right!=null&&e.width!=null?e.right-e.width:e.xCentre!=null&&e.width!=null?e.xCentre-e.width/2:e.x||0;e.top=e.top!=null?e.top:e.bottom!=null&&e.height!=null?e.bottom-e.height:e.yCentre!=null&&e.height!=null?e.yCentre-e.height/2:e.y||0;e.width=e.width!=null?e.width:e.right!=null?e.right-e.left:0;e.height=e.height!=null?e.height:e.bottom!=null?e.bottom-e.top:0;e.right=e.right!=null?e.right:e.left+e.width;e.bottom=e.bottom!=null?e.bottom:e.top+e.height;e.xCentre=e.xCentre!=null?e.xCentre:zt.calcMid(e.left,e.right);e.yCentre=e.yCentre!=null?e.yCentre:zt.calcMid(e.top,e.bottom);e.centre={x:e.xCentre,y:e.yCentre};return e},pointsToBox:function(e){var t=za.calcObjects(e,"x","sort"),n=za.calcObjects(e,"y","sort");return{left:t[0],right:za.last(t),top:n[0],bottom:za.last(n)}},boxToPoints:function(e){return[{x:e.left,y:e.top},{x:e.right,y:e.top},{x:e.right,y:e.bottom},{x:e.left,y:e.bottom}]},boxToArray:function(e){return[e.left,e.top,e.right-e.left,e.bottom-e.top]},boxToSVG:function(e){return zp.shape(zp.boxToPoints(e))},start:function(e){return"M"+zp.pointToString(e||{x:0,y:0})},lineTo:function(e){return"L"+zp.pointToString(e)},quadraticCurveTo:function(e,t){return"Q"+zp.pointToString(e)+","+zp.pointToString(t)},arcTo:function(e,t){return"A"+e+","+e+",0,0,1,"+zp.pointToString(t)},reverseArcTo:function(e,t){return"A"+e+","+e+",0,0,0,"+zp.pointToString(t)},close:function(e){return"Z"},line:function(e){var t=zp.start(e[0]);for(var n=1;n<e.length;n++)t+=zp.lineTo(e[n]);return t},shape:function(e){return zp.line(e)+"Z"},arc:function(e){var t,n,r=e.degEnd-e.degStart,i=e.minSeg||Math.ceil(r/90),s=r/i;if(e.innerRadius){n=zp.start(zp.addVector(e.degStart,e.innerRadius,e.centre));for(t=1;t<=i;t++){n+=zp.arcTo(e.innerRadius,zp.addVector(e.degStart+t*s,e.innerRadius,e.centre))}}else n=zp.start(e.centre);if(e.outerRadius>e.innerRadius){n+=zp.lineTo(zp.addVector(e.degEnd,e.outerRadius,e.centre));for(t=i-1;t>=0;t--){n+=zp.reverseArcTo(e.outerRadius,zp.addVector(e.degStart+t*s,e.outerRadius,e.centre))}}return n+"Z"},circle:function(e,t){var n,r=-135,i=4,s=360/i,o=zp.start(zp.addVector(r,t,e));if(t)for(n=1;n<=i;n++){o+=zp.arcTo(t,zp.addVector(r+n*s,t,e))}return o},flag:function(e,t,n){e=zp.completeBox(e);var r=t*zp.alignmentToMod(e.xAlign),i=n*zp.alignmentToMod(e.yAlign),s=[e[e.xAlign],e[zp.inverseAlignment(e.xAlign)]],o=[e[e.yAlign],e[zp.inverseAlignment(e.yAlign)]];return[{x:s[0],y:o[1]-i},{x:s[1],y:o[1]-i},{x:s[1],y:o[0]-i},{x:s[0]-r,y:o[0]-i},{x:s[0],y:o[0]}]}};var zArray=za={asArray:function(e){return za.isArray(e)?e:[e]},asObject:function(e){if(za.isArray(e)){var t,n={};for(t=0;t<e.length;t++)n[t]=e[t];return n}else return e},isEmpty:function(e){return e==null||e.length==0},isArray:function(e){return $.isArray(e)},fill:function(e,t,n){var r,i=[];if(n)for(r=0;r<t;r++)i[r]=e+r*n;else for(r=0;r<t;r++)i[r]=zo.clone(e);return i},fillRange:function(e){var t=Math.abs(e[0]-e[1])+1,n=e[0]<e[1]?1:e[0]>e[1]?-1:0;return za.fill(e[0],t,n)},last:function(e){return e[e.length-1]},insertAt:function(e,t,n){return e.slice(0,n).concat(za.asArray(t),e.slice(n+1))},removeAt:function(e,t){if(t==null)return null;return e.splice(t,1)[0]},shyPush:function(e,t){return za.contains(e,t)?e:e.push(t)},shyConcat:function(e,t){for(var n=0;n<t.length;n++)za.shyPush(e,t[n]);return e},shyInsert:function(e,t,n){return za.contains(e,t)?e:za.insertAt(e,t,n)},count:function(e){var t,n=za.fill(0,e.length),r=[n.slice()];for(t=n.length-1;t>=0;t--){if(n[t]<e[t]){n[t]++;for(t++;t<n.length;t++)n[t]=0;r.push(n.slice());t=n.length}}return r},index:function(e){var t,n=[];for(t=0;t<e.length;t++)n[t]={id:t,val:e[t]};return n},sort:function(e,t){e.sort(function(e,t){return e>t?1:t>e?-1:0});return t?e.reverse():e},map:function(e,t){if(typeof t=="number")return e[t];else if(za.isArray(t)){var n,r=[];for(n=0;n<t.length;n++)r[n]=e[t[n]];return r}else return e},unmap:function(e,t){if(typeof t=="number")return za.find(e,t);else if(za.isArray(t)){var n,r=[];for(n=0;n<t.length;n++)r[n]=za.find(e,t[n]);return r}else return e},compareTests:function(e,t){if(t==null)return logger("za.compareTests(): ERROR - Array to test is null.");switch(e){case"==":case null:case undefined:return function(e,t){return e==t};case"===":return function(e,t){return e===t};case"<":return function(e,t){return e<t};case"<=":return function(e,t){return e<=t};case">":return function(e,t){return e>t};case">=":return function(e,t){return e>=t};case"><":return function(e,t,n){return e>t&&e<n};case">=<":return function(e,t,n){return e>=t&&e<=n};case"<>":return function(e,t,n){return e<t||e>n};case"<=>":return function(e,t,n){return e<=t||e>=n};case"!=":return function(e,t){return e!=t};case"type":return function(e,t){return zt.type(e)==t};case"atPos":return function(e,t,n){return e[n]==t};case"equals":return function(e,t,n){return zo.equals(e,t,n)};case"superset":return function(e,t,n){return za.isSuperset(e,t,n)};case"subset":return function(e,t,n){return za.isSubset(e,t,n)};case"intersects":return function(e,t){return za.intersects(e,t)};case"match":return function(e,t){return za.contains(t,e)};case"notMatch":return function(e,t){return!za.contains(t,e)};case"max":case"min":case"closest":return"special";default:logger("za.compareTests(): ERROR - I don't understand mode "+e+".")}},find:function(e,t,n,r){var i,s=za.compareTests(n,e);if(s=="special")return za.find(e,za[n](e,t,r));else if(s){for(i=0;i<e.length;i++)if(s(e[i],t,r))return i}return null},findLast:function(e,t,n,r){var i,s=za.compareTests(n,e);if(s=="special")return za.findLast(e,za[n](e,t,r));else if(s){for(i=e.length-1;i>=0;i--)if(s(e[i],t,r))return i}return null},findAll:function(e,t,n,r){var i,s=[],o=za.compareTests(n,e);if(o=="special")return za.findAll(e,za[n](e,t,r));else if(o){for(i=0;i<e.length;i++)if(o(e[i],t,r))s.push(i);return s}return null},get:function(e,t,n,r){var i=za.find(e,t,n,r);return i==null?null:e[i]},getLast:function(e,t,n,r){var i=za.findLast(e,t,n,r);return i==null?null:e[i]},getAll:function(e,t,n,r){var i=za.findAll(e,t,n,r);return za.map(e,i)},remove:function(e,t,n,r){var i=za.find(e,t,n,r);return za.removeAt(e,i)},removeLast:function(e,t,n,r){var i=za.findLast(e,t,n,r);return za.removeAt(e,i)},removeAll:function(e,t,n,r){var i,s=[],o=za.sort(za.findAll(e,t,n,r),true);for(i=0;i<o.length;i++)s.push(za.removeAt(e,o[i]));return s},replace:function(e,t,n,r,i){var s=za.find(e,n,r,i);e[s]=t;return s},replaceLast:function(e,t,n,r,i){var s=za.findLast(e,n,r,i);e[s]=t;return s},replaceAll:function(e,t,n,r,i){var s,o=za.findAll(e,n,r,i);for(s=0;s<o.length;s++)e[o[s]]=t;return o},contains:function(e,t,n,r){return za.find(e,t,n,r)!=null},extract:function(e,t){for(var n=[],r=0;r<e.length;r++)n[r]=e[r][t];return n},sortObjects:function(e,t,n){var r=e.slice();r.sort(function(e,n){return e[t]>n[t]?1:n[t]>e[t]?-1:0});return n?r.reverse():r},calcObjects:function(e,t,n,r){var i=za.extract(e,t);if(!n)return i;if(za[n])return za[n](i,r)},findObject:function(e,t,n,r,i){return za.find(za.extract(e,t),n,r,i)},findLastObject:function(e,t,n,r,i){return za.findLast(za.extract(e,t),n,r,i)},findAllObjects:function(e,t,n,r,i){return za.findAll(za.extract(e,t),n,r,i)},getObject:function(e,t,n,r,i){var s=za.findObject(e,t,n,r,i);return s==null?null:e[s]},getLastObject:function(e,t,n,r,i){var s=za.findLastObject(e,t,n,r,i);return s==null?null:e[s]},getAllObjects:function(e,t,n,r,i){var s=za.findAllObjects(e,t,n,r,i);return za.map(e,s)},removeObject:function(e,t,n,r,i){var s=za.findObject(e,t,n,r,i);return za.removeAt(e,s)},removeLastObject:function(e,t,n,r,i){var s=za.findLastObject(e,t,n,r,i);return za.removeAt(e,s)},removeAllObjects:function(e,t,n,r,i){var s,o=[],u=za.sort(za.findAllObjects(e,t,n,r,i),true);for(s=0;s<u.length;s++)za.add(o,za.removeAt(e,u[s]));return o},add:function(e,t){return $.merge(e,t)},subtract:function(e,t,n){e=za.asArray(e),t=za.asArray(t);var r,i=e.slice();for(r=0;r<t.length;r++)za.remove(i,t[r],"equals",n);return i},union:function(e,t){return za.getUniques(e.concat(t))},intersection:function(e,t){return za.getAll(e,t,"match")},isSubset:function(e,t,n){if(t.length-e.length<n)return false;return za.subtract(e,t).length==0},isSuperset:function(e,t,n){return za.isSubset(t,e,n)},intersects:function(e,t){return za.intersection(e,t)!=null},calc:function(e,t,n,r,i){if(za[e])return za[e](t,n,r,i);logger("zArray.calc(): I don't know how to calculate "+e+".")},sum:function(e){e=za.getNumbers(e);var t,n=0;for(t=0;t<e.length;t++)n+=e[t];return n},max:function(e){return Math.max.apply({},za.getNumbers(e))},min:function(e){return Math.min.apply({},za.getNumbers(e))},range:function(e){return[za.min(e),za.max(e)]},mean:function(e){e=za.getNumbers(e);return za.sum(e)/e.length},median:function(e){return za.percentile(e,.5)},percentile:function(e,t){e=za.sort(za.getNumbers(e));var n=(e.length-1)*t;return zt.calcMid(e[Math.floor(n)],e[Math.ceil(n)],n-Math.floor(n))},closest:function(e,t){var n,r={diff:Infinity};for(n=1;n<e.length;n++){curr={val:e[n],diff:Math.abs(t-e[n])};if(curr.diff<r.diff)r=curr}return r.val},round:function(e,t){var n,r=[];for(n=0;n<e.length;n++)r[n]=zt.round(e[n],t);return r},rank:function(e,t){var n,r=[];e=za.sortObjects(za.index(e),"val",t);for(n=0;n<e.length;n++)r[e[n].id]=n;return r},dec:function(e){var t,n=[],r=za.sum(e);if(r)for(t=0;t<e.length;t++)if(!isNaN(e[t]))n[t]=e[t]/r;else for(t=0;t<e.length;t++)n[t]=0;return n},stacked:function(e,t){var n,r,i=[],s=t||0;for(n=0;n<e.length;n++){r=isNaN(e[n])?0:e[n];i[n]={start:s,end:s+=r}}return i},change:function(e){var t,n,r=0,i=[];for(t=0;t<e.length;t++){n=isNaN(e[t])?0:e[t];i[t]=n-r;r=n}return i},decChange:function(e){var t,n=0,r=[];for(t=0;t<e.length;t++){r[t]=e[t]?n?e[t]/n-1:1:n?-1:0;n=e[t]}return r},totalChange:function(e){var t,n,r=[],i=e[0]||0;for(t=0;t<e.length;t++){n=isNaN(e[t])?0:e[t];r[t]=n-i}return r},totalDecChange:function(e){var t,n=[];for(t=0;t<e.length;t++){n[t]=e[t]?e[0]?e[t]/e[0]-1:1:e[0]?-1:0}return n},createDeep:function(e,t){var n=[],r,i=e[0],s=e.slice(1);if(e.length>1)for(r=0;r<i;r++)n[r]=za.createDeep(s,t);else for(r=0;r<i;r++)n[r]=t;return n},getDeep:function(e,t){if(za.isEmpty(t)||e==null)return e;var n,r=[],i=t[0],s=t.slice(1);if(za.isArray(i))for(n=0;n<i.length;n++)r[n]=za.getDeep(e[i[n]],s);else r=za.getDeep(e[i],s);return r},setDeep:function(e,t,n){var r,i=t[0]=="all"?za.fill(0,e.length,1):za.asArray(t[0]);if(t.length>1){t=t.slice(1);for(r=0;r<i.length;r++){e[i[r]]=za.setDeep(e[i[r]]||[],t,n)}}else for(r=0;r<i.length;r++)e[i[r]]=zo.clone(n);return e},deepLength:function(e){var t=[],n=e;while(za.isArray(n)){t.push(n.length);n=n[0]}return t},flatten:function(e){var t,n=[];for(t=0;t<e.length;t++){if(za.isArray(e[t])){za.add(n,za.flatten(e[t]))}else n.push(e[t])}return n},getNumbers:function(e){return za.getAll(za.asArray(e),"number","type")},getUniques:function(e){var t,n,r=[];e=za.sort(e.slice());for(t=0;t<e.length;t++){if(e[t]!=e[t-1])r.push(e[t])}return r},getRandom:function(e,t,n){if(t==null||t==1){if(!e)explode("zArray.getRandom(): Can't get a random element from an undefined array.");return e[Math.round(Math.random()*(e.length-1))]}var r,i,s=[],o=za.fill(0,e?e.length:t,1);if(n==null||n=="random"){while(s.length<t){s.push(Math.round(Math.random()*(o.length-1)))}}else if(n=="randomNoRepeat"){while(s.length<t){i=o.slice();for(r=0;r<t;r++)s.push(za.removeAt(i,Math.round(Math.random()*(i.length-1))))}}else if(n=="sequential"){while(s.length<t){za.add(s,o)}}if(e)for(r=0;r<t;r++)s[r]=e[s[r]];return s},mergeStacked:function(e){return{start:za.calcObjects(e,"start","min"),end:za.calcObjects(e,"end","max")}}};var zObject=zo={list:function(e){var t,n=[];for(t in e)n.push(t);return n},get:function(e,t){t=t.split(".");for(var n=0;n<t.length&&e;n++)e=e[t[n]];return e},remove:function(e,t){var n=e[t];delete e[t];return n},extend:function(e,t,n){return $.extend(!n,e,t)},shyExtend:function(e,t){if(typeof e!="object"||typeof t!="object")return;for(p in t){if(e[p]==null)e[p]=zo.clone(t[p]);else zo.shyExtend(e[p],t[p])}return e},clone:function(e,t){var n=za.isArray(e)?zo.extend([],e):typeof e=="object"?zo.extend({},e):e;if(t)n=zo.extend(n,t);return n},isEmpty:function(e){return $.isEmptyObject(e)},equals:function(e,t,n){if(e==t)return true;var r,i,s=zt.type(e);if(s!=zt.type(t))return false;if(s=="object"){for(i in e){if(!zo.equals(e[i],t[i]))return false}return true}if(s=="array"){if(e.length!=t.length)return false;if(n){for(r=0;r<e.length;r++){if(!zo.equals(e[r],t[r],true))return false}return true}else{return za.subtract(e,t).length==0}}if(s=="function"){return zt.asString(e)==zt.asString(t)}return false},asCSSString:function(e){var t,n="";for(t in e)n+=t+":"+e[t]+";";return n},parseStyle:function(e,t){var n,r,i,s={};t=t||e;if(e.baseStyle){i=e.baseStyle.split(" ");for(n=0;n<i.length;n++){zo.extend(s,zo.get(t,i[n]))}zo.extend(s,e);delete s.baseStyle}else s=e;for(r in s)if(s[r]&&typeof s[r]=="object")s[r]=zo.parseStyle(s[r],t);return s},round:function(e,t){var n,r={};for(n in e)r[n]=zt.round(e[n],t);return r},add:function(e,t){var n,r={};for(n in e)r[n]=(e[n]||0)+(t[n]||0);return r},subtract:function(e,t){var n,r={};for(n in e)r[n]=(e[n]||0)-(t[n]||0);return r},mid:function(e,t,n){if(n==0||t==null||e==t)return e;if(n==1||e==null)return t;var r=zt.type(e);if(r!=zt.type(t))return t;if(zt.isColour(e))return zt.getColour(n,e,t);if(r=="object"){var i,s={};for(i in t)s[i]=zo.mid(e[i],t[i],n);return s}if(r=="array"){var o,s=[];for(o=0;o<t.length;o++)s[o]=zo.mid(e[o],t[o],n);return s}if(r=="number")return zt.calcMid(e,t,n);return t},midStack:function(e){return zt.calcMid(e.start,e.end)}};var zTools=zt={type:function(e){return $.type(e)},isColour:function(e){if(e){if(e.r!=null&&e.g!=null&&e.b!=null)return true;if(e[0]=="#"&&(e.length==4||e.length==7))return true}return false},getRGB:function(e){var t=zt.type(e);if(t=="string")return Raphael.getRGB(e);if(t=="object"&&e.r!=null&&e.g!=null&&e.b!=null)return e;logger("zt.getRGB(): "+e+" is not a recognised colour.")},getHex:function(e){e=zt.getRGB(e);var t,n,r,i="#";for(t in e){n=zt.forceBetween(e[t],0,255);r=Math.round(n).toString(16);if(r.length<2)r="0"+r;i+=r}return i},getColour:function(e,t,n,r){if(e==0||!r&&e<0)return t;if(e==1)return n;if(e==-1&&r)return r;var i=[],s=zt.getRGB(t),o=zt.getRGB(r&&e<0?r:n);e=Math.min(Math.abs(e),1);return zt.getHex({r:zt.calcMid(s.r,o.r,e),g:zt.calcMid(s.g,o.g,e),b:zt.calcMid(s.b,o.b,e)})},getRandomColour:function(e,t){e=e||0;t=t||255;var n=t-e;return zt.getHex({r:e+Math.random()*n,g:e+Math.random()*n,b:e+Math.random()*n})},getPalette:function(e,t,n){e=e||["#8DD3C7","#FFFFB3","#BEBADA","#FB8072","#80B1D3","#FDB462","#B3DE69","#FCCDE5","#D9D9D9","#BC80BD","#CCEBC5","#FFED6F"];return za.getRandom(e,t,n)},asString:function(e){var t=zt.type(e);if(e==null)return null;if(t=="object"){var n,r=[];for(n in e)r.push(n+":"+zt.asString(e[n]));return"{"+r.join(",")+"}"}if(t=="array"){var i,r=[];for(i=0;i<e.length;i++)r.push(zt.asString(e[i]));return"["+r.join(",")+"]"}if(t=="string")return'"'+e+'"';return e+""},camelCase:function(e){var t,n=""+e[0];for(t=1;t<e.length;t++){n+=e[t].substr(0,1).toUpperCase()+e[t].substr(1)}return n},titleCase:function(e){e=za.isArray(e)?e:e.split(" ");var t,n="";for(t=0;t<e.length;t++){n+=e[t].substr(0,1).toUpperCase()+e[t].substr(1);if(t+1<e.length)n+=" "}return n},shorten:function(e,t){if(e==null)return"";if(e.length<=t)return e;return e.substr(0,t)+".."},wrap:function(e,t){if(e==null||typeof e!="string")return e;var n,r,i="",s="",o=e.split(" "),u;for(n=0;n<o.length;n++){u=o[n].split("\n");for(r=0;r<u.length;r++){if(s==""){s=u[r]}else if(s.length+u[r].length<t){s+=" "+u[r]}else{i+=s+"\n";s=u[r]}if(r<u.length-1){i+=(s||" ")+"\n";s=""}}}return i+s},format:function(e,t){if(za.isArray(e)){var n,r=[];for(n=0;n<e.length;n++)r.push(zt.format(e[n],t));return r}var i=function(e){var t,n=e.split(".");for(t=n[0].length-3;t>0;t-=3){n[0]=n[0].slice(0,t)+","+n[0].slice(t)}if(n[1])for(t=3;t<n[1].length;t+=4){n[1]=n[1].slice(0,t)+","+n[1].slice(t)}return n.join(".")},s=function(e){if(isNaN(e))e=0;return[Math.floor(e/60),Math.round(e%60)]};t=t||{};if(typeof t=="string")t={mode:t};if(t.m)t.mode=t.m;var o,u="",a=Math.abs(e*(t.multiply||1));if(t.noSign)o="";else if(t.wordSign)o=e>0?"up ":e<0?"down ":"";else if(t.forceSign)o=e>0?"+":e<0?"-":"";else o=e>=0||t.noSign?"":"-";if(t.prefix)o+=t.prefix;if(t.mode=="time"){var f=s(a);if(f[1]<10)f[1]="0"+f[1];return o+f.join(":")}else if(t.mode=="hours"){var f=s(a);if(f[0])f[0]+="hr";if(f[1])f[1]+="min";return o+f.join(" ")}else if(t.mode=="hoursLong"){var f=s(a);if(f[0])f[0]+=f[0]==1?" hour":" hours";if(f[1])f[1]+=f[1]==1?" minute":" minutes";return o+f.join(" ")}else if(t.mode=="%"){u="%";a*=100}else if(t.mode=="th"){a=Math.round(a);var l=za.last(a),c=a[a.length-2];u=c==1?"th":l==1?"st":l==2?"nd":l==3?"rd":"th"}else if(t.mode=="abbreviate"&&!zt.isBetween(e,-1e3,1e3)){var h=["","k","M","B","T"],p=Math.floor(zt.magnitude(a)/3)*3;a=a/Math.pow(10,p);u=h[p/3]}a=zt.round(a,t.dp==null?10:t.dp);if(!t.noCommas)a=i(a+"");return o+a+u+(t.suffix||"")},round:function(e,t,n){var r=n=="ceil"?Math.ceil:n=="floor"?Math.floor:Math.round;if(!t)return r(e);var i=Math.pow(10,Math.abs(t));return t>=0?r(e*i)/i:r(e/i)*i},roundToNearest:function(e,t,n){var r=n=="ceil"?Math.ceil:n=="floor"?Math.floor:Math.round;return r(e/t)*t},roundToSF:function(e,t){return zt.round(e,-zt.magnitude(e)-1+t)},isBetween:function(e,t,n,r){var i=Math.min(t,n),s=Math.max(t,n);return r?e>i&&e<s:e>=i&&e<=s},forceBetween:function(e,t,n){return Math.max(t,Math.min(n,e))},calcDec:function(e,t,n){if(t==n)return 0;return(e-t)/(n-t)},calcMid:function(e,t,n){if(n==null)n=.5;return e+(t-e)*n},scale:function(e,t,n,r,i){var s=zt.calcDec(e,t,n);return zt.calcMid(r,i,s)},factorial:function(e){for(var t=1,n=e;n>0;n--)t*=n;return t},magnitude:function(e){if(!e)return 0;e=Math.abs(e);if(e>=1)return(Math.round(e)+"").length-1;else return-za.find((e+"").split(".")[1],0,"!=")-1},getFactorOfTen:function(e){if(!e||isNaN(e))return 0;var t=e<0?-1:1,n=Math.pow(10,zt.magnitude(e)),r=Math.ceil(Math.abs(e)/n);while(10%r!=0)r++;return t*r*n},makePaper:function(e){var t=Raphael("Raphael");return zt.setPaperSize(e,t)},setPaperSize:function(e,t){t=t||PAPER;e=e||zt.getMaxLayout();t.setSize(e.width,e.height);t.fixedOffset=$(t.canvas).offset();return t},getMaxLayout:function(e,t,n){return new zLayout({width:Math.max(e,$(window).width()-$("#Raphael").offset().left-6),height:Math.max(t,$(window).height()-$("#Raphael").offset().top-12),margin:n})},getEventPosition:function(e){var t=PAPER.fixedOffset||PAPER.offset||$(PAPER.canvas).offset();return{x:e.pageX-t.left,y:e.pageY-t.top}},getDocumentPosition:function(e){var t=PAPER.fixedOffset||PAPER.offset||$(PAPER.canvas).offset();return{x:Math.round(e.x+t.left),y:Math.round(e.y+t.top)}}}